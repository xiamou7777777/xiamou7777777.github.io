<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>SpringBoot3 | X</title><meta name="author" content="Xiamou"><meta name="copyright" content="Xiamou"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="SpringBoot3 全栈指南教程——尚硅谷学习笔记 2023 年">
<meta property="og:type" content="article">
<meta property="og:title" content="SpringBoot3">
<meta property="og:url" content="http://example.com/2023/10/09/SpringBoot3%20%E5%85%A8%E6%A0%88%E6%8C%87%E5%8D%97%E6%95%99%E7%A8%8B%E2%80%94%E2%80%94%E5%B0%9A%E7%A1%85%E8%B0%B7%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%202023%E5%B9%B4/index.html">
<meta property="og:site_name" content="X">
<meta property="og:description" content="SpringBoot3 全栈指南教程——尚硅谷学习笔记 2023 年">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://img1.baidu.com/it/u=4046275171,1854121622&fm=253&fmt=auto?w=640&h=356">
<meta property="article:published_time" content="2023-10-09T11:25:30.000Z">
<meta property="article:modified_time" content="2023-11-03T14:03:03.681Z">
<meta property="article:author" content="Xiamou">
<meta property="article:tag" content="Java">
<meta property="article:tag" content="Springboot">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://img1.baidu.com/it/u=4046275171,1854121622&fm=253&fmt=auto?w=640&h=356"><link rel="shortcut icon" href="/img/favicon.jpg"><link rel="canonical" href="http://example.com/2023/10/09/SpringBoot3%20%E5%85%A8%E6%A0%88%E6%8C%87%E5%8D%97%E6%95%99%E7%A8%8B%E2%80%94%E2%80%94%E5%B0%9A%E7%A1%85%E8%B0%B7%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%202023%E5%B9%B4/index.html"><link rel="preconnect" href="//unpkg.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://unpkg.com/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://unpkg.com/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://unpkg.com/@fancyapps/ui/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"top_n_per_article":1,"unescape":true,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  noticeOutdate: {"limitDay":365,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":230},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体中文","cht_to_chs":"你已切换为简体中文","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"top-right"},
  infinitegrid: {
    js: 'https://unpkg.com/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: true,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'SpringBoot3',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-11-03 22:03:03'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const now = new Date()
          const hour = now.getHours()
          const isNight = hour <= 6 || hour >= 18
          if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
          else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><link rel="stylesheet" href="/css/custom.css"><!-- hexo injector head_end start --><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-categories-card@1.0.0/lib/categorybar.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-double-row-display@1.00/cardlistpost.min.css"/>
<style>#recent-posts > .recent-post-item >.recent-post-info > .article-meta-wrap > .tags:before {content:"\A";
  white-space: pre;}#recent-posts > .recent-post-item >.recent-post-info > .article-meta-wrap > .tags > .article-meta__separator{display:none}</style>
<link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-footer-beautify@1.0.0/lib/runtime.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu/lib/clock.min.css" /><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiperstyle.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/animate.min.css" media="print" onload="this.media='screen'"><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://reggie-xiamou.oss-cn-beijing.aliyuncs.com/other/QQ%E5%9B%BE%E7%89%8720230721130300.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">23</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">14</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">1</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group hide" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 列表</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fas fa-envelope"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://img1.baidu.com/it/u=4046275171,1854121622&amp;fm=253&amp;fmt=auto?w=640&amp;h=356')"><nav id="nav"><span id="blog-info"><a href="/" title="X"><span class="site-name">X</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group hide" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 列表</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fas fa-envelope"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">SpringBoot3</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-10-09T11:25:30.000Z" title="发表于 2023-10-09 19:25:30">2023-10-09</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-11-03T14:03:03.681Z" title="更新于 2023-11-03 22:03:03">2023-11-03</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%BC%96%E7%A8%8B/">编程</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">29.4k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>125分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="SpringBoot3"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="SpringBoot3-全栈指南教程——尚硅谷学习笔记-2023-年"><a href="#SpringBoot3-全栈指南教程——尚硅谷学习笔记-2023-年" class="headerlink" title="SpringBoot3 全栈指南教程——尚硅谷学习笔记 2023 年"></a>SpringBoot3 全栈指南教程——尚硅谷学习笔记 2023 年</h1><ul>
<li><a href="#springboot3-%E5%85%A8%E6%A0%88%E6%8C%87%E5%8D%97%E6%95%99%E7%A8%8B%E5%B0%9A%E7%A1%85%E8%B0%B7%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-2023-%E5%B9%B4">SpringBoot3 全栈指南教程——尚硅谷学习笔记 2023 年</a></li>
<li><a href="#%E4%B8%80-spring-boot-3-%E6%A0%B8%E5%BF%83%E7%89%B9%E6%80%A7">一、Spring Boot 3-核心特性</a><ul>
<li><a href="#%E7%AC%AC-1-%E7%AB%A0-springboot3-%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8">第 1 章 SpringBoot3-快速入门</a><ul>
<li><a href="#11-%E7%AE%80%E4%BB%8B">1.1 简介</a><ul>
<li><a href="#111-%E5%89%8D%E7%BD%AE%E7%9F%A5%E8%AF%86">1.1.1 前置知识</a></li>
<li><a href="#112-%E7%8E%AF%E5%A2%83%E8%A6%81%E6%B1%82">1.1.2 环境要求</a></li>
<li><a href="#113-springboot-%E6%98%AF%E4%BB%80%E4%B9%88">1.1.3 SpringBoot 是什么</a></li>
</ul>
</li>
<li><a href="#12-%E5%BF%AB%E9%80%9F%E4%BD%93%E9%AA%8C">1.2 快速体验</a><ul>
<li><a href="#121-%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B">1.2.1 开发流程</a><ul>
<li><a href="#1211-%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE">1.2.1.1 创建项目</a></li>
<li><a href="#1212-%E5%AF%BC%E5%85%A5%E5%9C%BA%E6%99%AF">1.2.1.2 导入场景</a></li>
<li><a href="#1213-%E4%B8%BB%E7%A8%8B%E5%BA%8F">1.2.1.3 主程序</a></li>
<li><a href="#1214-%E4%B8%9A%E5%8A%A1">1.2.1.4 业务</a></li>
<li><a href="#1215-%E6%B5%8B%E8%AF%95">1.2.1.5 测试</a></li>
<li><a href="#1216-%E6%89%93%E5%8C%85">1.2.1.6 打包</a></li>
</ul>
</li>
<li><a href="#122-%E7%89%B9%E6%80%A7%E5%B0%8F%E7%BB%93">1.2.2 特性小结</a><ul>
<li><a href="#1221-%E7%AE%80%E5%8C%96%E6%95%B4%E5%90%88">1.2.2.1 简化整合</a></li>
<li><a href="#1222-%E7%AE%80%E5%8C%96%E5%BC%80%E5%8F%91">1.2.2.2 简化开发</a></li>
<li><a href="#1223-%E7%AE%80%E5%8C%96%E9%85%8D%E7%BD%AE">1.2.2.3 简化配置</a></li>
<li><a href="#1224-%E7%AE%80%E5%8C%96%E9%83%A8%E7%BD%B2">1.2.2.4 简化部署</a></li>
<li><a href="#1225-%E7%AE%80%E5%8C%96%E8%BF%90%E7%BB%B4">1.2.2.5 简化运维</a></li>
<li><a href="#1226-spring-initializr-%E5%88%9B%E5%BB%BA%E5%90%91%E5%AF%BC">1.2.2.6 Spring Initializr 创建向导</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#13-%E5%BA%94%E7%94%A8%E5%88%86%E6%9E%90">1.3 应用分析</a><ul>
<li><a href="#131-%E4%BE%9D%E8%B5%96%E7%AE%A1%E7%90%86%E6%9C%BA%E5%88%B6">1.3.1 依赖管理机制</a></li>
<li><a href="#132-%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E6%9C%BA%E5%88%B6">1.3.2 自动配置机制</a><ul>
<li><a href="#1321-%E5%88%9D%E6%AD%A5%E7%90%86%E8%A7%A3">1.3.2.1 初步理解</a></li>
<li><a href="#1322-%E5%AE%8C%E6%95%B4%E6%B5%81%E7%A8%8B">1.3.2.2 完整流程</a></li>
<li><a href="#1323-%E5%A6%82%E4%BD%95%E5%AD%A6%E5%A5%BD-springboot">1.3.2.3 如何学好 SpringBoot</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#14-%E6%A0%B8%E5%BF%83%E6%8A%80%E8%83%BD">1.4 核心技能</a><ul>
<li><a href="#141-%E5%B8%B8%E7%94%A8%E6%B3%A8%E8%A7%A3">1.4.1 常用注解</a><ul>
<li><a href="#1411-%E7%BB%84%E4%BB%B6%E6%B3%A8%E5%86%8C">1.4.1.1 组件注册</a></li>
<li><a href="#1412-%E6%9D%A1%E4%BB%B6%E6%B3%A8%E8%A7%A3">1.4.1.2 条件注解</a></li>
<li><a href="#1413-%E5%B1%9E%E6%80%A7%E7%BB%91%E5%AE%9A">1.4.1.3 属性绑定</a></li>
</ul>
</li>
<li><a href="#142-yaml-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6">1.4.2 YAML 配置文件</a><ul>
<li><a href="#1421-%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95">1.4.2.1. 基本语法</a></li>
<li><a href="#1422-%E7%A4%BA%E4%BE%8B">1.4.2.2 示例</a></li>
<li><a href="#1423-%E7%BB%86%E8%8A%82">1.4.2.3 细节</a></li>
<li><a href="#1424-%E5%B0%8F%E6%8A%80%E5%B7%A7lombok">1.4.2.4. 小技巧：lombok</a></li>
</ul>
</li>
<li><a href="#143-%E6%97%A5%E5%BF%97%E9%85%8D%E7%BD%AE">1.4.3 日志配置</a><ul>
<li><a href="#1431-%E7%AE%80%E4%BB%8B">1.4.3.1 简介</a></li>
<li><a href="#1432-%E6%97%A5%E5%BF%97%E6%A0%BC%E5%BC%8F">1.4.3.2 日志格式</a></li>
<li><a href="#1433-%E8%AE%B0%E5%BD%95%E6%97%A5%E5%BF%97">1.4.3.3 记录日志</a></li>
<li><a href="#1434-%E6%97%A5%E5%BF%97%E7%BA%A7%E5%88%AB">1.4.3.4 日志级别</a></li>
<li><a href="#1435-%E6%97%A5%E5%BF%97%E5%88%86%E7%BB%84">1.4.3.5 日志分组</a></li>
<li><a href="#1436-%E6%96%87%E4%BB%B6%E8%BE%93%E5%87%BA">1.4.3.6 文件输出</a></li>
<li><a href="#1437-%E6%96%87%E4%BB%B6%E5%BD%92%E6%A1%A3%E4%B8%8E%E6%BB%9A%E5%8A%A8%E5%88%87%E5%89%B2">1.4.3.7 文件归档与滚动切割</a></li>
<li><a href="#1438-%E8%87%AA%E5%AE%9A%E4%B9%89%E9%85%8D%E7%BD%AE">1.4.3.8 自定义配置</a></li>
<li><a href="#1439-%E5%88%87%E6%8D%A2%E6%97%A5%E5%BF%97%E7%BB%84%E5%90%88">1.4.3.9 切换日志组合</a></li>
<li><a href="#14310-%E6%9C%80%E4%BD%B3%E5%AE%9E%E6%88%98">1.4.3.10 最佳实战</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#%E7%AC%AC-2-%E7%AB%A0-springboot3-web-%E5%BC%80%E5%8F%91">第 2 章 SpringBoot3-Web 开发</a><ul>
<li><a href="#21-webmvcautoconfiguration-%E5%8E%9F%E7%90%86">2.1 WebMvcAutoConfiguration 原理</a><ul>
<li><a href="#211-%E7%94%9F%E6%95%88%E6%9D%A1%E4%BB%B6">2.1.1 生效条件</a></li>
<li><a href="#212-%E6%95%88%E6%9E%9C">2.1.2 效果</a></li>
<li><a href="#213-webmvcconfigurer-%E6%8E%A5%E5%8F%A3">2.1.3 WebMvcConfigurer 接口</a></li>
<li><a href="#214-%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E8%A7%84%E5%88%99%E6%BA%90%E7%A0%81">2.1.4 静态资源规则源码</a></li>
<li><a href="#215-enablewebmvcconfiguration-%E6%BA%90%E7%A0%81">2.1.5 EnableWebMvcConfiguration 源码</a></li>
<li><a href="#216-%E4%B8%BA%E4%BB%80%E4%B9%88%E5%AE%B9%E5%99%A8%E4%B8%AD%E6%94%BE%E4%B8%80%E4%B8%AA-webmvcconfigurer-%E5%B0%B1%E8%83%BD%E9%85%8D%E7%BD%AE%E5%BA%95%E5%B1%82%E8%A1%8C%E4%B8%BA">2.1.6 为什么容器中放一个 WebMvcConfigurer 就能配置底层行为</a></li>
<li><a href="#217-webmvcconfigurationsupport">2.1.7 WebMvcConfigurationSupport</a></li>
</ul>
</li>
<li><a href="#22-web-%E5%9C%BA%E6%99%AF">2.2 Web 场景</a><ul>
<li><a href="#221-%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE">2.2.1 自动配置</a></li>
<li><a href="#222-%E9%BB%98%E8%AE%A4%E6%95%88%E6%9E%9C">2.2.2 默认效果</a></li>
</ul>
</li>
<li><a href="#23-%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90">2.3 静态资源</a><ul>
<li><a href="#231-%E9%BB%98%E8%AE%A4%E8%A7%84%E5%88%99">2.3.1 默认规则</a><ul>
<li><a href="#2311-%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E6%98%A0%E5%B0%84">2.3.1.1 静态资源映射</a></li>
<li><a href="#2312-%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E7%BC%93%E5%AD%98">2.3.1.2 静态资源缓存</a></li>
<li><a href="#2313-%E6%AC%A2%E8%BF%8E%E9%A1%B5">2.3.1.3 欢迎页</a></li>
<li><a href="#2314-favicon">2.3.1.4 Favicon</a></li>
<li><a href="#2315-%E7%BC%93%E5%AD%98%E5%AE%9E%E9%AA%8C">2.3.1.5 缓存实验</a></li>
</ul>
</li>
<li><a href="#232-%E8%87%AA%E5%AE%9A%E4%B9%89%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E8%A7%84%E5%88%99">2.3.2 自定义静态资源规则</a><ul>
<li><a href="#2321-%E9%85%8D%E7%BD%AE%E6%96%B9%E5%BC%8F">2.3.2.1 配置方式</a></li>
<li><a href="#2322-%E4%BB%A3%E7%A0%81%E6%96%B9%E5%BC%8F">2.3.2.2 代码方式</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#24-%E8%B7%AF%E5%BE%84%E5%8C%B9%E9%85%8D">2.4 路径匹配</a><ul>
<li><a href="#241-ant-%E9%A3%8E%E6%A0%BC%E8%B7%AF%E5%BE%84%E7%94%A8%E6%B3%95">2.4.1 Ant 风格路径用法</a></li>
<li><a href="#242-%E6%A8%A1%E5%BC%8F%E5%88%87%E6%8D%A2">2.4.2 模式切换</a></li>
</ul>
</li>
<li><a href="#25-%E5%86%85%E5%AE%B9%E5%8D%8F%E5%95%86">2.5 内容协商</a><ul>
<li><a href="#251-%E5%A4%9A%E7%AB%AF%E5%86%85%E5%AE%B9%E9%80%82%E9%85%8D">2.5.1 多端内容适配</a><ul>
<li><a href="#2511-%E9%BB%98%E8%AE%A4%E8%A7%84%E5%88%99">2.5.1.1 默认规则</a></li>
<li><a href="#2512-%E6%95%88%E6%9E%9C%E6%BC%94%E7%A4%BA">2.5.1.2 效果演示</a></li>
<li><a href="#2513-%E9%85%8D%E7%BD%AE%E5%8D%8F%E5%95%86%E8%A7%84%E5%88%99%E4%B8%8E%E6%94%AF%E6%8C%81%E7%B1%BB%E5%9E%8B">2.5.1.3 配置协商规则与支持类型</a></li>
</ul>
</li>
<li><a href="#252-%E8%87%AA%E5%AE%9A%E4%B9%89%E5%86%85%E5%AE%B9%E8%BF%94%E5%9B%9E">2.5.2 自定义内容返回</a><ul>
<li><a href="#2521-%E5%A2%9E%E5%8A%A0-yaml-%E8%BF%94%E5%9B%9E%E6%94%AF%E6%8C%81">2.5.2.1 增加 yaml 返回支持</a></li>
<li><a href="#2522-%E6%80%9D%E8%80%83%E5%A6%82%E4%BD%95%E5%A2%9E%E5%8A%A0%E5%85%B6%E4%BB%96">2.5.2.2 思考：如何增加其他</a></li>
<li><a href="#2523-httpmessageconverter-%E7%9A%84%E7%A4%BA%E4%BE%8B%E5%86%99%E6%B3%95">2.5.2.3 HttpMessageConverter 的示例写法</a></li>
</ul>
</li>
<li><a href="#253-%E5%86%85%E5%AE%B9%E5%8D%8F%E5%95%86%E5%8E%9F%E7%90%86-httpmessageconverter">2.5.3 内容协商原理 HttpMessageConverter</a><ul>
<li><a href="#2531-responsebody-%E7%94%B1-httpmessageconverter-%E5%A4%84%E7%90%86">2.5.3.1 @ResponseBody 由 HttpMessageConverter 处理</a></li>
<li><a href="#2532-webmvcautoconfiguration-%E6%8F%90%E4%BE%9B%E5%87%A0%E7%A7%8D%E9%BB%98%E8%AE%A4-httpmessageconverters">2.5.3.2 WebMvcAutoConfiguration 提供几种默认 HttpMessageConverters</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#26-%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E">2.6 模板引擎</a><ul>
<li><a href="#261-thymeleaf-%E6%95%B4%E5%90%88">2.6.1 Thymeleaf 整合</a></li>
<li><a href="#262-%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95">2.6.2 基础语法</a><ul>
<li><a href="#2621-%E6%A0%B8%E5%BF%83%E7%94%A8%E6%B3%95">2.6.2.1 核心用法</a></li>
<li><a href="#2622-%E8%AF%AD%E6%B3%95%E7%A4%BA%E4%BE%8B">2.6.2.2 语法示例</a></li>
<li><a href="#2623-%E5%B1%9E%E6%80%A7%E8%AE%BE%E7%BD%AE">2.6.2.3 属性设置</a></li>
<li><a href="#2624-%E9%81%8D%E5%8E%86">2.6.2.4 遍历</a></li>
<li><a href="#2625-%E5%88%A4%E6%96%AD">2.6.2.5 判断</a></li>
<li><a href="#2626-%E5%B1%9E%E6%80%A7%E4%BC%98%E5%85%88%E7%BA%A7">2.6.2.6 属性优先级</a></li>
<li><a href="#2627-%E8%A1%8C%E5%86%85%E5%86%99%E6%B3%95">2.6.2.7 行内写法</a></li>
<li><a href="#2628-%E5%8F%98%E9%87%8F%E9%80%89%E6%8B%A9">2.6.2.8 变量选择</a></li>
<li><a href="#2629-%E6%A8%A1%E6%9D%BF%E5%B8%83%E5%B1%80">2.6.2.9 模板布局</a></li>
<li><a href="#26210-devtools">2.6.2.10 devtools</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#27-%E5%9B%BD%E9%99%85%E5%8C%96">2.7 国际化</a></li>
<li><a href="#28-%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86">2.8 错误处理</a><ul>
<li><a href="#281-%E9%BB%98%E8%AE%A4%E6%9C%BA%E5%88%B6">2.8.1 默认机制</a></li>
<li><a href="#282-%E8%87%AA%E5%AE%9A%E4%B9%89%E9%94%99%E8%AF%AF%E5%93%8D%E5%BA%94">2.8.2 自定义错误响应</a><ul>
<li><a href="#2821-%E8%87%AA%E5%AE%9A%E4%B9%89-json-%E5%93%8D%E5%BA%94">2.8.2.1 自定义 json 响应</a></li>
<li><a href="#2822-%E8%87%AA%E5%AE%9A%E4%B9%89%E9%A1%B5%E9%9D%A2%E5%93%8D%E5%BA%94">2.8.2.2 自定义页面响应</a></li>
</ul>
</li>
<li><a href="#283-%E6%9C%80%E4%BD%B3%E5%AE%9E%E6%88%98">2.8.3 最佳实战</a></li>
</ul>
</li>
<li><a href="#29-%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%AE%B9%E5%99%A8">2.9 嵌入式容器</a><ul>
<li><a href="#291-%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%8E%9F%E7%90%86">2.9.1 自动配置原理</a></li>
<li><a href="#292-%E8%87%AA%E5%AE%9A%E4%B9%89">2.9.2 自定义</a></li>
<li><a href="#293-%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5">2.9.3 最佳实践</a></li>
</ul>
</li>
<li><a href="#210-%E5%85%A8%E9%9D%A2%E6%8E%A5%E7%AE%A1-springmvc">2.10 全面接管 SpringMVC</a><ul>
<li><a href="#2101-webmvcautoconfiguration-%E5%88%B0%E5%BA%95%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E4%BA%86%E5%93%AA%E4%BA%9B%E8%A7%84%E5%88%99">2.10.1 WebMvcAutoConfiguration 到底自动配置了哪些规则</a></li>
<li><a href="#2102-enablewebmvc-%E7%A6%81%E7%94%A8%E9%BB%98%E8%AE%A4%E8%A1%8C%E4%B8%BA">2.10.2 @EnableWebMvc 禁用默认行为</a></li>
<li><a href="#2103-webmvcconfigurer-%E5%8A%9F%E8%83%BD">2.10.3 WebMvcConfigurer 功能</a></li>
</ul>
</li>
<li><a href="#211-%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5">2.11 最佳实践</a><ul>
<li><a href="#2111-%E4%B8%89%E7%A7%8D%E6%96%B9%E5%BC%8F">2.11.1 三种方式</a></li>
<li><a href="#2112-%E4%B8%A4%E7%A7%8D%E6%A8%A1%E5%BC%8F">2.11.2 两种模式</a></li>
</ul>
</li>
<li><a href="#212-web-%E6%96%B0%E7%89%B9%E6%80%A7">2.12 Web 新特性</a><ul>
<li><a href="#2121-problemdetails">2.12.1 Problemdetails</a></li>
<li><a href="#2122-%E5%87%BD%E6%95%B0%E5%BC%8F-web">2.12.2 函数式 Web</a><ul>
<li><a href="#21221-%E5%9C%BA%E6%99%AF">2.12.2.1 场景</a></li>
<li><a href="#21222-%E6%A0%B8%E5%BF%83%E7%B1%BB">2.12.2.2 核心类</a></li>
<li><a href="#21223-%E7%A4%BA%E4%BE%8B">2.12.2.3 示例</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#%E7%AC%AC-3-%E7%AB%A0-springboot3-%E6%95%B0%E6%8D%AE%E8%AE%BF%E9%97%AE">第 3 章 SpringBoot3-数据访问</a><ul>
<li><a href="#31-%E5%88%9B%E5%BB%BA-ssm-%E6%95%B4%E5%90%88%E9%A1%B9%E7%9B%AE">3.1 创建 SSM 整合项目</a></li>
<li><a href="#32-%E9%85%8D%E7%BD%AE%E6%95%B0%E6%8D%AE%E6%BA%90">3.2 配置数据源</a></li>
<li><a href="#33-%E9%85%8D%E7%BD%AE-mybatis">3.3 配置 MyBatis</a></li>
<li><a href="#34-crud-%E7%BC%96%E5%86%99">3.4 CRUD 编写</a></li>
<li><a href="#35-%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%8E%9F%E7%90%86">3.5 自动配置原理</a></li>
<li><a href="#36-%E5%BF%AB%E9%80%9F%E5%AE%9A%E4%BD%8D%E7%94%9F%E6%95%88%E7%9A%84%E9%85%8D%E7%BD%AE">3.6 快速定位生效的配置</a></li>
<li><a href="#37-%E6%89%A9%E5%B1%95%E6%95%B4%E5%90%88%E5%85%B6%E4%BB%96%E6%95%B0%E6%8D%AE%E6%BA%90">3.7 扩展：整合其他数据源</a><ul>
<li><a href="#371-druid-%E6%95%B0%E6%8D%AE%E6%BA%90">3.7.1 Druid 数据源</a></li>
</ul>
</li>
<li><a href="#38-%E9%99%84%E5%BD%95%E7%A4%BA%E4%BE%8B%E6%95%B0%E6%8D%AE%E5%BA%93">3.8 附录：示例数据库</a></li>
</ul>
</li>
<li><a href="#%E7%AC%AC-4-%E7%AB%A0-springboot3-%E5%9F%BA%E7%A1%80%E7%89%B9%E6%80%A7">第 4 章 SpringBoot3-基础特性</a><ul>
<li><a href="#41-springapplication">4.1 SpringApplication</a><ul>
<li><a href="#411-%E8%87%AA%E5%AE%9A%E4%B9%89-banner">4.1.1 自定义 banner</a></li>
<li><a href="#412-%E8%87%AA%E5%AE%9A%E4%B9%89-springapplication">4.1.2 自定义 SpringApplication</a></li>
<li><a href="#413-fluentbuilder-api">4.1.3 FluentBuilder API</a></li>
</ul>
</li>
<li><a href="#42-profiles">4.2 Profiles</a><ul>
<li><a href="#421-%E4%BD%BF%E7%94%A8">4.2.1 使用</a><ul>
<li><a href="#4211-%E6%8C%87%E5%AE%9A%E7%8E%AF%E5%A2%83">4.2.1.1 指定环境</a></li>
<li><a href="#4212-%E7%8E%AF%E5%A2%83%E6%BF%80%E6%B4%BB">4.2.1.2 环境激活</a></li>
<li><a href="#4213-%E7%8E%AF%E5%A2%83%E5%8C%85%E5%90%AB">4.2.1.3 环境包含</a></li>
</ul>
</li>
<li><a href="#422-profile-%E5%88%86%E7%BB%84">4.2.2 Profile 分组</a></li>
<li><a href="#423-profile-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6">4.2.3 Profile 配置文件</a></li>
</ul>
</li>
<li><a href="#43-%E5%A4%96%E9%83%A8%E5%8C%96%E9%85%8D%E7%BD%AE">4.3 外部化配置</a><ul>
<li><a href="#431-%E9%85%8D%E7%BD%AE%E4%BC%98%E5%85%88%E7%BA%A7">4.3.1 配置优先级</a></li>
<li><a href="#432-%E5%A4%96%E9%83%A8%E9%85%8D%E7%BD%AE">4.3.2 外部配置</a></li>
<li><a href="#433-%E5%AF%BC%E5%85%A5%E9%85%8D%E7%BD%AE">4.3.3 导入配置</a></li>
<li><a href="#434-%E5%B1%9E%E6%80%A7%E5%8D%A0%E4%BD%8D%E7%AC%A6">4.3.4 属性占位符</a></li>
</ul>
</li>
<li><a href="#44-%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95-junit5">4.4 单元测试 JUnit5</a><ul>
<li><a href="#441-%E6%95%B4%E5%90%88">4.4.1 整合</a></li>
<li><a href="#442-%E6%B5%8B%E8%AF%95">4.4.2 测试</a><ul>
<li><a href="#4421-%E7%BB%84%E4%BB%B6%E6%B5%8B%E8%AF%95">4.4.2.1 组件测试</a></li>
<li><a href="#4422-%E6%B3%A8%E8%A7%A3">4.4.2.2 注解</a></li>
<li><a href="#4423-%E6%96%AD%E8%A8%80">4.4.2.3 断言</a></li>
<li><a href="#4424-%E5%B5%8C%E5%A5%97%E6%B5%8B%E8%AF%95">4.4.2.4 嵌套测试</a></li>
<li><a href="#4425-%E5%8F%82%E6%95%B0%E5%8C%96%E6%B5%8B%E8%AF%95">4.4.2.5 参数化测试</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#%E7%AC%AC-5-%E7%AB%A0-springboot3-%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86">第 5 章 SpringBoot3-核心原理</a><ul>
<li><a href="#51-%E4%BA%8B%E4%BB%B6%E5%92%8C%E7%9B%91%E5%90%AC%E5%99%A8">5.1 事件和监听器</a><ul>
<li><a href="#511-%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E7%9B%91%E5%90%AC">5.1.1 生命周期监听</a><ul>
<li><a href="#5111-%E7%9B%91%E5%90%AC%E5%99%A8-springapplicationrunlistener">5.1.1.1 监听器 SpringApplicationRunListener</a></li>
<li><a href="#5112-%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%85%A8%E6%B5%81%E7%A8%8B">5.1.1.2 生命周期全流程</a></li>
</ul>
</li>
<li><a href="#512-%E4%BA%8B%E4%BB%B6%E8%A7%A6%E5%8F%91%E6%97%B6%E6%9C%BA">5.1.2 事件触发时机</a><ul>
<li><a href="#5121-%E5%90%84%E7%A7%8D%E5%9B%9E%E8%B0%83%E7%9B%91%E5%90%AC%E5%99%A8">5.1.2.1 各种回调监听器</a></li>
<li><a href="#5122-%E5%AE%8C%E6%95%B4%E8%A7%A6%E5%8F%91%E6%B5%81%E7%A8%8B">5.1.2.2 完整触发流程</a></li>
<li><a href="#5123-springboot-%E4%BA%8B%E4%BB%B6%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91">5.1.2.3 SpringBoot 事件驱动开发</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#52-%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%8E%9F%E7%90%86">5.2 自动配置原理</a><ul>
<li><a href="#521-%E5%85%A5%E9%97%A8%E7%90%86%E8%A7%A3">5.2.1 入门理解</a><ul>
<li><a href="#5211-%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E6%B5%81%E7%A8%8B">5.2.1.1 自动配置流程</a></li>
<li><a href="#5212-spi-%E6%9C%BA%E5%88%B6">5.2.1.2 SPI 机制</a></li>
<li><a href="#5213-%E5%8A%9F%E8%83%BD%E5%BC%80%E5%85%B3">5.2.1.3 功能开关</a></li>
</ul>
</li>
<li><a href="#522-%E8%BF%9B%E9%98%B6%E7%90%86%E8%A7%A3">5.2.2 进阶理解</a><ul>
<li><a href="#5221-springbootapplication">5.2.2.1 @SpringBootApplication</a></li>
<li><a href="#5222-%E5%AE%8C%E6%95%B4%E5%90%AF%E5%8A%A8%E5%8A%A0%E8%BD%BD%E6%B5%81%E7%A8%8B">5.2.2.2 完整启动加载流程</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#53-%E8%87%AA%E5%AE%9A%E4%B9%89-starter">5.3 自定义 starter</a><ul>
<li><a href="#531-%E4%B8%9A%E5%8A%A1%E4%BB%A3%E7%A0%81">5.3.1 业务代码</a></li>
<li><a href="#532-%E5%9F%BA%E6%9C%AC%E6%8A%BD%E5%8F%96">5.3.2 基本抽取</a></li>
<li><a href="#533-%E4%BD%BF%E7%94%A8enablexxx-%E6%9C%BA%E5%88%B6">5.3.3 使用@EnableXxx 机制</a></li>
<li><a href="#534-%E5%AE%8C%E5%85%A8%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE">5.3.4 完全自动配置</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- /code_chunk_output -->

<h1 id="一、Spring-Boot-3-核心特性"><a href="#一、Spring-Boot-3-核心特性" class="headerlink" title="一、Spring Boot 3-核心特性"></a>一、Spring Boot 3-核心特性</h1><h2 id="第-1-章-SpringBoot3-快速入门"><a href="#第-1-章-SpringBoot3-快速入门" class="headerlink" title="第 1 章 SpringBoot3-快速入门"></a>第 1 章 SpringBoot3-快速入门</h2><h3 id="1-1-简介"><a href="#1-1-简介" class="headerlink" title="1.1 简介"></a>1.1 简介</h3><h4 id="1-1-1-前置知识"><a href="#1-1-1-前置知识" class="headerlink" title="1.1.1 前置知识"></a>1.1.1 前置知识</h4><ul>
<li><p>Java17</p>
</li>
<li><p>Spring、SpringMVC、MyBatis</p>
</li>
<li><p>Maven、IDEA</p>
</li>
</ul>
<h4 id="1-1-2-环境要求"><a href="#1-1-2-环境要求" class="headerlink" title="1.1.2 环境要求"></a>1.1.2 环境要求</h4><table>
<thead>
<tr>
<th><strong>环境&amp;工具</strong></th>
<th><strong>版本</strong></th>
</tr>
</thead>
<tbody><tr>
<td>SpringBoot</td>
<td>3.1.3+</td>
</tr>
<tr>
<td>IDEA</td>
<td>2022.3.3+</td>
</tr>
<tr>
<td>Java</td>
<td>17+</td>
</tr>
<tr>
<td>Maven</td>
<td>3.8.1+</td>
</tr>
<tr>
<td>Tomcat</td>
<td>10.1.12+</td>
</tr>
<tr>
<td>Servlet</td>
<td>5.0.0+</td>
</tr>
<tr>
<td>GraalVM Community</td>
<td>22.3+</td>
</tr>
<tr>
<td>Native Build Tools</td>
<td>0.9.19+</td>
</tr>
</tbody></table>
<h4 id="1-1-3-SpringBoot-是什么"><a href="#1-1-3-SpringBoot-是什么" class="headerlink" title="1.1.3 SpringBoot 是什么"></a>1.1.3 SpringBoot 是什么</h4><p>SpringBoot 帮我们简单、快速地创建一个独立的、生产级别的 <strong>Spring 应用</strong> <strong>（说明：SpringBoot 底层是 Spring）</strong>。</p>
<p>大多数 SpringBoot 应用只需要编写少量配置即可快速整合 Spring 平台以及第三方技术。</p>
<p><strong>特性</strong>：</p>
<ul>
<li><p><code>快速创建</code>独立 Spring 应用。</p>
<ul>
<li>SSM：导包、配置、启动运行。</li>
</ul>
</li>
<li><p>直接<code>嵌入</code> Tomcat、Jetty 或 Undertow（无需部署 war 包）【Servlet 容器】。</p>
<ul>
<li><p>Linux、Java、Tomcat、MySQL：war 放到 Tomcat 的 webapps 下。</p>
</li>
<li><p>jar、Java 环境：java -jar。</p>
</li>
</ul>
</li>
<li><p><strong>重点</strong>：提供可选的 <code>starter</code>，简化应用<strong>整合</strong>。</p>
<ul>
<li><p><strong>场景启动器（starter）</strong>：web、json、邮件、oss（对象存储）、异步、定时任务、缓存......</p>
</li>
<li><p>导很多包，控制好版本。</p>
</li>
<li><p>为每一种场景准备了一个依赖：<strong>web-starter</strong>、<strong>mybatis-starter</strong>。</p>
</li>
</ul>
</li>
<li><p><strong>重点</strong>：<code>按需自动配置</code> Spring 以及第三方库。</p>
<ul>
<li><p>如果这些场景要使用（生效）。这个场景的所有配置都会自动配置好。</p>
</li>
<li><p><strong>约定大于配置</strong>：每个场景都有很多默认配置。</p>
</li>
<li><p>自定义：配置文件中修改几项就可以。</p>
</li>
</ul>
</li>
<li><p>提供<code>生产级特性</code>：如监控指标、健康检查、外部化配置等。</p>
<ul>
<li>监控指标、健康检查（k8s）、外部化配置。</li>
</ul>
</li>
<li><p>无代码生成、<code>无 xml</code>。</p>
</li>
</ul>
<p>总结：简化开发，简化配置，简化整合，简化部署，简化监控，简化运维。</p>
<h3 id="1-2-快速体验"><a href="#1-2-快速体验" class="headerlink" title="1.2 快速体验"></a>1.2 快速体验</h3><blockquote>
<p>场景：浏览器发送 &#x2F;hello 请求，返回”Hello, Spring Boot 3!”</p>
</blockquote>
<h4 id="1-2-1-开发流程"><a href="#1-2-1-开发流程" class="headerlink" title="1.2.1 开发流程"></a>1.2.1 开发流程</h4><h5 id="1-2-1-1-创建项目"><a href="#1-2-1-1-创建项目" class="headerlink" title="1.2.1.1 创建项目"></a>1.2.1.1 创建项目</h5><p>maven 项目</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 所有 Spring Boot 项目都必须继承自 spring-boot-starter-parent --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="1-2-1-2-导入场景"><a href="#1-2-1-2-导入场景" class="headerlink" title="1.2.1.2 导入场景"></a>1.2.1.2 导入场景</h5><p>场景启动器</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Web 开发的场景启动器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="1-2-1-3-主程序"><a href="#1-2-1-3-主程序" class="headerlink" title="1.2.1.3 主程序"></a>1.2.1.3 主程序</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.myxh.springboot;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> MYXH</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2023/9/11</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 启动 SpringBoot 项目的主入口程序</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">// 这是一个 SpringBoot 应用</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainApplication</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span></span><br><span class="line">    &#123;</span><br><span class="line">       SpringApplication.run(MainApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="1-2-1-4-业务"><a href="#1-2-1-4-业务" class="headerlink" title="1.2.1.4 业务"></a>1.2.1.4 业务</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.myxh.springboot.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> MYXH</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2023/9/11</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloController</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/hello&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">hello</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Hello, Spring Boot 3!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="1-2-1-5-测试"><a href="#1-2-1-5-测试" class="headerlink" title="1.2.1.5 测试"></a>1.2.1.5 测试</h5><p>默认启动访问：localhost:8080</p>
<h5 id="1-2-1-6-打包"><a href="#1-2-1-6-打包" class="headerlink" title="1.2.1.6 打包"></a>1.2.1.6 打包</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- SpringBoot 应用打包插件--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>mvn clean package</code> 把项目打成可执行的 jar 包。</p>
<p><code>java -jar boot3-01-demo-1.0-SNAPSHOT.jar</code> 启动项目。</p>
<h4 id="1-2-2-特性小结"><a href="#1-2-2-特性小结" class="headerlink" title="1.2.2 特性小结"></a>1.2.2 特性小结</h4><h5 id="1-2-2-1-简化整合"><a href="#1-2-2-1-简化整合" class="headerlink" title="1.2.2.1 简化整合"></a>1.2.2.1 简化整合</h5><p>导入相关的场景，拥有相关的功能的场景启动器。</p>
<p>默认支持的所有场景：<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/current/reference/html/using.html#using.build-systems.starters">https://docs.spring.io/spring-boot/docs/current/reference/html/using.html#using.build-systems.starters</a></p>
<ul>
<li><p>官方提供的场景：命名为 <code>spring-boot-starter-*</code>。</p>
</li>
<li><p>第三方提供场景：命名为 <code>*-spring-boot-starter</code>。</p>
</li>
</ul>
<p>场景一导入，万物皆就绪。</p>
<h5 id="1-2-2-2-简化开发"><a href="#1-2-2-2-简化开发" class="headerlink" title="1.2.2.2 简化开发"></a>1.2.2.2 简化开发</h5><p>无需编写任何配置，直接开发业务。</p>
<h5 id="1-2-2-3-简化配置"><a href="#1-2-2-3-简化配置" class="headerlink" title="1.2.2.3 简化配置"></a>1.2.2.3 简化配置</h5><p><code>application.properties</code>：</p>
<ul>
<li><p>集中式管理配置，只需要修改这个文件就行。</p>
</li>
<li><p>配置基本都有默认值。</p>
</li>
<li><p>能写的所有配置都在：<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/current/reference/html/application-properties.html#appendix.application-properties">https://docs.spring.io/spring-boot/docs/current/reference/html/application-properties.html#appendix.application-properties</a></p>
</li>
</ul>
<h5 id="1-2-2-4-简化部署"><a href="#1-2-2-4-简化部署" class="headerlink" title="1.2.2.4 简化部署"></a>1.2.2.4 简化部署</h5><p>打包为可执行的 jar 包。</p>
<p>Linux 服务器上有 Java 环境。</p>
<h5 id="1-2-2-5-简化运维"><a href="#1-2-2-5-简化运维" class="headerlink" title="1.2.2.5 简化运维"></a>1.2.2.5 简化运维</h5><p>修改配置（外部放一个 application.properties 文件）、监控、健康检查......</p>
<h5 id="1-2-2-6-Spring-Initializr-创建向导"><a href="#1-2-2-6-Spring-Initializr-创建向导" class="headerlink" title="1.2.2.6 Spring Initializr 创建向导"></a>1.2.2.6 Spring Initializr 创建向导</h5><p>一键创建好整个项目结构。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://reggie-xiamou.oss-cn-beijing.aliyuncs.com/img/5b9357cc1d3e46f5be746110ae5b098c.png" alt="Spring Initializr 创建向导"></p>
<h3 id="1-3-应用分析"><a href="#1-3-应用分析" class="headerlink" title="1.3 应用分析"></a>1.3 应用分析</h3><h4 id="1-3-1-依赖管理机制"><a href="#1-3-1-依赖管理机制" class="headerlink" title="1.3.1 依赖管理机制"></a>1.3.1 依赖管理机制</h4><p>思考：</p>
<p>1、为什么导入 <code>starter-web </code>所有相关依赖都导入进来？</p>
<ul>
<li><p>开发什么场景，导入什么<strong>场景启动器</strong>。</p>
</li>
<li><p><strong>maven 依赖传递原则</strong>。<strong>A-B-C：A 就拥有 B 和 C</strong>。</p>
</li>
<li><p>导入场景启动器，场景启动器自动把这个场景的所有核心依赖全部导入进来。</p>
</li>
</ul>
<p>2、为什么版本号都不用写？</p>
<ul>
<li><p>每个 boot 项目都有一个父项目 <code>spring-boot-starter-parent</code>。</p>
</li>
<li><p>parent 的父项目是 <code>spring-boot-dependencies</code>。</p>
</li>
<li><p>父项目<strong>版本仲裁中心</strong>，把所有常见的 jar 的依赖版本都声明好了。</p>
</li>
<li><p>比如：<code>mysql-connector-j</code>。</p>
</li>
</ul>
<p>3、自定义版本号。</p>
<ul>
<li><p>利用 maven 的就近原则。</p>
<ul>
<li><p>直接在当前项目 <code>properties</code> 标签中声明父项目用的版本属性的 key。</p>
</li>
<li><p>直接在<strong>导入依赖的时候声明版本</strong>。</p>
</li>
</ul>
</li>
</ul>
<p>4、第三方的 jar 包。</p>
<ul>
<li><p>boot 父项目没有管理的需要自行声明好。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.16<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://reggie-xiamou.oss-cn-beijing.aliyuncs.com/img/2083af5fc724496798aee59d863549ae.png" alt="依赖管理机制"></p>
<h4 id="1-3-2-自动配置机制"><a href="#1-3-2-自动配置机制" class="headerlink" title="1.3.2 自动配置机制"></a>1.3.2 自动配置机制</h4><h5 id="1-3-2-1-初步理解"><a href="#1-3-2-1-初步理解" class="headerlink" title="1.3.2.1 初步理解"></a>1.3.2.1 初步理解</h5><ul>
<li><p><strong>自动配置</strong>的 Tomcat、SpringMVC 等。</p>
<ul>
<li><p><strong>导入场景</strong>，容器中就会自动配置好这个场景的核心组件。</p>
</li>
<li><p>以前：DispatcherServlet、ViewResolver、CharacterEncodingFilter…</p>
</li>
<li><p>现在：自动配置好的这些组件。</p>
</li>
<li><p>验证：<strong>容器中有了什么组件，就具有什么功能</strong>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.myxh.springboot;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* <span class="doctag">@author</span> MYXH</span></span><br><span class="line"><span class="comment">* <span class="doctag">@date</span> 2023/9/11</span></span><br><span class="line"><span class="comment">* <span class="doctag">@description</span> 启动 SpringBoot 项目的主入口程序</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// 主程序：com.myxh.springboot</span></span><br><span class="line"><span class="comment">// @SpringBootConfiguration</span></span><br><span class="line"><span class="comment">// @EnableAutoConfiguration</span></span><br><span class="line"><span class="comment">// @ComponentScan(&quot;com.myxh.springboot&quot;)</span></span><br><span class="line"><span class="comment">// @SpringBootApplication(scanBasePackages = &quot;com.myxh.springboot&quot;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 这是一个 SpringBoot 应用</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainApplication</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// Java10：局部变量类型的自动推断</span></span><br><span class="line">        <span class="type">var</span> <span class="variable">ioc</span> <span class="operator">=</span> SpringApplication.run(MainApplication.class, args);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1、获取容器中所有组件的名字</span></span><br><span class="line">        String[] beanNames = ioc.getBeanDefinitionNames();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2、挨个遍历</span></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        dispatcherServlet、beanNameViewResolver、characterEncodingFilter、multipartResolver</span></span><br><span class="line"><span class="comment">        SpringBoot 把以前配置的核心组件现在都给自动配置好了</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        <span class="keyword">for</span> (String beanName : beanNames)</span><br><span class="line">        &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;beanName = &quot;</span> + beanName);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>默认的包扫描规则</strong>。</p>
<ul>
<li><p><code>@SpringBootApplication</code> 标注的类就是主程序类。</p>
</li>
<li><p><strong>SpringBoot 只会扫描主程序所在的包及其下面的子包，自动的 component-scan 功能</strong>。</p>
</li>
<li><p><strong>自定义扫描路径</strong>。</p>
<ul>
<li><p>@SpringBootApplication(scanBasePackages &#x3D; “com.myxh.springboot”)</p>
</li>
<li><p><code>@ComponentScan(&quot;com.myxh.springboot&quot;)</code> 直接指定扫描的路径。</p>
</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>配置默认值</strong>。</p>
<ul>
<li><p><strong>配置文件</strong>的所有配置项是和某个<strong>类的对象</strong>值进行一一绑定的。</p>
</li>
<li><p>绑定了配置文件中每一项值的类：<strong>属性类</strong>。</p>
</li>
<li><p>比如：</p>
<ul>
<li><p><code>ServerProperties</code> 绑定了所有 Tomcat 服务器有关的配置。</p>
</li>
<li><p><code>MultipartProperties</code> 绑定了所有文件上传相关的配置。</p>
</li>
<li><p>参照官方文档 <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/current/reference/html/application-properties.html#appendix.application-properties.server%EF%BC%8C">https://docs.spring.io/spring-boot/docs/current/reference/html/application-properties.html#appendix.application-properties.server，</a> 或者参照绑定的<strong>属性类</strong>。</p>
</li>
</ul>
</li>
</ul>
</li>
<li><p>按需加载自动配置。</p>
<ul>
<li><p>导入场景 <code>spring-boot-starter-web</code>。</p>
</li>
<li><p>场景启动器除了会导入相关功能依赖，导入一个 <code>spring-boot-starter</code>，是所有 <code>starter</code> 的 <code>starter</code>，基础核心 starter。</p>
</li>
<li><p><code>spring-boot-starter</code> 导入了一个包 <code>spring-boot-autoconfigure</code>。包里面都是各种场景的 <code>AutoConfiguration</code> <strong>自动配置类</strong>。</p>
</li>
<li><p>虽然全场景的自动配置都在 <code>spring-boot-autoconfigure</code> 这个包，但是不是全都开启的。</p>
<ul>
<li>导入哪个场景就开启哪个自动配置。</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>总结：导入场景启动器、触发 <code>spring-boot-autoconfigure</code> 这个包的自动配置生效、容器中就会具有相关场景的功能。</p>
<h5 id="1-3-2-2-完整流程"><a href="#1-3-2-2-完整流程" class="headerlink" title="1.3.2.2 完整流程"></a>1.3.2.2 完整流程</h5><blockquote>
<p>思考：</p>
<p>1、<strong>SpringBoot 怎么实现导一个 starter、写一些简单配置，应用就能跑起来，无需关心整合</strong>。</p>
<p>2、为什么 Tomcat 的端口号可以配置在 <strong>application.properties</strong> 中，并且 <strong>Tomcat</strong> 能启动成功？</p>
<p>3、导入场景后哪些<strong>自动配置能生效</strong>？</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://reggie-xiamou.oss-cn-beijing.aliyuncs.com/img/f00f4ee5a99f4d5ea7bc9e6ddda2ccb6.png" alt="完整流程"></p>
<p><strong>自动配置流程细节梳理</strong>：</p>
<p><strong>1</strong>、导入 <code>starter-web</code>：导入了 web 开发场景。</p>
<ul>
<li><p>1、场景启动器导入了相关场景的所有依赖：<code>starter-json</code>、<code>starter-tomcat</code>、<code>springmvc</code>。</p>
</li>
<li><p>2、每个场景启动器都引入了一个 <code>spring-boot-starter</code>，核心场景启动器。</p>
</li>
<li><p>3、<strong>核心场景启动器</strong>引入了 <code>spring-boot-autoconfigure</code> 包。</p>
</li>
<li><p>4、<code>spring-boot-autoconfigure</code> 里面囊括了所有场景的所有配置。</p>
</li>
<li><p>5、只要这个包下的所有类都能生效，那么相当于 SpringBoot 官方写好的整合功能就生效了。</p>
</li>
<li><p>6、SpringBoot 默认却扫描不到 <code>spring-boot-autoconfigure</code> 下写好的所有<strong>配置类</strong>。（这些<strong>配置类</strong>做了整合操作），<strong>默认只扫描主程序所在的包</strong>。</p>
</li>
</ul>
<p><strong>2</strong>、<strong>主程序</strong>：<code>@SpringBootApplication</code>。</p>
<ul>
<li><p>1、<code>@SpringBootApplication</code> 由三个注解组成<code>@SpringBootConfiguration</code>、<code>@EnableAutoConfiguration</code>、<code>@ComponentScan</code>。</p>
</li>
<li><p>2、SpringBoot 默认只能扫描自己主程序所在的包及其下面的子包，扫描不到 <code>spring-boot-autoconfigure</code> 包中官方写好的<strong>配置类</strong>。</p>
</li>
<li><p>3、<code>@EnableAutoConfiguration</code>：SpringBoot <strong>开启自动配置的核心</strong>。</p>
<ul>
<li><p>① 是由 <code>@Import(AutoConfigurationImportSelector.class)</code> 提供功能：批量给容器中导入组件。</p>
</li>
<li><p>② SpringBoot 启动会默认加载 146 个配置类。</p>
</li>
<li><p>③ 这 <strong>146 个配置类</strong>来自于 <code>spring-boot-autoconfigure</code> 下 <code>META-INF/spring/org.springframework.boot.autoconfigure.AutoConfiguration.imports</code> 文件指定的。</p>
</li>
<li><p>④ 项目启动的时候利用 @Import 批量导入组件机制把 <code>autoconfigure</code> 包下的 146 <code>xxxAutoConfiguration</code> 类导入进来（<strong>自动配置类</strong>）。</p>
</li>
</ul>
</li>
<li><p>4、按需生效：</p>
<ul>
<li><p>虽然导入了 <code>146</code> 个自动配置，并不是这 <code>146</code> 个自动配置类都能生效。</p>
</li>
<li><p>每一个自动配置类，都有条件注解 <code>@ConditionalOnXxx</code>，只有条件成立，才能生效。</p>
</li>
</ul>
</li>
</ul>
<p><strong>3</strong>、<code>xxxAutoConfiguration</code> <strong>自动配置类</strong>。</p>
<ul>
<li><p>1、<strong>给容器中使用 @Bean 放一堆组件</strong>。</p>
</li>
<li><p>2、每个<strong>自动配置类</strong>都可能有这个注解 <code>@EnableConfigurationProperties(ServerProperties.class)</code>，用来把配置文件中配的指定前缀的属性值封装到 <code>xxxProperties</code> <strong>属性类</strong>中。</p>
</li>
<li><p>3、以 Tomcat 为例：把服务器的所有配置都是以 <code>server</code> 开头的。配置都封装到了属性类中。</p>
</li>
<li><p>4、给<strong>容器</strong>中放的所有<strong>组件</strong>的一些<strong>核心参数</strong>，都来自于 <code>xxxProperties</code>。<code>xxxProperties</code> <strong>都是和配置文件绑定</strong>。</p>
</li>
<li><p>5、<strong>只需要改配置文件的值，核心组件的底层参数都能修改</strong>。</p>
</li>
</ul>
<p><strong>4</strong>、写业务，全程无需关心各种整合（底层这些整合写好了，而且也生效了）。</p>
<p><strong>核心流程总结</strong>：</p>
<p>1、导入 <code>starter</code>，就会导入 <code>autoconfigure</code> 包。</p>
<p>2、<code>autoconfigure</code> 包里面 有一个文件 <code>META-INF/spring/org.springframework.boot.autoconfigure.AutoConfiguration.imports</code>,里面指定的所有启动要加载的自动配置类。</p>
<p>3、@EnableAutoConfiguration 会自动的把上面文件里面写的所有<strong>自动配置类都导入进来</strong>。<strong>xxxAutoConfiguration 是有条件注解进行按需加载</strong>。</p>
<p>4、<code>xxxAutoConfiguration</code> 给容器中导入一堆组件，组件都是从 <code>xxxProperties</code> 中提取属性值。</p>
<p>5、<code>xxxProperties</code> 又是和<strong>配置文件</strong>进行了绑定。</p>
<p><strong>效果</strong>：导入 <code>starter</code>、修改配置文件，就能修改底层行为。</p>
<h5 id="1-3-2-3-如何学好-SpringBoot"><a href="#1-3-2-3-如何学好-SpringBoot" class="headerlink" title="1.3.2.3 如何学好 SpringBoot"></a>1.3.2.3 如何学好 SpringBoot</h5><p>框架的框架、底层基于 Spring。能调整每一个场景的底层行为。100%项目一定会用到<strong>底层自定义</strong>。</p>
<p>摄影：</p>
<ul>
<li><p>傻瓜：自动配置好。</p>
</li>
<li><p><strong>单反</strong>：焦距、光圈、快门、感光度......</p>
</li>
<li><p>傻瓜+<strong>单反</strong>：</p>
</li>
</ul>
<p>1、理解<strong>自动配置原理</strong>。</p>
<ul>
<li>① <strong>导入 starter</strong> -&gt; <strong>生效 xxxAutoConfiguration</strong> -&gt; <strong>组件</strong> -&gt; <strong>xxxProperties</strong> -&gt; <strong>配置文件</strong>。</li>
</ul>
<p>2、理解<strong>其他框架底层</strong>。</p>
<ul>
<li>① 拦截器。</li>
</ul>
<p>3、可以随时<strong>定制化任何组件</strong>。</p>
<ul>
<li><p>① <strong>配置文件</strong>。</p>
</li>
<li><p>② <strong>自定义组件</strong>。</p>
</li>
</ul>
<p>普通开发：<code>导入 starter</code>，Controller、Service、Mapper、偶尔修改配置文件。</p>
<p><strong>高级开发</strong>：自定义组件、自定义配置、自定义 starter。</p>
<p>核心：</p>
<ul>
<li><p>这个场景自动配置导入了哪些组件，能不能 Autowired 进来使用。</p>
</li>
<li><p>能不能通过修改配置改变组件的一些默认参数。</p>
</li>
<li><p>需不需要自己完全定义这个组件。</p>
</li>
<li><p><strong>场景定制化</strong>。</p>
</li>
</ul>
<p><strong>最佳实战</strong>：</p>
<ul>
<li><p><strong>选场景</strong>，导入到项目。</p>
<ul>
<li><p>官方：starter。</p>
</li>
<li><p>第三方：去仓库搜。</p>
</li>
</ul>
</li>
<li><p><strong>写配置，改配置文件关键项</strong>。</p>
<ul>
<li>数据库参数（连接地址、账号密码......）。</li>
</ul>
</li>
<li><p>分析这个场景导入了<strong>哪些能用的组件</strong>。</p>
<ul>
<li><p><strong>自动装配</strong>这些组件进行后续使用。</p>
</li>
<li><p>不满意 SprngBoot 提供的自动配好的默认组件。</p>
<ul>
<li><p><strong>定制化</strong>。</p>
</li>
<li><p>改配置。</p>
</li>
<li><p>自定义组件。</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>整合 redis：</p>
<ul>
<li><p><strong>选场景</strong>：<code>spring-boot-starter-data-redis</code>。</p>
<ul>
<li>场景 AutoConfiguration 就是这个场景的自动配置类。</li>
</ul>
</li>
<li><p>写配置：</p>
<ul>
<li><p>分析到这个场景的自动配置类开启了哪些属性绑定关系。</p>
</li>
<li><p><code>@EnableConfigurationProperties(RedisProperties.class)</code>。</p>
</li>
<li><p>修改 redis 相关的配置。</p>
</li>
</ul>
</li>
<li><p>分析组件：</p>
<ul>
<li><p>分析到 <code>RedisAutoConfiguration</code> 给容器中放了 <code>StringRedisTemplate</code>。</p>
</li>
<li><p>给业务代码中自动装配 <code>StringRedisTemplate</code>。</p>
</li>
</ul>
</li>
<li><p>定制化：</p>
<ul>
<li><p>修改配置文件。</p>
</li>
<li><p>自定义组件，自己给容器中放一个 <code>StringRedisTemplate</code>。</p>
</li>
</ul>
</li>
</ul>
<h3 id="1-4-核心技能"><a href="#1-4-核心技能" class="headerlink" title="1.4 核心技能"></a>1.4 核心技能</h3><h4 id="1-4-1-常用注解"><a href="#1-4-1-常用注解" class="headerlink" title="1.4.1 常用注解"></a>1.4.1 常用注解</h4><blockquote>
<p>SpringBoot 摒弃 XML 配置方式，改为<strong>全注解驱动</strong>。</p>
</blockquote>
<h5 id="1-4-1-1-组件注册"><a href="#1-4-1-1-组件注册" class="headerlink" title="1.4.1.1 组件注册"></a>1.4.1.1 组件注册</h5><p><strong>@Configuration</strong>、**@SpringBootConfiguration**</p>
<p><strong>@Bean</strong>、**@Scope**</p>
<p><strong>@Controller</strong>、 <strong>@Service</strong>、**@Repository<strong>、</strong>@Component**</p>
<p><strong>@Import</strong></p>
<p><strong>@ComponentScan</strong></p>
<p>步骤：</p>
<p><strong>1</strong>、**@Configuration 编写一个配置类**。</p>
<p><strong>2</strong>、<strong>在配置类中，自定义方法给容器中注册组件。配合@Bean</strong>。</p>
<p><strong>3</strong>、<strong>或使用@Import 导入第三方的组件</strong>。</p>
<h5 id="1-4-1-2-条件注解"><a href="#1-4-1-2-条件注解" class="headerlink" title="1.4.1.2 条件注解"></a>1.4.1.2 条件注解</h5><blockquote>
<p>如果注解指定的<strong>条件成立</strong>，则触发指定行为。</p>
</blockquote>
<p><strong>@ConditionalOnXxx</strong></p>
<p><strong>@ConditionalOnClass：如果类路径中存在这个类，则触发指定行为</strong>。</p>
<p><strong>@ConditionalOnMissingClass：如果类路径中不存在这个类，则触发指定行为</strong>。</p>
<p><strong>@ConditionalOnBean：如果容器中存在这个 Bean（组件），则触发指定行为</strong>。</p>
<p><strong>@ConditionalOnMissingBean：如果容器中不存在这个 Bean（组件），则触发指定行为</strong>。</p>
<blockquote>
<p>场景：</p>
<ul>
<li><p>如果存在 <strong>FastsqlException</strong> 这个类，给容器中放一个 <strong>Cat</strong> 组件，命名 cat1。</p>
</li>
<li><p>否则，就给容器中放一个 <strong>Dog</strong> 组件，命名 dog1。</p>
</li>
<li><p>如果系统中有 <strong>dog1</strong> 这个组件，就给容器中放一个 User 组件，名 zhangsan。</p>
</li>
<li><p>否则，就放一个 User，名叫 lisi。</p>
</li>
</ul>
</blockquote>
<p><strong>@ConditionalOnBean（value&#x3D;组件类型，name&#x3D;组件名字）：判断容器中是否有这个类型的组件，并且名字是指定的值</strong>。</p>
<p>@ConditionalOnRepositoryType (org.springframework.boot.autoconfigure.data)</p>
<p>@ConditionalOnDefaultWebSecurity (org.springframework.boot.autoconfigure.security)</p>
<p>@ConditionalOnSingleCandidate (org.springframework.boot.autoconfigure.condition)</p>
<p>@ConditionalOnWebApplication (org.springframework.boot.autoconfigure.condition)</p>
<p>@ConditionalOnWarDeployment (org.springframework.boot.autoconfigure.condition)</p>
<p>@ConditionalOnJndi (org.springframework.boot.autoconfigure.condition)</p>
<p>@ConditionalOnResource (org.springframework.boot.autoconfigure.condition)</p>
<p>@ConditionalOnExpression (org.springframework.boot.autoconfigure.condition)</p>
<p><strong>@ConditionalOnClass (org.springframework.boot.autoconfigure.condition)</strong></p>
<p>@ConditionalOnEnabledResourceChain (org.springframework.boot.autoconfigure.web)</p>
<p><strong>@ConditionalOnMissingClass (org.springframework.boot.autoconfigure.condition)</strong></p>
<p>@ConditionalOnNotWebApplication (org.springframework.boot.autoconfigure.condition)</p>
<p>@ConditionalOnProperty (org.springframework.boot.autoconfigure.condition)</p>
<p>@ConditionalOnCloudPlatform (org.springframework.boot.autoconfigure.condition)</p>
<p><strong>@ConditionalOnBean (org.springframework.boot.autoconfigure.condition)</strong></p>
<p><strong>@ConditionalOnMissingBean (org.springframework.boot.autoconfigure.condition)</strong></p>
<p>@ConditionalOnMissingFilterBean (org.springframework.boot.autoconfigure.web.servlet)</p>
<p>@Profile (org.springframework.context.annotation)</p>
<p>@ConditionalOnInitializedRestarter (org.springframework.boot.devtools.restart)</p>
<p>@ConditionalOnGraphQlSchema (org.springframework.boot.autoconfigure.graphql)</p>
<p>@ConditionalOnJava (org.springframework.boot.autoconfigure.condition)</p>
<h5 id="1-4-1-3-属性绑定"><a href="#1-4-1-3-属性绑定" class="headerlink" title="1.4.1.3 属性绑定"></a>1.4.1.3 属性绑定</h5><p><strong>@ConfigurationProperties：声明组件的属性和配置文件哪些前缀开始项进行绑定</strong>。</p>
<p><strong>@EnableConfigurationProperties：快速注册注解</strong>：</p>
<ul>
<li><strong>场景</strong>：SpringBoot 默认只扫描自己主程序所在的包。如果导入第三方包，即使组件上标注了 @Component、@ConfigurationProperties 注解也没用。因为组件都扫描不进来，此时使用这个注解就可以快速进行属性绑定并把组件注册进容器。</li>
</ul>
<blockquote>
<p>将容器中任意<strong>组件（Bean）的属性值</strong>和<strong>配置文件</strong>的配置项的值<strong>进行绑定</strong>。</p>
<p>1、<strong>给容器中注册组件（@Component、@Bean）</strong>。</p>
<p>2、<strong>使用 @ConfigurationProperties 声明组件和配置文件的哪些配置项进行绑定</strong>。</p>
</blockquote>
<h4 id="1-4-2-YAML-配置文件"><a href="#1-4-2-YAML-配置文件" class="headerlink" title="1.4.2 YAML 配置文件"></a>1.4.2 YAML 配置文件</h4><blockquote>
<p><strong>痛点</strong>：SpringBoot 集中化管理配置，<strong>application.properties</strong>。</p>
<p><strong>问题</strong>：配置多以后难阅读和修改，<strong>层级结构辨识度不高</strong>。</p>
</blockquote>
<blockquote>
<p>YAML 是 “YAML Ain’t a Markup Language”（YAML 不是一种标记语言）。在开发的这种语言时，YAML 的意思其实是：”Yet Another Markup Language”（是另一种标记语言）。</p>
<ul>
<li><p>设计目标，就是<strong>方便人类读写</strong>。</p>
</li>
<li><p><strong>层次分明</strong>，更适合做配置文件。</p>
</li>
</ul>
<p>使用 <strong>.yaml</strong> 或 <strong>.yml</strong> 作为文件后缀。</p>
</blockquote>
<h5 id="1-4-2-1-基本语法"><a href="#1-4-2-1-基本语法" class="headerlink" title="1.4.2.1. 基本语法"></a>1.4.2.1. 基本语法</h5><ul>
<li><p><strong>大小写敏感</strong>。</p>
</li>
<li><p>使用<strong>缩进表示层级关系</strong>，<strong>k: v，使用空格分割 k, v</strong>。</p>
</li>
<li><p>缩进时不允许使用 Tab 键，只允许<strong>使用空格</strong>。</p>
</li>
<li><p>缩进的空格数目不重要，只要<strong>相同层级</strong>的元素<strong>左侧对齐</strong>即可。</p>
</li>
<li><p><strong># 表示注释</strong>，从这个字符一直到行尾，都会被解析器忽略。</p>
</li>
</ul>
<p>支持的写法：</p>
<ul>
<li><p><strong>对象</strong>：<strong>键值对</strong>的集合，例如：映射（map）、 哈希（hash）、 字典（dictionary）。</p>
</li>
<li><p><strong>数组</strong>：一组按次序排列的值，例如：序列（sequence）、 列表（list）。</p>
</li>
<li><p><strong>纯量</strong>：单个的、不可再分的值，例如：字符串、数字、bool、日期。</p>
</li>
</ul>
<h5 id="1-4-2-2-示例"><a href="#1-4-2-2-示例" class="headerlink" title="1.4.2.2 示例"></a>1.4.2.2 示例</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.myxh.springboot.bean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> MYXH</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2023/9/11</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="comment">// 和配置文件 person 前缀的所有配置进行绑定</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;person&quot;)</span></span><br><span class="line"><span class="comment">// 自动生成无参构造器</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="comment">// 自动生成全参构造器</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="comment">// 自动生成 JavaBean 属性的 getter/setter</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> Date birthDay;</span><br><span class="line">    <span class="keyword">private</span> Boolean like;</span><br><span class="line">    <span class="comment">// 嵌套对象</span></span><br><span class="line">    <span class="keyword">private</span> Child child;</span><br><span class="line">    <span class="comment">// 数组（里面是对象）</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Dog&gt; dogs;</span><br><span class="line">    <span class="comment">// Map</span></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, Cat&gt; cats;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.myxh.springboot.bean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> MYXH</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2023/9/11</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Child</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> Date birthDay;</span><br><span class="line">    <span class="comment">// 数组</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; text;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.myxh.springboot.bean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> MYXH</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2023/9/11</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Dog</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.myxh.springboot.bean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> MYXH</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2023/9/11</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Cat</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>properties 表示法。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server.port</span>=<span class="string">8080</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring.servlet.multipart.max-file-size</span>=<span class="string">10MB</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 配置 Redis</span></span><br><span class="line"><span class="attr">spring.data.redis.host</span>=<span class="string">localhost</span></span><br><span class="line"><span class="attr">spring.data.redis.port</span>=<span class="string">6379</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># properties 表示复杂对象</span></span><br><span class="line"><span class="attr">person.name</span>=<span class="string">张三</span></span><br><span class="line"><span class="attr">person.age</span>=<span class="string">35</span></span><br><span class="line"><span class="attr">person.birthDay</span>=<span class="string">1988/01/01 00:00:00</span></span><br><span class="line"><span class="attr">person.like</span>=<span class="string">true</span></span><br><span class="line"><span class="attr">person.child.name</span>=<span class="string">李四</span></span><br><span class="line"><span class="attr">person.child.age</span>=<span class="string">12</span></span><br><span class="line"><span class="attr">person.child.birthDay</span>=<span class="string">2011/01/01</span></span><br><span class="line"><span class="attr">person.child.text[0]</span>=<span class="string">hello</span></span><br><span class="line"><span class="attr">person.child.text[1]</span>=<span class="string">world</span></span><br><span class="line"><span class="attr">person.dogs[0].name</span>=<span class="string">小黑</span></span><br><span class="line"><span class="attr">person.dogs[0].age</span>=<span class="string">2</span></span><br><span class="line"><span class="attr">person.dogs[1].name</span>=<span class="string">小白</span></span><br><span class="line"><span class="attr">person.dogs[1].age</span>=<span class="string">1</span></span><br><span class="line"><span class="attr">person.cats.cat1.name</span>=<span class="string">小蓝</span></span><br><span class="line"><span class="attr">person.cats.cat1.age</span>=<span class="string">2</span></span><br><span class="line"><span class="attr">person.cats.cat2.name</span>=<span class="string">小灰</span></span><br><span class="line"><span class="attr">person.cats.cat2.age</span>=<span class="string">1</span></span><br></pre></td></tr></table></figure>

<p>yaml 表示法。</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1、k: v，k v 之前是空格区分</span></span><br><span class="line"><span class="comment"># 2、属性有层级关系，使用下一行，空两个空格</span></span><br><span class="line"><span class="comment"># 3、左侧对齐的代表同一层级的属性</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line">  <span class="comment"># port: 8081</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">servlet:</span></span><br><span class="line">    <span class="attr">multipart:</span></span><br><span class="line">      <span class="attr">max-file-size:</span> <span class="string">10MB</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># 配置 Redis</span></span><br><span class="line">  <span class="attr">data:</span></span><br><span class="line">    <span class="attr">redis:</span></span><br><span class="line">      <span class="attr">host:</span> <span class="string">localhost</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">6379</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 下边是一个单独文档</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># yaml 表示复杂对象</span></span><br><span class="line"><span class="attr">person:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">张三</span></span><br><span class="line">  <span class="attr">age:</span> <span class="number">35</span></span><br><span class="line">  <span class="attr">birth-day:</span> <span class="number">1988</span><span class="string">/01/01</span> <span class="number">00</span><span class="string">:00:00</span></span><br><span class="line">  <span class="attr">like:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">child:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">李四</span></span><br><span class="line">    <span class="attr">age:</span> <span class="number">12</span></span><br><span class="line">    <span class="attr">birth-day:</span> <span class="number">2011</span><span class="string">/01/01</span></span><br><span class="line">    <span class="comment"># text: [&quot;he\nllo&quot;,&#x27;wor\nld&#x27;]</span></span><br><span class="line">    <span class="attr">text:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;he\nllo&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&#x27;wor\nld&#x27;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">|</span></span><br><span class="line"><span class="string">        cats:</span></span><br><span class="line"><span class="string">          cat1:</span></span><br><span class="line"><span class="string">            name: 小蓝</span></span><br><span class="line"><span class="string">            age: 2</span></span><br><span class="line"><span class="string"></span></span><br><span class="line">          <span class="comment"># 对象也可用 &#123;&#125; 表示</span></span><br><span class="line">          <span class="attr">cat2:</span> &#123;<span class="attr">name:</span> <span class="string">小灰</span>,<span class="attr">age:</span> <span class="number">1</span>&#125;</span><br><span class="line">      <span class="bullet">-</span> <span class="string">&gt;</span></span><br><span class="line"><span class="string">        cats:</span></span><br><span class="line"><span class="string">        cat1:</span></span><br><span class="line"><span class="string">        name: 小蓝</span></span><br><span class="line"><span class="string">        age: 2</span></span><br><span class="line"><span class="string"></span></span><br><span class="line">        <span class="comment"># 对象也可用 &#123;&#125; 表示</span></span><br><span class="line">        <span class="attr">cat2:</span> &#123;<span class="attr">name:</span> <span class="string">小灰</span>,<span class="attr">age:</span> <span class="number">1</span>&#125;</span><br><span class="line"></span><br><span class="line">  <span class="attr">dogs:</span></span><br><span class="line">    <span class="comment"># 数组也可用 - 表示</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">小黑</span></span><br><span class="line">      <span class="attr">age:</span> <span class="number">2</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">小白</span></span><br><span class="line">      <span class="attr">age:</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">cats:</span></span><br><span class="line">    <span class="attr">cat1:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">小蓝</span></span><br><span class="line">      <span class="attr">age:</span> <span class="number">2</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 对象也可用 &#123;&#125; 表示</span></span><br><span class="line">    <span class="attr">cat2:</span> &#123; <span class="attr">name:</span> <span class="string">小灰</span>, <span class="attr">age:</span> <span class="number">1</span> &#125;</span><br></pre></td></tr></table></figure>

<h5 id="1-4-2-3-细节"><a href="#1-4-2-3-细节" class="headerlink" title="1.4.2.3 细节"></a>1.4.2.3 细节</h5><ul>
<li><p>birthDay 推荐写为 birth-day。</p>
</li>
<li><p><strong>文本</strong>：</p>
<ul>
<li><p><strong>单引号</strong>不会转义【\n 则为普通字符串显示】。</p>
</li>
<li><p><strong>双引号</strong>会转义【\n 会显示为<strong>换行符</strong>】。</p>
</li>
</ul>
</li>
<li><p><strong>大文本</strong>：</p>
<ul>
<li><p><code>|</code> 开头，大文本写在下层，<strong>保留文本格式，换行符正确显示</strong>。</p>
</li>
<li><p><code>&gt;</code> 开头，大文本写在下层，折叠换行符。</p>
</li>
</ul>
</li>
</ul>
<p><strong>多文档合并</strong>：</p>
<ul>
<li>使用<code>\-\-\-</code>可以把多个 yaml 文档合并在一个文档中，每个文档区依然认为内容独立。</li>
</ul>
<h5 id="1-4-2-4-小技巧：lombok"><a href="#1-4-2-4-小技巧：lombok" class="headerlink" title="1.4.2.4. 小技巧：lombok"></a>1.4.2.4. 小技巧：lombok</h5><blockquote>
<p>简化 JavaBean 开发。自动生成构造器、getter&#x2F;setter、自动生成 Builder 模式等。</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>compile<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>使用 <code>@Data</code> 等注解。</p>
<h4 id="1-4-3-日志配置"><a href="#1-4-3-日志配置" class="headerlink" title="1.4.3 日志配置"></a>1.4.3 日志配置</h4><p>规范：项目开发不要编写 <code>System.out.println()</code>，应该用<strong>日志</strong>记录信息。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/ef743df4971244f78020559b5e876397.png" alt="日志配置"></p>
<h5 id="1-4-3-1-简介"><a href="#1-4-3-1-简介" class="headerlink" title="1.4.3.1 简介"></a>1.4.3.1 简介</h5><p>1、Spring 使用 <code>commons-logging</code> 作为内部日志，但底层日志实现是开放的。可对接其他日志框架。</p>
<ul>
<li>① spring5 及以后 commons-logging 被 spring 直接自己实现了。</li>
</ul>
<p>2、支持 <code>jul</code>，<code>log4j2</code>，<code>logback</code>。SpringBoot 提供了默认的控制台输出配置，也可以配置输出为文件。</p>
<p>3、<code>logback</code> 是默认使用的。</p>
<p>4、虽然<strong>日志框架很多</strong>，但是不用担心，使用 SpringBoot 的<strong>默认配置就能工作的很好</strong>。</p>
<p><strong>SpringBoot 怎么把日志默认配置好的</strong>。</p>
<p>1、每个 <code>starter</code> 场景，都会导入一个核心场景 <code>spring-boot-starter</code>。</p>
<p>2、核心场景引入了日志的所用功能 <code>spring-boot-starter-logging</code>。</p>
<p>3、默认使用了 <code>logback + slf4j</code> 组合作为默认底层日志。</p>
<p>4、<code>日志是系统一启动就要用</code>，<code>xxxAutoConfiguration</code> 是系统启动好了以后放好的组件，后来用的。</p>
<p>5、日志是利用<strong>监听器机制</strong>配置好的。<code>ApplicationListener</code>。</p>
<p>6、日志所有的配置都可以通过修改配置文件实现。以 <code>logging</code> 开始的所有配置。</p>
<h5 id="1-4-3-2-日志格式"><a href="#1-4-3-2-日志格式" class="headerlink" title="1.4.3.2 日志格式"></a>1.4.3.2 日志格式</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">2023-09-14 20:24:43.709  INFO 96528 --- [main] o.s.b.w.e.t.TomcatWebServer              : Tomcat initialized with port(s): 8080 (http)</span><br><span class="line">2023-09-14 20:24:43.712  INFO 96528 --- [main] o.a.c.c.AprLifecycleListener             : Loaded Apache Tomcat Native library [2.0.5] using APR version [1.7.4].</span><br></pre></td></tr></table></figure>

<p>默认输出格式：</p>
<ul>
<li><p>时间和日期：毫秒级精度。</p>
</li>
<li><p>日志级别：<code>ERROR</code>, <code>WARN</code>, <code>INFO</code>, <code>DEBUG</code>, <code>TRACE</code>。</p>
</li>
<li><p>进程 ID。</p>
</li>
<li><p>---：消息分割符。</p>
</li>
<li><p>线程名：使用[]包含。</p>
</li>
<li><p>Logger 名：通常是产生日志的<strong>类名</strong>。</p>
</li>
<li><p>消息：日志记录的内容。</p>
</li>
</ul>
<p>注意：logback 没有 <code>FATAL</code> 级别，对应的是 <code>ERROR</code>。</p>
<p>默认值：参照：<code>spring-boot</code> 包 <code>additional-spring-configuration-metadata.json</code> 文件。</p>
<p>默认输出格式值：<code>%clr(%d&#123;$&#123;LOG_DATEFORMAT_PATTERN:-yyyy-MM-dd&#39;T&#39;HH:mm:ss.SSSXXX&#125;&#125;)&#123;faint&#125; %clr($&#123;LOG_LEVEL_PATTERN:-%5p&#125;) %clr($&#123;PID:- &#125;)&#123;magenta&#125; %clr(---)&#123;faint&#125; %clr([%15.15t])&#123;faint&#125; %clr(%-40.40logger&#123;39&#125;)&#123;cyan&#125; %clr(:)&#123;faint&#125; %m%n$&#123;LOG_EXCEPTION_CONVERSION_WORD:-%wEx&#125;</code>。</p>
<p>可修改为：<code>%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; %-5level [%thread] %logger&#123;15&#125; ===&gt; %msg%n</code>。</p>
<h5 id="1-4-3-3-记录日志"><a href="#1-4-3-3-记录日志" class="headerlink" title="1.4.3.3 记录日志"></a>1.4.3.3 记录日志</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(getClass());</span><br></pre></td></tr></table></figure>

<p>或者使用 Lombok 的@Slf4j 注解。</p>
<h5 id="1-4-3-4-日志级别"><a href="#1-4-3-4-日志级别" class="headerlink" title="1.4.3.4 日志级别"></a>1.4.3.4 日志级别</h5><ul>
<li><p>由低到高：<code>ALL, TRACE, DEBUG, INFO, WARN, ERROR, FATAL, OFF</code>。</p>
<ul>
<li><p><strong>只会打印指定级别及以上级别的日志</strong>。</p>
</li>
<li><p>ALL：打印所有日志。</p>
</li>
<li><p>TRACE：追踪框架详细流程日志，一般不使用。</p>
</li>
<li><p>DEBUG：开发调试细节日志。</p>
</li>
<li><p>INFO：关键、感兴趣信息日志。</p>
</li>
<li><p>WARN：警告但不是错误的信息日志，比如：版本过时。</p>
</li>
<li><p>ERROR：业务错误日志，比如出现各种异常。</p>
</li>
<li><p>FATAL：致命错误日志，比如 jvm 系统崩溃。</p>
</li>
<li><p>OFF：关闭所有日志记录。</p>
</li>
</ul>
</li>
<li><p>不指定级别的所有类，都使用 root 指定的级别作为默认级别。</p>
</li>
<li><p>SpringBoot 日志<strong>默认级别是 INFO</strong>。</p>
</li>
</ul>
<p>1、在 <code>application.properties/yaml</code> 中配置 <code>logging.level.&lt;logger-name&gt;=&lt;level&gt;</code>指定日志级别。</p>
<p>2、<code>level</code> 可取值范围：<code>TRACE, DEBUG, INFO, WARN, ERROR, FATAL, OFF</code>，定义在 <code>LogLevel</code> 类中。</p>
<p>3、root 的 <code>logger-name</code> 叫 <code>root</code>，可以配置 <code>logging.level.root=warn</code>，代表所有未指定日志级别都使用 root 的 warn 级别。</p>
<h5 id="1-4-3-5-日志分组"><a href="#1-4-3-5-日志分组" class="headerlink" title="1.4.3.5 日志分组"></a>1.4.3.5 日志分组</h5><p>比较有用的技巧是：</p>
<p>将相关的 <code>logger</code> 分组在一起，统一配置。SpringBoot 也支持。比如：Tomcat 相关的日志统一设置。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">logging.group.tomcat</span>=<span class="string">org.apache.catalina,org.apache.coyote,org.apache.tomcat</span></span><br><span class="line"><span class="attr">logging.level.tomcat</span>=<span class="string">trace</span></span><br></pre></td></tr></table></figure>

<p>SpringBoot 预定义两个组。</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Loggers</th>
</tr>
</thead>
<tbody><tr>
<td>web</td>
<td><code>org.springframework.core.codec</code>, <code>org.springframework.http</code>, <code>org.springframework.web</code>, <code>org.springframework.boot.actuate.endpoint.web</code>, <code>org.springframework.boot.web.servlet.ServletContextInitializerBeans</code></td>
</tr>
<tr>
<td>sql</td>
<td><code>org.springframework.jdbc.core</code>, <code>org.hibernate.SQL</code>, <code>org.jooq.tools.LoggerListener</code></td>
</tr>
</tbody></table>
<h5 id="1-4-3-6-文件输出"><a href="#1-4-3-6-文件输出" class="headerlink" title="1.4.3.6 文件输出"></a>1.4.3.6 文件输出</h5><p>SpringBoot 默认只把日志写在控制台，如果想额外记录到文件，可以在 <code>application.properties</code> 中添加 <code>logging.file.name</code> 或 <code>logging.file.path</code> 配置项。</p>
<table>
<thead>
<tr>
<th><code>logging.file.name</code></th>
<th><code>logging.file.path</code></th>
<th>示例</th>
<th>效果</th>
</tr>
</thead>
<tbody><tr>
<td>未指定</td>
<td>未指定</td>
<td>无</td>
<td>仅控制台输出。</td>
</tr>
<tr>
<td><strong>指定</strong></td>
<td>未指定</td>
<td><code>my.log</code></td>
<td>写入指定文件。可以<code>加路径</code>。</td>
</tr>
<tr>
<td>未指定</td>
<td><strong>指定</strong></td>
<td><code>./log</code></td>
<td>写入指定目录，文件名为 <code>spring.log</code>。</td>
</tr>
<tr>
<td><strong>指定</strong></td>
<td><strong>指定</strong></td>
<td>无</td>
<td>以 <code>logging.file.name</code> 为准。</td>
</tr>
</tbody></table>
<h5 id="1-4-3-7-文件归档与滚动切割"><a href="#1-4-3-7-文件归档与滚动切割" class="headerlink" title="1.4.3.7 文件归档与滚动切割"></a>1.4.3.7 文件归档与滚动切割</h5><blockquote>
<p>归档：每天的日志单独存到一个文档中。</p>
<p>切割：每个文件 10MB，超过大小切割成另外一个文件。</p>
</blockquote>
<p>1、每天的日志应该独立分割出来存档。如果使用 <code>logback</code>（SpringBoot 默认整合），可以通过 <code>application.properties/yaml</code> 文件指定日志滚动规则。</p>
<p>2、如果是其他日志系统，需要自行配置（添加 <code>log4j2.xml</code> 或 <code>log4j2-spring.xml</code>）。</p>
<p>3、支持的滚动规则设置如下。</p>
<table>
<thead>
<tr>
<th>配置项</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><code>logging.logback.rollingpolicy.file-name-pattern</code></td>
<td>日志存档的文件名格式（默认值：<code>$&#123;LOG_FILE&#125;.%d&#123;yyyy-MM-dd&#125;.%i.gz</code>）。</td>
</tr>
<tr>
<td><code>logging.logback.rollingpolicy.clean-history-on-start</code></td>
<td>应用启动时是否清除以前存档（默认值：<code>false</code>）。</td>
</tr>
<tr>
<td><code>logging.logback.rollingpolicy.max-file-size</code></td>
<td>存档前，每个日志文件的最大大小（默认值：<code>10MB</code>）。</td>
</tr>
<tr>
<td><code>logging.logback.rollingpolicy.total-size-cap</code></td>
<td>日志文件被删除之前，可以容纳的最大大小（默认值：<code>0B</code>）。设置 <code>1GB</code> 则磁盘存储超过 1GB 日志后就会删除旧日志文件。</td>
</tr>
<tr>
<td><code>logging.logback.rollingpolicy.max-history</code></td>
<td>日志文件保存的最大天数(默认值：<code>7</code>)。</td>
</tr>
</tbody></table>
<h5 id="1-4-3-8-自定义配置"><a href="#1-4-3-8-自定义配置" class="headerlink" title="1.4.3.8 自定义配置"></a>1.4.3.8 自定义配置</h5><p>通常配置 <code>application.properties</code> 就够了。当然也可以自定义。比如：</p>
<table>
<thead>
<tr>
<th>日志系统</th>
<th>自定义</th>
</tr>
</thead>
<tbody><tr>
<td>Logback</td>
<td><code>logback-spring.xml</code>, <code>logback-spring.groovy</code>, <code>logback.xml</code>, <code>logback.groovy</code></td>
</tr>
<tr>
<td>Log4j2</td>
<td><code>log4j2-spring.xml or log4j2.xml</code></td>
</tr>
<tr>
<td>JDK (Java Util Logging)</td>
<td><code>logging.properties</code></td>
</tr>
</tbody></table>
<p>如果可能，建议在日志配置中使用 <code>-spring</code> 变量（例如，<code>logback-spring.xml</code> 而不是 <code>logback.xml</code>）。如果使用标准配置文件，spring 无法完全控制日志初始化。</p>
<p>最佳实战：自己要写配置，配置文件名加上 <code>xxx-spring.xml</code>。</p>
<h5 id="1-4-3-9-切换日志组合"><a href="#1-4-3-9-切换日志组合" class="headerlink" title="1.4.3.9 切换日志组合"></a>1.4.3.9 切换日志组合</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 如果第三方框架使用了其他日志框架，如 jul，可以排除掉这个框架的默认日志 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-logging<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-log4j2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>log4j2 支持 yaml 和 json 格式的配置文件。</p>
<table>
<thead>
<tr>
<th>格式</th>
<th>依赖</th>
<th>文件名</th>
</tr>
</thead>
<tbody><tr>
<td>YAML</td>
<td>com.fasterxml.jackson.core:jackson-databind、com.fasterxml.jackson.dataformat:jackson-dataformat-yaml</td>
<td>log4j2.yaml 或 log4j2.yml</td>
</tr>
<tr>
<td>JSON</td>
<td>com.fasterxml.jackson.core:jackson-databind</td>
<td>log4j2.json 或 log4j2.jsn</td>
</tr>
</tbody></table>
<h5 id="1-4-3-10-最佳实战"><a href="#1-4-3-10-最佳实战" class="headerlink" title="1.4.3.10 最佳实战"></a>1.4.3.10 最佳实战</h5><p>1、导入任何第三方框架，先排除它的日志包，因为 Boot 底层控制好了日志。</p>
<p>2、修改 <code>application.properties</code> 配置文件，就可以调整日志的所有行为。如果不够，可以编写日志框架自己的配置文件放在类路径下就行，比如 <code>logback-spring.xml</code>，<code>log4j2-spring.xml</code>。</p>
<p>3、如需对接<strong>专业日志系统</strong>，也只需要把 logback 记录的<strong>日志</strong>灌倒 <strong>kafka</strong> 之类的中间件，这和 SpringBoot 没关系，都是日志框架自己的配置，<strong>修改配置文件即可</strong>。</p>
<p>4、<strong>业务中使用 slf4j-api 记录日志，不要再用 System.out.println() 了</strong></p>
<h2 id="第-2-章-SpringBoot3-Web-开发"><a href="#第-2-章-SpringBoot3-Web-开发" class="headerlink" title="第 2 章 SpringBoot3-Web 开发"></a>第 2 章 SpringBoot3-Web 开发</h2><blockquote>
<p>SpringBoot 的 Web 开发能力，由 <strong>SpringMVC</strong> 提供。</p>
</blockquote>
<h3 id="2-1-WebMvcAutoConfiguration-原理"><a href="#2-1-WebMvcAutoConfiguration-原理" class="headerlink" title="2.1 WebMvcAutoConfiguration 原理"></a>2.1 WebMvcAutoConfiguration 原理</h3><h4 id="2-1-1-生效条件"><a href="#2-1-1-生效条件" class="headerlink" title="2.1.1 生效条件"></a>2.1.1 生效条件</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在这些自动配置之后</span></span><br><span class="line"><span class="meta">@AutoConfiguration(after = &#123; DispatcherServletAutoConfiguration.class,</span></span><br><span class="line"><span class="meta">    TaskExecutionAutoConfiguration.class,</span></span><br><span class="line"><span class="meta">    ValidationAutoConfiguration.class &#125;)</span></span><br><span class="line"><span class="comment">// 如果是 Web 应用就生效，类型有 SERVLET、REACTIVE（响应式 Web）</span></span><br><span class="line"><span class="meta">@ConditionalOnWebApplication(type = Type.SERVLET)</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(&#123; Servlet.class, DispatcherServlet.class, WebMvcConfigurer.class &#125;)</span></span><br><span class="line"><span class="comment">// 容器中没有这个 Bean，才生效，默认就是没有</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(WebMvcConfigurationSupport.class)</span></span><br><span class="line"><span class="comment">// 优先级</span></span><br><span class="line"><span class="meta">@AutoConfigureOrder(Ordered.HIGHEST_PRECEDENCE + 10)</span></span><br><span class="line"><span class="meta">@ImportRuntimeHints(WebResourcesRuntimeHints.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebMvcAutoConfiguration</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-1-2-效果"><a href="#2-1-2-效果" class="headerlink" title="2.1.2 效果"></a>2.1.2 效果</h4><p>1、放了两个 Filter：</p>
<ul>
<li><p>① <code>HiddenHttpMethodFilter</code>：页面表单提交 Rest 请求（GET、POST、PUT、DELETE）。</p>
</li>
<li><p>② <code>FormContentFilter</code>：表单内容 Filter，GET（数据放 URL 后面）、POST（数据放请求体）请求可以携带数据，PUT、DELETE 的请求体数据会被忽略。</p>
</li>
</ul>
<p>2、给容器中放了 <code>WebMvcConfigurer</code> 组件：给 SpringMVC 添加各种定制功能。</p>
<ul>
<li><p>① 所有的功能最终会和配置文件进行绑定。</p>
</li>
<li><p>② WebMvcProperties：<code>spring.mvc</code> 配置文件。</p>
</li>
<li><p>③ WebProperties：<code>spring.web</code> 配置文件。</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration(proxyBeanMethods = false)</span></span><br><span class="line"><span class="comment">// 额外导入了其他配置</span></span><br><span class="line"><span class="meta">@Import(EnableWebMvcConfiguration.class)</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(&#123; WebMvcProperties.class, WebProperties.class &#125;)</span></span><br><span class="line"><span class="meta">@Order(0)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">WebMvcAutoConfigurationAdapter</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span>, ServletContextAware</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-1-3-WebMvcConfigurer-接口"><a href="#2-1-3-WebMvcConfigurer-接口" class="headerlink" title="2.1.3 WebMvcConfigurer 接口"></a>2.1.3 WebMvcConfigurer 接口</h4><p>提供了配置 SpringMVC 底层的所有组件入口。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://reggie-xiamou.oss-cn-beijing.aliyuncs.com/img/5f8d4aa8e9904dbd9b4491b745d936ff.png" alt="WebMvcConfigurer 接口"></p>
<h4 id="2-1-4-静态资源规则源码"><a href="#2-1-4-静态资源规则源码" class="headerlink" title="2.1.4 静态资源规则源码"></a>2.1.4 静态资源规则源码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">this</span>.resourceProperties.isAddMappings())</span><br><span class="line">    &#123;</span><br><span class="line">        logger.debug(<span class="string">&quot;Default resource handling disabled&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    addResourceHandler(registry, <span class="built_in">this</span>.mvcProperties.getWebjarsPathPattern(),</span><br><span class="line">        <span class="string">&quot;classpath:/META-INF/resources/webjars/&quot;</span>);</span><br><span class="line"></span><br><span class="line">    addResourceHandler(registry, <span class="built_in">this</span>.mvcProperties.getStaticPathPattern(),</span><br><span class="line">        (registration) -&gt; &#123;</span><br><span class="line">        registration.addResourceLocations(<span class="built_in">this</span>.resourceProperties.getStaticLocations());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.servletContext != <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">ServletContextResource</span> <span class="variable">resource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServletContextResource</span>(<span class="built_in">this</span>.servletContext, SERVLET_LOCATION);</span><br><span class="line">            registration.addResourceLocations(resource);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>1、规则一：访问 <code>/webjars/**</code> 路径就去 <code>classpath:/META-INF/resources/webjars/</code> 下找资源。</p>
<ul>
<li>① Maven 导入依赖。</li>
</ul>
<p>2、规则二：访问 <code>/**</code> 路径就去<code>静态资源默认的四个位置找资源</code>。</p>
<ul>
<li><p>① <code>classpath:/META-INF/resources/</code></p>
</li>
<li><p>② <code>classpath:/resources/</code></p>
</li>
<li><p>③ <code>classpath:/static/</code></p>
</li>
<li><p>④ <code>classpath:/public/</code></p>
</li>
</ul>
<p>3、规则三：<strong>静态资源默认都有缓存规则的设置</strong>。</p>
<ul>
<li><p>① 所有缓存的设置，直接通过<strong>配置文件</strong>：<code>spring.web</code>。</p>
</li>
<li><p>② cachePeriod：缓存周期，多久不用找服务器要新的，默认没有缓存周期，以秒为单位。</p>
</li>
<li><p>③ cacheControl：<strong>HTTP 缓存控制</strong>，<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Caching">https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Caching</a> 。</p>
</li>
<li><p>④ <strong>useLastModified</strong>：是否使用最后一次修改，配合 HTTP Cache 规则。</p>
</li>
</ul>
<blockquote>
<p>如果浏览器访问了一个静态资源 <strong>index.js</strong>，如果服务这个资源没有发生变化，下次访问的时候就可以直接让浏览器用自己缓存中的东西，而不用给服务器发请求。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">registration.setCachePeriod(getSeconds(<span class="built_in">this</span>.resourceProperties.getCache().getPeriod()));</span><br><span class="line">registration.setCacheControl(<span class="built_in">this</span>.resourceProperties.getCache().getCachecontrol().toHttpCacheControl());</span><br><span class="line">registration.setUseLastModified(<span class="built_in">this</span>.resourceProperties.getCache().isUseLastModified());</span><br></pre></td></tr></table></figure>

<h4 id="2-1-5-EnableWebMvcConfiguration-源码"><a href="#2-1-5-EnableWebMvcConfiguration-源码" class="headerlink" title="2.1.5 EnableWebMvcConfiguration 源码"></a>2.1.5 EnableWebMvcConfiguration 源码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">SpringBoot 给容器中放 WebMvcConfigurationSupport 组件</span></span><br><span class="line"><span class="comment">如果自己放了 WebMvcConfigurationSupport 组件，SpringBoot 的 WebMvcAutoConfiguration 都会失效</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration(proxyBeanMethods = false)</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(WebProperties.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">EnableWebMvcConfiguration</span> <span class="keyword">extends</span> <span class="title class_">DelegatingWebMvcConfiguration</span> <span class="keyword">implements</span> <span class="title class_">ResourceLoaderAware</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>1、<code>HandlerMapping</code>：根据请求路径 <code>/xxx</code> 找那个 handler 能处理请求。</p>
<ul>
<li><p>① <code>WelcomePageHandlerMapping</code>：</p>
<ul>
<li><p>(1) 访问 <code>/\*\*</code> 路径下的所有请求，都在以前四个静态资源路径下找，欢迎页也一样。</p>
</li>
<li><p>(2) 找 <code>index.html</code>：只要静态资源的位置有一个 <code>index.html</code> 页面，项目启动默认访问。</p>
</li>
</ul>
</li>
</ul>
<h4 id="2-1-6-为什么容器中放一个-WebMvcConfigurer-就能配置底层行为"><a href="#2-1-6-为什么容器中放一个-WebMvcConfigurer-就能配置底层行为" class="headerlink" title="2.1.6 为什么容器中放一个 WebMvcConfigurer 就能配置底层行为"></a>2.1.6 为什么容器中放一个 WebMvcConfigurer 就能配置底层行为</h4><p>1、WebMvcAutoConfiguration 是一个自动配置类，它里面有一个 <code>EnableWebMvcConfiguration</code>。</p>
<p>2、<code>EnableWebMvcConfiguration</code> 继承于 <code>DelegatingWebMvcConfiguration</code>，这两个都生效。</p>
<p>3、<code>DelegatingWebMvcConfiguration</code> 利用依赖注入把容器中所有 <code>WebMvcConfigurer</code> 注入进来。</p>
<p>4、别人调用 <code>DelegatingWebMvcConfiguration</code> 的方法配置底层规则，而它调用所有 <code>WebMvcConfigurer</code> 的配置底层方法。</p>
<h4 id="2-1-7-WebMvcConfigurationSupport"><a href="#2-1-7-WebMvcConfigurationSupport" class="headerlink" title="2.1.7 WebMvcConfigurationSupport"></a>2.1.7 WebMvcConfigurationSupport</h4><p>提供了很多的默认设置。</p>
<p>判断系统中是否有相应的类：如果有，就加入相应的 <code>HttpMessageConverter</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">jackson2Present = ClassUtils.isPresent(<span class="string">&quot;com.fasterxml.jackson.databind.ObjectMapper&quot;</span>, classLoader) &amp;&amp;</span><br><span class="line">    ClassUtils.isPresent(<span class="string">&quot;com.fasterxml.jackson.core.JsonGenerator&quot;</span>, classLoader);</span><br><span class="line">jackson2XmlPresent = ClassUtils.isPresent(<span class="string">&quot;com.fasterxml.jackson.dataformat.xml.XmlMapper&quot;</span>, classLoader);</span><br><span class="line">jackson2SmilePresent = ClassUtils.isPresent(<span class="string">&quot;com.fasterxml.jackson.dataformat.smile.SmileFactory&quot;</span>, classLoader);</span><br></pre></td></tr></table></figure>

<h3 id="2-2-Web-场景"><a href="#2-2-Web-场景" class="headerlink" title="2.2 Web 场景"></a>2.2 Web 场景</h3><h4 id="2-2-1-自动配置"><a href="#2-2-1-自动配置" class="headerlink" title="2.2.1 自动配置"></a>2.2.1 自动配置</h4><p>1、整合 web 场景。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>2、引入了 <code>autoconfigure</code> 功能。</p>
<p>3、<code>@EnableAutoConfiguration</code> 注解使用 <code>@Import(AutoConfigurationImportSelector.class)</code> 批量导入组件。</p>
<p>4、加载 <code>META-INF/spring/org.springframework.boot.autoconfigure.AutoConfiguration.imports</code> 文件中配置的所有组件。</p>
<p>5、所有自动配置类如下。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">org.springframework.boot.autoconfigure.web.client.RestTemplateAutoConfiguration</span><br><span class="line">org.springframework.boot.autoconfigure.web.embedded.EmbeddedWebServerFactoryCustomizerAutoConfiguration</span><br><span class="line"><span class="comment">// ==============以下是响应式 Web 场景==============</span></span><br><span class="line">org.springframework.boot.autoconfigure.web.reactive.HttpHandlerAutoConfiguration</span><br><span class="line">org.springframework.boot.autoconfigure.web.reactive.ReactiveMultipartAutoConfiguration</span><br><span class="line">org.springframework.boot.autoconfigure.web.reactive.ReactiveWebServerFactoryAutoConfiguration</span><br><span class="line">org.springframework.boot.autoconfigure.web.reactive.WebFluxAutoConfiguration</span><br><span class="line">org.springframework.boot.autoconfigure.web.reactive.WebSessionIdResolverAutoConfiguration</span><br><span class="line">org.springframework.boot.autoconfigure.web.reactive.error.ErrorWebFluxAutoConfiguration</span><br><span class="line">org.springframework.boot.autoconfigure.web.reactive.function.client.ClientHttpConnectorAutoConfiguration</span><br><span class="line">org.springframework.boot.autoconfigure.web.reactive.function.client.WebClientAutoConfiguration</span><br><span class="line"><span class="comment">// ===============================================</span></span><br><span class="line">org.springframework.boot.autoconfigure.web.servlet.DispatcherServletAutoConfiguration</span><br><span class="line">org.springframework.boot.autoconfigure.web.servlet.ServletWebServerFactoryAutoConfiguration</span><br><span class="line">org.springframework.boot.autoconfigure.web.servlet.error.ErrorMvcAutoConfiguration</span><br><span class="line">org.springframework.boot.autoconfigure.web.servlet.HttpEncodingAutoConfiguration</span><br><span class="line">org.springframework.boot.autoconfigure.web.servlet.MultipartAutoConfiguration</span><br><span class="line">org.springframework.boot.autoconfigure.web.servlet.WebMvcAutoConfiguration</span><br></pre></td></tr></table></figure>

<p>6、绑定了配置文件的一堆配置项。</p>
<ul>
<li><p>① SpringMVC 的所有配置 <code>spring.mvc</code>。</p>
</li>
<li><p>② Web 场景通用配置 <code>spring.web</code>。</p>
</li>
<li><p>③ 文件上传配置 <code>spring.servlet.multipart</code>。</p>
</li>
<li><p>④ 服务器的配置 <code>server</code>，比如：编码方式</p>
</li>
</ul>
<h4 id="2-2-2-默认效果"><a href="#2-2-2-默认效果" class="headerlink" title="2.2.2 默认效果"></a>2.2.2 默认效果</h4><p>默认配置：</p>
<p>1、包含了 <code>ContentNegotiatingViewResolver</code> 和 <code>BeanNameViewResolver</code> 组件，<strong>方便视图解析</strong>。</p>
<p>2、<strong>默认的静态资源处理机制</strong>：静态资源放在 <code>static</code> 文件夹下即可直接访问。</p>
<p>3、<strong>自动注册</strong>了 <code>Converter</code>, <code>GenericConverter</code>, <code>Formatter</code> 组件，适配常见<strong>数据类型转换</strong>和<strong>格式化需求</strong>。</p>
<p>4、<strong>支持</strong> <code>HttpMessageConverters</code>，可以<strong>方便返回</strong> <code>json</code> 等<strong>数据类型</strong>。</p>
<p>5、<strong>注册</strong> <code>MessageCodesResolver</code>，方便<strong>国际化</strong>及错误消息处理。</p>
<p>6、<strong>支持静态</strong> <code>index.html</code>。</p>
<p>7、<strong>自动使用</strong> <code>ConfigurableWebBindingInitializer</code>，实现<strong>消息处理、数据绑定、类型转化、数据校验</strong>等功能。</p>
<blockquote>
<p><strong>重要</strong>：</p>
<ul>
<li><p>如果想保持 <strong>boot mvc 的默认配置</strong>，并且自定义更多的 mvc 配置，比如：<strong>interceptors</strong>, <strong>formatters</strong>, <strong>view controllers</strong> 等。可以使用 <strong>@Configuration</strong> 注解添加一个 <strong>WebMvcConfigurer</strong> 类型的配置类，并且不要标注 <strong>@EnableWebMvc</strong>。</p>
</li>
<li><p>如果想保持 boot mvc 的默认配置，但要自定义核心组件实例，比如：<strong>RequestMappingHandlerMapping</strong>, <strong>RequestMappingHandlerAdapter</strong>, 或 <strong>ExceptionHandlerExceptionResolver</strong>，给容器中放一个 <strong>WebMvcRegistrations</strong> 组件即可。</p>
</li>
<li><p>如果想全面接管 Spring MVC，**@Configuration** 标注一个配置类，并加上 <strong>@EnableWebMvc</strong> 注解，实现 <strong>WebMvcConfigurer</strong> 接口。</p>
</li>
</ul>
</blockquote>
<h3 id="2-3-静态资源"><a href="#2-3-静态资源" class="headerlink" title="2.3 静态资源"></a>2.3 静态资源</h3><h4 id="2-3-1-默认规则"><a href="#2-3-1-默认规则" class="headerlink" title="2.3.1 默认规则"></a>2.3.1 默认规则</h4><h5 id="2-3-1-1-静态资源映射"><a href="#2-3-1-1-静态资源映射" class="headerlink" title="2.3.1.1 静态资源映射"></a>2.3.1.1 静态资源映射</h5><p>静态资源映射规则在 <code>WebMvcAutoConfiguration</code> 中进行了定义：</p>
<p>1、<code>/webjars/**</code> 的所有路径资源都在 <code>classpath:/META-INF/resources/webjars/</code>。</p>
<p>2、<code>/**</code> 的所有路径资源都在 <code>classpath:/META-INF/resources/</code>、<code>classpath:/resources/</code>、<code>classpath:/static/</code>、<code>classpath:/public/</code>。</p>
<p>3、所有静态资源都定义了<code>缓存规则</code>。【浏览器访问过一次，就会缓存一段时间】，但此功能参数无默认值。</p>
<ul>
<li><p>① <code>period</code>：缓存间隔，默认 0 秒。</p>
</li>
<li><p>② <code>cacheControl</code>：缓存控制，默认无。</p>
</li>
<li><p>③ <code>useLastModified</code>：是否使用 lastModified 头，默认 false。</p>
</li>
</ul>
<h5 id="2-3-1-2-静态资源缓存"><a href="#2-3-1-2-静态资源缓存" class="headerlink" title="2.3.1.2 静态资源缓存"></a>2.3.1.2 静态资源缓存</h5><p>如前面所述</p>
<p>1、所有静态资源都定义了<code>缓存规则</code>。【浏览器访问过一次，就会缓存一段时间】，但此功能参数无默认值。</p>
<ul>
<li><p>① <code>period</code>：缓存间隔，默认 0 秒。</p>
</li>
<li><p>② <code>cacheControl</code>：缓存控制，默认无。</p>
</li>
<li><p>③ <code>useLastModified</code>：是否使用 lastModified 头，默认 false。</p>
</li>
</ul>
<h5 id="2-3-1-3-欢迎页"><a href="#2-3-1-3-欢迎页" class="headerlink" title="2.3.1.3 欢迎页"></a>2.3.1.3 欢迎页</h5><p>欢迎页规则在 <code>WebMvcAutoConfiguration</code> 中进行了定义：</p>
<p>1、在<strong>静态资源</strong>目录下找 <code>index.html</code> 模板页。</p>
<p>2、没有就在 <code>templates</code> 下找 <code>index.html</code> 模板页。</p>
<h5 id="2-3-1-4-Favicon"><a href="#2-3-1-4-Favicon" class="headerlink" title="2.3.1.4 Favicon"></a>2.3.1.4 Favicon</h5><p>1、在静态资源目录下找 <code>favicon.ico</code>。</p>
<h5 id="2-3-1-5-缓存实验"><a href="#2-3-1-5-缓存实验" class="headerlink" title="2.3.1.5 缓存实验"></a>2.3.1.5 缓存实验</h5><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server.port</span>=<span class="string">8080</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 1、spring.web：</span></span><br><span class="line"><span class="comment"># ① 配置国际化的区域信息</span></span><br><span class="line"><span class="comment"># ② 静态资源策略（开启、处理链、缓存）</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 开启静态资源映射规则</span></span><br><span class="line"><span class="attr">spring.web.resources.add-mappings</span>=<span class="string">true</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 设置缓存</span></span><br><span class="line"><span class="attr">spring.web.resources.cache.period</span>=<span class="string">3600</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 缓存详细合并项控制，覆盖 period 配置</span></span><br><span class="line"><span class="comment"># 浏览照第一次请求服务器，服务器告诉浏览器此资源缓存 7200 秒，7200 秒以内的所有此资源访问不用发给服务器请求，7200 秒以后发请求给服务器</span></span><br><span class="line"><span class="attr">spring.web.resources.cache.cachecontrol.max-age</span>=<span class="string">7200</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 共享缓存</span></span><br><span class="line"><span class="attr">spring.web.resources.cache.cachecontrol.cache-public</span>=<span class="string">true</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 使用资源 last-modified 时间，来对比服务器和浏览照的资源是否相同没有变化，相同返回 304</span></span><br><span class="line"><span class="attr">spring.web.resources.cache.use-last-modified</span>=<span class="string">true</span></span><br></pre></td></tr></table></figure>

<h4 id="2-3-2-自定义静态资源规则"><a href="#2-3-2-自定义静态资源规则" class="headerlink" title="2.3.2 自定义静态资源规则"></a>2.3.2 自定义静态资源规则</h4><blockquote>
<p>自定义静态资源路径、自定义缓存规则。</p>
</blockquote>
<h5 id="2-3-2-1-配置方式"><a href="#2-3-2-1-配置方式" class="headerlink" title="2.3.2.1 配置方式"></a>2.3.2.1 配置方式</h5><p><code>spring.mvc</code>：静态资源访问前缀路径。</p>
<p><code>spring.web</code>：</p>
<ul>
<li><p>静态资源目录。</p>
</li>
<li><p>静态资源缓存策略。</p>
</li>
</ul>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 2、spring.mvc</span></span><br><span class="line"><span class="comment"># ① 自定义 webjars 路径前缀</span></span><br><span class="line"><span class="attr">spring.mvc.webjars-path-pattern</span>=<span class="string">/webjars/**</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># ② 静态资源访问路径前缀</span></span><br><span class="line"><span class="attr">spring.mvc.static-path-pattern</span>=<span class="string">/static/**</span></span><br></pre></td></tr></table></figure>

<h5 id="2-3-2-2-代码方式"><a href="#2-3-2-2-代码方式" class="headerlink" title="2.3.2.2 代码方式"></a>2.3.2.2 代码方式</h5><blockquote>
<p>容器中只要有一个 WebMvcConfigurer 组件，配置的底层行为都会生效。</p>
<p>@EnableWebMvc，禁用 boot 的默认配置。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.myxh.springboot.web.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.CacheControl;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.ResourceHandlerRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> MYXH</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2023/9/18</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">// 禁用 Spring Boot 的默认配置</span></span><br><span class="line"><span class="comment">// @EnableWebMvc</span></span><br><span class="line"><span class="comment">// 这是一个配置类，给容器中放一个 WebMvcConfigurer 组件，就能自定义底层</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 保留默认规则</span></span><br><span class="line">        WebMvcConfigurer.<span class="built_in">super</span>.addResourceHandlers(registry);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 新增自定义规则</span></span><br><span class="line">        registry.addResourceHandler(<span class="string">&quot;/static/**&quot;</span>)</span><br><span class="line">                .addResourceLocations(<span class="string">&quot;classpath:/image/, classpath:/static/&quot;</span>)</span><br><span class="line">                .setCacheControl(CacheControl.maxAge(<span class="number">7200</span>, TimeUnit.SECONDS));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.myxh.springboot.web.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.CacheControl;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.ResourceHandlerRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> MYXH</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2023/9/18</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">// 禁用 Spring Boot 的默认配置</span></span><br><span class="line"><span class="comment">// @EnableWebMvc</span></span><br><span class="line"><span class="comment">// 这是一个配置类，给容器中放一个 WebMvcConfigurer 组件，就能自定义底层</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyConfig</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> WebMvcConfigurer <span class="title function_">webMvcConfigurer</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">WebMvcConfigurer</span>()</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * 配置静态资源</span></span><br><span class="line"><span class="comment">             *</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@param</span> registry 注册表</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// 保留默认规则</span></span><br><span class="line">                WebMvcConfigurer.<span class="built_in">super</span>.addResourceHandlers(registry);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 新增自定义规则</span></span><br><span class="line">                registry.addResourceHandler(<span class="string">&quot;/static/**&quot;</span>)</span><br><span class="line">                        .addResourceLocations(<span class="string">&quot;classpath:/image/, classpath:/static/&quot;</span>)</span><br><span class="line">                        .setCacheControl(CacheControl.maxAge(<span class="number">7200</span>, TimeUnit.SECONDS));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-4-路径匹配"><a href="#2-4-路径匹配" class="headerlink" title="2.4 路径匹配"></a>2.4 路径匹配</h3><blockquote>
<p><strong>Spring5.3</strong> 之后加入了更多的<strong>请求路径匹配</strong>的实现策略。</p>
<p>以前只支持 <strong>AntPathMatcher</strong> 策略, 现在提供了 <strong>PathPatternParser</strong> 策略，并且可以指定到底使用那种策略。</p>
</blockquote>
<h4 id="2-4-1-Ant-风格路径用法"><a href="#2-4-1-Ant-风格路径用法" class="headerlink" title="2.4.1 Ant 风格路径用法"></a>2.4.1 Ant 风格路径用法</h4><p>Ant 风格的路径模式语法具有以下规则：</p>
<ul>
<li><p><code>\*</code>：表示<strong>任意数量的字符</strong>。</p>
</li>
<li><p><code>?</code>：表示<strong>任意一个字符</strong>。</p>
</li>
<li><p><code>\*\*</code>：表示<strong>任意数量的目录</strong>。</p>
</li>
<li><p><code>&#123;&#125;</code>：表示一个命名的模式<strong>占位符</strong>。</p>
</li>
<li><p><code>[]</code>：表示<code>字符集合</code>，例如<code>[a-z]</code>表示小写字母。</p>
</li>
</ul>
<p>例如：</p>
<ul>
<li><p><code>\*.html</code> 匹配任意名称，扩展名为 <code>.html</code> 的文件。</p>
</li>
<li><p>&#x2F;<code>folder1/\*/\*.java</code> 匹配在 <code>folder1</code> 目录下的任意两级目录下的 <code>.java</code> 文件。</p>
</li>
<li><p><code>/folder2/\*\*/\*.jsp</code> 匹配在 <code>folder2</code> 目录下任意目录深度的 <code>.jsp</code> 文件。</p>
</li>
<li><p><code>/&#123;type&#125;/&#123;id&#125;.html</code> 匹配任意文件名为 <code>&#123;id&#125;.html</code>，在任意命名的 <code>&#123;type&#125;</code> 目录下的文件。</p>
</li>
</ul>
<p>注意：Ant 风格的路径模式语法中的特殊字符需要转义，例如：</p>
<ul>
<li><p>要匹配文件路径中的星号，则需要转义为<code>\\\\*</code>。</p>
</li>
<li><p>要匹配文件路径中的问号，则需要转义为 <code>\\\\?</code>。</p>
</li>
</ul>
<h4 id="2-4-2-模式切换"><a href="#2-4-2-模式切换" class="headerlink" title="2.4.2 模式切换"></a>2.4.2 模式切换</h4><blockquote>
<p><strong>AntPathMatcher</strong> 与 <strong>PathPatternParser</strong>。</p>
<p><strong>PathPatternParser</strong> 在 jmh 基准测试下，有 6<del>8 倍吞吐量提升，降低 30%</del>40% 空间分配率。</p>
<p><strong>PathPatternParser</strong> 兼容 <strong>AntPathMatcher</strong> 语法，并支持更多类型的路径模式。</p>
<p><strong>PathPatternParser</strong> “<strong>**</strong>“ <strong>多段匹配</strong>的支持<strong>仅允许在模式末尾使用</strong>。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.myxh.springboot.web.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> jakarta.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> MYXH</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2023/9/18</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloController</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 默认使用新版 PathPatternParser 进行路径匹配</span></span><br><span class="line"><span class="comment">     * 不能匹配 ** 在中间的情况，其他情况和 antPathMatcher语法兼容</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request 请求</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> path 路径</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> uri</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/a*/b?/**/&#123;p1:[a-f]+&#125;/**&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">hello</span><span class="params">(HttpServletRequest request, <span class="meta">@PathVariable(&quot;p1&quot;)</span> String path)</span></span><br><span class="line">    &#123;</span><br><span class="line">        log.info(<span class="string">&quot;路径变量 p1：&#123;&#125;&quot;</span>, path);</span><br><span class="line">        <span class="type">String</span> <span class="variable">uri</span> <span class="operator">=</span> request.getRequestURI();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> uri;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>总结：</p>
<ul>
<li><p>使用默认的路径匹配规则，是由 <code>PathPatternParser</code> 提供的。</p>
</li>
<li><p>如果路径中间需要有 **，替换成 ant 风格路径。</p>
</li>
</ul>
<h3 id="2-5-内容协商"><a href="#2-5-内容协商" class="headerlink" title="2.5 内容协商"></a>2.5 内容协商</h3><blockquote>
<p>一套系统适配多端数据返回。<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://reggie-xiamou.oss-cn-beijing.aliyuncs.com/img/a10328234c3c4ffe9427243e4dc250a1.png" alt="内容协商"></p>
</blockquote>
<h4 id="2-5-1-多端内容适配"><a href="#2-5-1-多端内容适配" class="headerlink" title="2.5.1 多端内容适配"></a>2.5.1 多端内容适配</h4><h5 id="2-5-1-1-默认规则"><a href="#2-5-1-1-默认规则" class="headerlink" title="2.5.1.1 默认规则"></a>2.5.1.1 默认规则</h5><p>1、<strong>SpringBoot 多端内容适配</strong>。</p>
<ul>
<li><p>① <strong>基于请求头内容协商</strong>：（默认开启）</p>
<ul>
<li><p>(1)客户端向服务端发送请求，携带 HTTP 标准的 <strong>Accept 请求头</strong>。</p>
<ul>
<li><p>[1] <strong>Accept</strong>: <code>application/json</code>、<code>text/xml</code>、<code>text/yaml</code>。</p>
</li>
<li><p>[2] 服务端根据客户端<strong>请求头期望的数据类型</strong>进行<strong>动态返回</strong>。</p>
</li>
</ul>
</li>
<li><p>② <strong>基于请求参数内容协商</strong>：（<strong>需要开启</strong>）</p>
<ul>
<li><p>[1] 发送请求 <code>GET /projects/spring-boot?format=json</code>。</p>
</li>
<li><p>[2] 匹配到 <code>@GetMapping(&quot;/projects/spring-boot&quot;)</code>。</p>
</li>
<li><p>[3] 根据<strong>参数协商</strong>，优先返回 json 类型数据 <strong>【需要开启参数匹配设置】</strong>。</p>
</li>
<li><p>[4] 发送请求 <code>GET /projects/spring-boot?format=xml</code>，优先返回 xml 类型数据。</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h5 id="2-5-1-2-效果演示"><a href="#2-5-1-2-效果演示" class="headerlink" title="2.5.1.2 效果演示"></a>2.5.1.2 效果演示</h5><blockquote>
<p>请求同一个接口，可以返回 json 和 xml 不同格式数据。</p>
</blockquote>
<p>1、引入支持写出 xml 内容依赖。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 支持返回 XML 格式数据 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.dataformat<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-dataformat-xml<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>2、标注注解。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.myxh.springboot.web.bean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.dataformat.xml.annotation.JacksonXmlRootElement;</span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> MYXH</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2023/9/18</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">// 可以写出为 xml 文档</span></span><br><span class="line"><span class="meta">@JacksonXmlRootElement</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="comment">// 和配置文件 person 前缀的所有配置进行绑定</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;user&quot;)</span></span><br><span class="line"><span class="comment">// 自动生成无参构造器</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="comment">// 自动生成全参构造器</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="comment">// 自动生成 JavaBean 属性的 getter/setter</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String userName;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">    <span class="keyword">private</span> String role;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3、开启基于请求参数的内容协商。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 开启基于请求参数的内容协商功能，默认参数名：format，默认此功能不开启</span></span><br><span class="line"><span class="attr">spring.mvc.contentnegotiation.favor-parameter</span>=<span class="string">true</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 指定内容协商时使用的参数名，默认是 format</span></span><br><span class="line"><span class="attr">spring.mvc.contentnegotiation.parameter-name</span>=<span class="string">type</span></span><br></pre></td></tr></table></figure>

<p>4、效果。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://reggie-xiamou.oss-cn-beijing.aliyuncs.com/img/12a8e780a3514c57962704b02f0276a7.png" alt="效果演示"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://reggie-xiamou.oss-cn-beijing.aliyuncs.com/img/d56d80cd944e45f88fd907fb1d59aa26.png" alt="效果演示"></p>
<h5 id="2-5-1-3-配置协商规则与支持类型"><a href="#2-5-1-3-配置协商规则与支持类型" class="headerlink" title="2.5.1.3 配置协商规则与支持类型"></a>2.5.1.3 配置协商规则与支持类型</h5><p>1、修改<strong>内容协商方式</strong>。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 开启基于请求参数的内容协商功能，默认参数名：format，默认此功能不开启</span></span><br><span class="line"><span class="attr">spring.mvc.contentnegotiation.favor-parameter</span>=<span class="string">true</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 指定内容协商时使用的参数名，默认是 format</span></span><br><span class="line"><span class="attr">spring.mvc.contentnegotiation.parameter-name</span>=<span class="string">type</span></span><br></pre></td></tr></table></figure>

<p>2、大多数 MediaType 都是开箱即用的。也可以<strong>自定义内容类型</strong>，例如：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 增加一种新的内容类型</span></span><br><span class="line"><span class="attr">spring.mvc.contentnegotiation.media-types.yaml</span>=<span class="string">text/yaml</span></span><br><span class="line"><span class="attr">spring.mvc.contentnegotiation.media-types.yml</span>=<span class="string">text/yml</span></span><br></pre></td></tr></table></figure>

<h4 id="2-5-2-自定义内容返回"><a href="#2-5-2-自定义内容返回" class="headerlink" title="2.5.2 自定义内容返回"></a>2.5.2 自定义内容返回</h4><h5 id="2-5-2-1-增加-yaml-返回支持"><a href="#2-5-2-1-增加-yaml-返回支持" class="headerlink" title="2.5.2.1 增加 yaml 返回支持"></a>2.5.2.1 增加 yaml 返回支持</h5><p>导入依赖。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 支持返回 YAML 格式数据 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.dataformat<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-dataformat-yaml<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>把对象写出成 YAML。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.myxh.springboot.web.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.myxh.springboot.web.bean.User;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> MYXH</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2023/9/18</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloController</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> JsonProcessingException</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        user.setId(<span class="number">1L</span>);</span><br><span class="line">        user.setUserName(<span class="string">&quot;MYXH&quot;</span>);</span><br><span class="line">        user.setPassword(<span class="string">&quot;520.ILY!&quot;</span>);</span><br><span class="line">        user.setAge(<span class="number">21</span>);</span><br><span class="line">        user.setEmail(<span class="string">&quot;1735350920@qq.com&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">YAMLFactory</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">YAMLFactory</span>().disable(YAMLGenerator.Feature.WRITE_DOC_START_MARKER);</span><br><span class="line">        <span class="type">ObjectMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>(factory);</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">userYaml</span> <span class="operator">=</span> mapper.writeValueAsString(user);</span><br><span class="line">        System.out.println(<span class="string">&quot;userYaml = &quot;</span> + userYaml);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>编写配置。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 增加一种新的内容类型</span></span><br><span class="line"><span class="attr">spring.mvc.contentnegotiation.media-types.yaml</span>=<span class="string">text/yaml</span></span><br><span class="line"><span class="attr">spring.mvc.contentnegotiation.media-types.yml</span>=<span class="string">text/yml</span></span><br></pre></td></tr></table></figure>

<p>增加 <code>HttpMessageConverter</code> 组件，专门负责把对象写出为 yaml 格式。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.myxh.springboot.web.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.myxh.springboot.web.component.MyYamlHttpMessageConverter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.converter.HttpMessageConverter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> MYXH</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2023/9/18</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">// 禁用 Spring Boot 的默认配置</span></span><br><span class="line"><span class="comment">// @EnableWebMvc</span></span><br><span class="line"><span class="comment">// 这是一个配置类，给容器中放一个 WebMvcConfigurer 组件，就能自定义底层</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyConfig</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> WebMvcConfigurer <span class="title function_">webMvcConfigurer</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">WebMvcConfigurer</span>()</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * 配置一个能把对象转为 yaml 的 messageConverter</span></span><br><span class="line"><span class="comment">             *</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@param</span> converters 最初是转换器的空列表</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">configureMessageConverters</span><span class="params">(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters)</span></span><br><span class="line">            &#123;</span><br><span class="line">                converters.add(<span class="keyword">new</span> <span class="title class_">MyYamlHttpMessageConverter</span>());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="2-5-2-2-思考：如何增加其他"><a href="#2-5-2-2-思考：如何增加其他" class="headerlink" title="2.5.2.2 思考：如何增加其他"></a>2.5.2.2 思考：如何增加其他</h5><ul>
<li><p>配置媒体类型支持:</p>
<ul>
<li><code>spring.mvc.contentnegotiation.media-types.yaml=text/yaml</code>。</li>
</ul>
</li>
<li><p>编写对应的 <code>HttpMessageConverter</code>，要告诉 Boot 这个支持的媒体类型。</p>
<ul>
<li>按照 HttpMessageConverter 的示例写法。</li>
</ul>
</li>
<li><p>把 MessageConverter 组件加入到底层。</p>
<ul>
<li>容器中放一个 <code>WebMvcConfigurer</code> 组件，并配置底层的 <code>MessageConverter</code>。</li>
</ul>
</li>
</ul>
<h5 id="2-5-2-3-HttpMessageConverter-的示例写法"><a href="#2-5-2-3-HttpMessageConverter-的示例写法" class="headerlink" title="2.5.2.3 HttpMessageConverter 的示例写法"></a>2.5.2.3 HttpMessageConverter 的示例写法</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.myxh.springboot.web.component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.dataformat.yaml.YAMLFactory;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.dataformat.yaml.YAMLGenerator;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.HttpInputMessage;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.HttpOutputMessage;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.MediaType;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.converter.AbstractHttpMessageConverter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.converter.HttpMessageNotReadableException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.converter.HttpMessageNotWritableException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.OutputStream;</span><br><span class="line"><span class="keyword">import</span> java.nio.charset.StandardCharsets;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> MYXH</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2023/9/18</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span></span></span><br><span class="line"><span class="comment"> * 自定义的 YAML HTTP 消息转换器</span></span><br><span class="line"><span class="comment"> * 用于将对象转换为 YAML 格式的内容</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyYamlHttpMessageConverter</span> <span class="keyword">extends</span> <span class="title class_">AbstractHttpMessageConverter</span>&lt;Object&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 将对象转换为 YAML 的 ObjectMapper</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ObjectMapper objectMapper;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyYamlHttpMessageConverter</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 告诉 SpringBoot 这个 MessageConverter 支持哪种媒体类型</span></span><br><span class="line">        <span class="built_in">super</span>(<span class="keyword">new</span> <span class="title class_">MediaType</span>(<span class="string">&quot;text&quot;</span>, <span class="string">&quot;yaml&quot;</span>, StandardCharsets.UTF_8),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">MediaType</span>(<span class="string">&quot;text&quot;</span>, <span class="string">&quot;yml&quot;</span>, StandardCharsets.UTF_8));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建 YAMLFactory 并禁用写入文档起始标记</span></span><br><span class="line">        <span class="type">YAMLFactory</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">YAMLFactory</span>().</span><br><span class="line">                disable(YAMLGenerator.Feature.WRITE_DOC_START_MARKER);</span><br><span class="line">        <span class="built_in">this</span>.objectMapper = <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>(factory);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 判断该转换器是否支持将指定类型的对象转换为 YAML</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> clazz 要测试支持的类</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 如果支持转换，则返回 true；否则返回 false</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="type">boolean</span> <span class="title function_">supports</span><span class="params">(Class&lt;?&gt; clazz)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 只要是对象类型，不是基本类型和数组类型，都支持</span></span><br><span class="line">        <span class="keyword">return</span> !clazz.isPrimitive() &amp;&amp; !clazz.isArray();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 从 HTTP 输入消息中读取数据并将其转换为指定类型的对象</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@code</span> <span class="doctag">@RequestBody</span>&#125; 把对象怎么读进来</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> clazz        要返回的对象类型</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> inputMessage 要从中读取的 HTTP 输入消息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 转换后的对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException                     IO 异常</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> HttpMessageNotReadableException Http 消息不可读异常</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Object <span class="title function_">readInternal</span><span class="params">(Class&lt;?&gt; clazz, HttpInputMessage inputMessage)</span> <span class="keyword">throws</span> IOException, HttpMessageNotReadableException</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> objectMapper.readValue(inputMessage.getBody(), clazz);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将指定对象写入 HTTP 输出消息</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@code</span> <span class="doctag">@ResponseBody</span>&#125; 把对象怎么写出去</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> methodReturnValue 要写入输出消息的对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> outputMessage     要写入的 HTTP 输出消息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException                     IO 异常</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> HttpMessageNotWritableException Http 消息不可写入异常</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">writeInternal</span><span class="params">(Object methodReturnValue, HttpOutputMessage outputMessage)</span> <span class="keyword">throws</span> IOException, HttpMessageNotWritableException</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 使用 try-with-resources 语句以自动关闭流</span></span><br><span class="line">        <span class="keyword">try</span> (<span class="type">OutputStream</span> <span class="variable">os</span> <span class="operator">=</span> outputMessage.getBody())</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">this</span>.objectMapper.writeValue(os, methodReturnValue);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-5-3-内容协商原理-HttpMessageConverter"><a href="#2-5-3-内容协商原理-HttpMessageConverter" class="headerlink" title="2.5.3 内容协商原理 HttpMessageConverter"></a>2.5.3 内容协商原理 HttpMessageConverter</h4><blockquote>
<p><strong>HttpMessageConverter</strong> 怎么工作？合适工作？</p>
<p>定制 <strong>HttpMessageConverter</strong> 来实现多端内容协商。</p>
<p>编写 <strong>WebMvcConfigurer</strong> 提供的 <strong>configureMessageConverters</strong> 底层，修改底层的 <strong>MessageConverter</strong>。</p>
</blockquote>
<h5 id="2-5-3-1-ResponseBody-由-HttpMessageConverter-处理"><a href="#2-5-3-1-ResponseBody-由-HttpMessageConverter-处理" class="headerlink" title="2.5.3.1 @ResponseBody 由 HttpMessageConverter 处理"></a>2.5.3.1 @ResponseBody 由 HttpMessageConverter 处理</h5><blockquote>
<p>标注了 <strong>@ResponseBody</strong> 的返回值 将会由支持它的 <strong>HttpMessageConverter</strong> 写给浏览器。</p>
</blockquote>
<p>1、如果 controller 方法的返回值标注了 <code>@ResponseBody</code> 注解。</p>
<ul>
<li><p>① 请求进来先来到 <code>DispatcherServlet</code> 的 <code>doDispatch()</code> 进行处理。</p>
</li>
<li><p>② 找到一个 <code>HandlerAdapter</code> 适配器，利用适配器执行目标方法。</p>
</li>
<li><p>③ <code>RequestMappingHandlerAdapter</code> 来执行，调用 <code>invokeHandlerMethod()</code> 来执行目标方法。</p>
</li>
<li><p>④ 目标方法执行之前，准备好两个东西。</p>
<ul>
<li><p>(1) <code>HandlerMethodArgumentResolver</code>：参数解析器，确定目标方法每个参数值。</p>
</li>
<li><p>(2) <code>HandlerMethodReturnValueHandler</code>：返回值处理器，确定目标方法的返回值改怎么处理。</p>
</li>
</ul>
</li>
<li><p>⑤ <code>RequestMappingHandlerAdapter</code> 里面的 <code>invokeAndHandle()</code> 真正执行目标方法。</p>
</li>
<li><p>⑥ 目标方法执行完成，会返回<strong>返回值对象</strong>。</p>
</li>
<li><p>⑦ <strong>找到一个合适的返回值处理器</strong> <code>HandlerMethodReturnValueHandler</code>。</p>
</li>
<li><p>⑧ 最终找到 <code>RequestResponseBodyMethodProcessor</code> 能处理标注了 <code>@ResponseBody</code> 注解的方法。</p>
</li>
<li><p>⑨ <code>RequestResponseBodyMethodProcessor</code> 调用 <code>writeWithMessageConverters</code>，利用 <code>MessageConverter</code> 把返回值写出去。</p>
</li>
</ul>
<blockquote>
<p>上面解释：**@ResponseBody** 由 <strong>HttpMessageConverter</strong> 处理。</p>
</blockquote>
<p>2、<code>HttpMessageConverter</code> 会<strong>先进行内容协商</strong>。</p>
<ul>
<li><p>① 遍历所有的 <code>MessageConverter</code> 看谁支持这种<strong>内容类型的数据</strong>。</p>
</li>
<li><p>② 默认 <code>MessageConverter</code> 有以下 10 个。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://reggie-xiamou.oss-cn-beijing.aliyuncs.com/img/58a61c3be2674784b514287884e87995.png" alt="@ResponseBody 由 HttpMessageConverter 处理"></p>
</li>
<li><p>③ 最终因为要 <code>json</code> 所以 <code>MappingJackson2HttpMessageConverter</code> 支持写出 json。</p>
</li>
<li><p>④ jackson 用 <code>ObjectMapper</code> 把对象写出去。</p>
</li>
</ul>
<h5 id="2-5-3-2-WebMvcAutoConfiguration-提供几种默认-HttpMessageConverters"><a href="#2-5-3-2-WebMvcAutoConfiguration-提供几种默认-HttpMessageConverters" class="headerlink" title="2.5.3.2 WebMvcAutoConfiguration 提供几种默认 HttpMessageConverters"></a>2.5.3.2 WebMvcAutoConfiguration 提供几种默认 HttpMessageConverters</h5><ul>
<li><p><code>EnableWebMvcConfiguration</code> 通过 <code>addDefaultHttpMessageConverters</code> 添加了默认的 <code>MessageConverter</code>，如下：</p>
<ul>
<li><p><code>ByteArrayHttpMessageConverter</code>：支持字节数据读写。</p>
</li>
<li><p><code>StringHttpMessageConverter</code>：支持字符串读写。</p>
</li>
<li><p><code>ResourceHttpMessageConverter</code>：支持资源读写。</p>
</li>
<li><p><code>ResourceRegionHttpMessageConverter</code>: 支持分区资源写出。</p>
</li>
<li><p><code>AllEncompassingFormHttpMessageConverter</code>：支持表单 xml&#x2F;json 读写。</p>
</li>
<li><p><code>MappingJackson2HttpMessageConverter</code>：支持请求响应体 Json 读写。</p>
</li>
</ul>
</li>
</ul>
<p>默认 <code>MessageConverter</code> 有以下 8 个：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://reggie-xiamou.oss-cn-beijing.aliyuncs.com/img/b7ae4301f317437283c75ec7330235bd.png" alt="WebMvcAutoConfiguration 提供几种默认 HttpMessageConverters"></p>
<blockquote>
<p>系统提供默认的 MessageConverter 功能有限，仅用于 json 或者普通返回数据。额外增加新的内容协商功能，必须增加新的 <strong>HttpMessageConverter</strong>。</p>
</blockquote>
<h3 id="2-6-模板引擎"><a href="#2-6-模板引擎" class="headerlink" title="2.6 模板引擎"></a>2.6 模板引擎</h3><blockquote>
<p>由于 <strong>SpringBoot</strong> 使用了<strong>嵌入式 Servlet 容器</strong>。所以 <strong>JSP</strong> 默认是<strong>不能使用的</strong>。</p>
<p>如果需要<strong>服务端页面渲染</strong>，优先考虑使用<strong>模板引擎</strong>。</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://reggie-xiamou.oss-cn-beijing.aliyuncs.com/img/87e293d7ccb74b9bb36241a6aaddf0dd.png" alt="模板引擎"></p>
<p><strong>模板引擎</strong>页面默认放在 <strong>src&#x2F;main&#x2F;resources&#x2F;templates</strong>。</p>
<p><strong>SpringBoot</strong> 包含以下模板引擎的自动配置。</p>
<ul>
<li><p>FreeMarker</p>
</li>
<li><p>Groovy</p>
</li>
<li><p><strong>Thymeleaf</strong></p>
</li>
<li><p>Mustache</p>
</li>
</ul>
<p><strong>Thymeleaf 官网</strong>：<a target="_blank" rel="noopener" href="https://www.thymeleaf.org/">https://www.thymeleaf.org/</a> 。</p>
<h4 id="2-6-1-Thymeleaf-整合"><a href="#2-6-1-Thymeleaf-整合" class="headerlink" title="2.6.1 Thymeleaf 整合"></a>2.6.1 Thymeleaf 整合</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>自动配置原理：</p>
<p>1、开启了 <code>org.springframework.boot.autoconfigure.thymeleaf.ThymeleafAutoConfiguration</code> 自动配置。</p>
<p>2、属性绑定在 <code>ThymeleafProperties</code> 中，对应配置文件 <code>spring.thymeleaf</code> 内容。</p>
<p>3、所有的模板页面默认在 <code>classpath:/templates/</code> 文件夹下。</p>
<p>4、默认效果。</p>
<ul>
<li><p>① 所有的模板页面在 <code>classpath:/templates/</code> 下面找。</p>
</li>
<li><p>② 找后缀名为 <code>.html</code> 的页面。</p>
</li>
</ul>
<h4 id="2-6-2-基础语法"><a href="#2-6-2-基础语法" class="headerlink" title="2.6.2 基础语法"></a>2.6.2 基础语法</h4><h5 id="2-6-2-1-核心用法"><a href="#2-6-2-1-核心用法" class="headerlink" title="2.6.2.1 核心用法"></a>2.6.2.1 核心用法</h5><p><code>th:xxx</code>：<strong>动态渲染指定的 html 标签属性值、或者 th 指令（遍历、判断等）</strong>。</p>
<ul>
<li><p><code>th:text</code>：标签体内文本值渲染。</p>
<ul>
<li><code>th:utext</code>：不会转义，显示为 html 原本的样子。</li>
</ul>
</li>
<li><p><code>th:属性</code>：标签指定属性渲染。</p>
</li>
<li><p><code>th:attr</code>：标签任意属性渲染。</p>
</li>
<li><p><code>th:if</code>、<code>th:each</code> <code>...</code> ：其他 th 指令。</p>
</li>
<li><p>例如：</p>
</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>欢迎页<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>你好，<span class="tag">&lt;<span class="name">span</span> <span class="attr">th:utext</span>=<span class="string">&quot;$&#123;message&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">hr</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>1、Thymeleaf 基础语法<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>1.1 th:text：替换标签体的内容，会转义<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;message&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span></span><br><span class="line">      1.2 th:utext: 替换标签体的内容，不会转义 html 标签，真正显示为 html</span><br><span class="line">      该有的样式</span><br><span class="line">    <span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">th:utext</span>=<span class="string">&quot;$&#123;message&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>1.3 th:任意 html 属性，动态替换任意属性的值<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span></span></span><br><span class="line"><span class="tag">      <span class="attr">th:src</span>=<span class="string">&quot;@&#123;$&#123;imageUrl&#125;&#125;&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">src</span>=<span class="string">&quot;大户爱.png&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">style</span>=<span class="string">&quot;width:300px;&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">alt</span>=<span class="string">&quot;大户爱&quot;</span></span></span><br><span class="line"><span class="tag">    /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>1.4 th:attr：任意属性指定<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span></span></span><br><span class="line"><span class="tag">      <span class="attr">th:attr</span>=<span class="string">&quot;src=@&#123;$&#123;imageUrl&#125;&#125;,style=$&#123;style&#125;&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">src</span>=<span class="string">&quot;大户爱.png&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">alt</span>=<span class="string">&quot;大户爱&quot;</span></span></span><br><span class="line"><span class="tag">    /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>1.5 th：其他指令<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span></span></span><br><span class="line"><span class="tag">      <span class="attr">th:src</span>=<span class="string">&quot;@&#123;$&#123;imageUrl&#125;&#125;&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">th:style</span>=<span class="string">&quot;$&#123;style&#125;&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">th:if</span>=<span class="string">&quot;$&#123;show&#125;&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">src</span>=<span class="string">&quot;大户爱.png&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">alt</span>=<span class="string">&quot;大户爱&quot;</span></span></span><br><span class="line"><span class="tag">    /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>1.6 @&#123;&#125; 专门用来取各种路径<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span></span></span><br><span class="line"><span class="tag">      <span class="attr">th:src</span>=<span class="string">&quot;@&#123;$&#123;imageUrl&#125;&#125;&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">src</span>=<span class="string">&quot;大户爱.png&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">style</span>=<span class="string">&quot;width:300px;&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">alt</span>=<span class="string">&quot;大户爱&quot;</span></span></span><br><span class="line"><span class="tag">    /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>1.7 字符串转换为大写<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;#strings.toUpperCase(name)&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>1.8 字符串拼接<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;&#x27;前缀&#x27;+name+&#x27;后缀&#x27;&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">th:text</span>=<span class="string">&quot;|前缀$&#123;name&#125;后缀|&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>表达式</code>：<strong>用来动态取值</strong>。</p>
<ul>
<li><p><code>$\&#123;\&#125;</code>：**变量取值；使用 model 共享给页面的值都直接用 ${}**。</p>
</li>
<li><p><code>@&#123;&#125;</code>：<strong>url 路径</strong>。</p>
</li>
<li><p><code>#&#123;&#125;</code>：国际化消息。</p>
</li>
<li><p><code>~&#123;&#125;</code>：片段引用。</p>
</li>
<li><p><code>\*&#123;&#125;</code>：变量选择：需要配合 th:object 绑定对象。</p>
</li>
</ul>
<p><code>系统工具&amp;内置对象</code>：<strong>详细文档</strong>。</p>
<ul>
<li><p><code>param</code>：请求参数对象。</p>
</li>
<li><p><code>session</code>：session 对象。</p>
</li>
<li><p><code>application</code>：application 对象。</p>
</li>
<li><p><code>#execInfo</code>：模板执行信息。</p>
</li>
<li><p><code>#messages</code>：国际化消息。</p>
</li>
<li><p><code>#uris</code>：uri&#x2F;url 工具。</p>
</li>
<li><p><code>#conversions</code>：类型转换工具。</p>
</li>
<li><p><code>#dates</code>：日期工具，是 <code>java.util.Date</code> 对象的工具类。</p>
</li>
<li><p><code>#calendars</code>：类似 #dates，只不过是 <code>java.util.Calendar</code> 对象的工具类。</p>
</li>
<li><p><code>#temporals</code>：JDK8+ <code>java.time</code> API 工具类。</p>
</li>
<li><p><code>#numbers</code>：数字操作工具。</p>
</li>
<li><p><code>#strings</code>：字符串操作。</p>
</li>
<li><p><code>#objects</code>：对象操作。</p>
</li>
<li><p><code>#bools</code>：bool 操作。</p>
</li>
<li><p><code>#arrays</code>：array 工具。</p>
<p>-<code>#lists</code>：list 工具。</p>
</li>
<li><p><code>#sets</code>：set 工具。</p>
</li>
<li><p><code>#maps</code>：map 工具。</p>
</li>
<li><p><code>#aggregates</code>：集合聚合工具（sum、avg）。</p>
</li>
<li><p><code>#ids</code>：id 生成工具。</p>
</li>
</ul>
<h5 id="2-6-2-2-语法示例"><a href="#2-6-2-2-语法示例" class="headerlink" title="2.6.2.2 语法示例"></a>2.6.2.2 语法示例</h5><p><strong>表达式</strong>：</p>
<ul>
<li><p>变量取值：<code>$&#123;...&#125;</code></p>
</li>
<li><p>url 取值：<code>@&#123;...&#125;</code></p>
</li>
<li><p>国际化消息：<code>#&#123;...&#125;</code></p>
</li>
<li><p>变量选择：<code>\*&#123;...&#125;</code></p>
</li>
<li><p>片段引用: <code>~&#123;...&#125;</code></p>
</li>
</ul>
<p><strong>常见</strong>：</p>
<ul>
<li><p>文本：<code>&#39;one text&#39;</code>，<code>&#39;another one!&#39;</code>，…</p>
</li>
<li><p>数字：<code>0</code>, <code>12</code>, <code>3.0</code>, <code>15.6</code>, …</p>
</li>
<li><p>布尔：<code>true</code>、<code>false</code></p>
</li>
<li><p>null: <code>null</code></p>
</li>
<li><p>变量名：<code>one</code>，<code>sometext</code>，<code>main</code> …</p>
</li>
</ul>
<p><strong>文本操作</strong>：</p>
<ul>
<li><p>拼串：<code>+</code></p>
</li>
<li><p>文本替换：<code>| The name is $&#123;name&#125; |</code></p>
</li>
</ul>
<p><strong>布尔操作</strong>：</p>
<ul>
<li><p>二进制运算：<code>and</code>, <code>or</code></p>
</li>
<li><p>取反：<code>!</code>, <code>not</code></p>
</li>
</ul>
<p><strong>比较运算</strong>：</p>
<ul>
<li><p>比较：<code>&lt;</code>，<code>&gt;</code>，<code>&lt;=</code>，<code>&gt;=</code>（<code>lt</code>，<code>gt</code>，<code>le</code>,<code>ge</code>）</p>
</li>
<li><p>等值运算：<code>==</code>，<code>!=</code>（<code>eq</code>，<code>ne</code>）</p>
</li>
</ul>
<p><strong>条件运算</strong>：</p>
<ul>
<li><p>if-then：<code>(if)?(then)</code></p>
</li>
<li><p>if-then-else：<code>(if)?(then):(else)</code></p>
</li>
<li><p>default：<code>(value)?:(defaultValue)</code></p>
</li>
</ul>
<p><strong>特殊语法</strong>：</p>
<ul>
<li>无操作：<code>\_</code></li>
</ul>
<p><strong>所有以上都可以嵌套组合</strong>。</p>
<h5 id="2-6-2-3-属性设置"><a href="#2-6-2-3-属性设置" class="headerlink" title="2.6.2.3 属性设置"></a>2.6.2.3 属性设置</h5><p>1、<code>th:href=&quot;@&#123;/product/list&#125;&quot;</code></p>
<p>2、<code>th:attr=&quot;class=$&#123;active&#125;&quot;</code></p>
<p>3、<code>th:attr=&quot;src=@&#123;/images/image.png&#125;,title=$&#123;logo&#125;,alt=#&#123;logo&#125;&quot;</code></p>
<p>4、<code>th:checked=&quot;$&#123;user.active&#125;&quot;</code></p>
<h5 id="2-6-2-4-遍历"><a href="#2-6-2-4-遍历" class="headerlink" title="2.6.2.4 遍历"></a>2.6.2.4 遍历</h5><blockquote>
<p>语法：<strong>th:each&#x3D;”元素名,迭代状态 : ${集合}”</strong></p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>用户列表页<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span></span></span><br><span class="line"><span class="tag">      <span class="attr">href</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">integrity</span>=<span class="string">&quot;sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">crossorigin</span>=<span class="string">&quot;anonymous&quot;</span></span></span><br><span class="line"><span class="tag">    /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 导航区使用公共部分进行替换 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- ~&#123; 模板名 :: 片段名&#125; --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">th:replace</span>=<span class="string">&quot;~&#123;common :: myheader&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">table</span> <span class="attr">class</span>=<span class="string">&quot;table&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">thead</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span> <span class="attr">scope</span>=<span class="string">&quot;col&quot;</span>&gt;</span>序号<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span> <span class="attr">scope</span>=<span class="string">&quot;col&quot;</span>&gt;</span>用户名<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span> <span class="attr">scope</span>=<span class="string">&quot;col&quot;</span>&gt;</span>密码<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span> <span class="attr">scope</span>=<span class="string">&quot;col&quot;</span>&gt;</span>年龄<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span> <span class="attr">scope</span>=<span class="string">&quot;col&quot;</span>&gt;</span>邮箱<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span> <span class="attr">scope</span>=<span class="string">&quot;col&quot;</span>&gt;</span>角色<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span> <span class="attr">scope</span>=<span class="string">&quot;col&quot;</span>&gt;</span>状态信息<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">thead</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">tbody</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">tr</span> <span class="attr">th:each</span>=<span class="string">&quot;user, stats : $&#123;userList&#125;&quot;</span> <span class="attr">th:object</span>=<span class="string">&quot;$&#123;user&#125;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span> <span class="attr">scope</span>=<span class="string">&quot;row&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;user.id&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- &lt;td th:text=&quot;$&#123;user.userName&#125;&quot;&gt;&lt;/td&gt; --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;*&#123;userName&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>[[$&#123;user.password&#125;]]<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">              <span class="attr">th:text</span>=<span class="string">&quot;|$&#123;user.age&#125;($&#123;user.age &gt;= 18 ? &#x27;成年&#x27; : &#x27;未成年&#x27;&#125;)|&quot;</span></span></span><br><span class="line"><span class="tag">            &gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">              <span class="attr">th:if</span>=<span class="string">&quot;$&#123;#strings.isEmpty(user.email)&#125;&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">th:text</span>=<span class="string">&quot;&#x27;联系不上&#x27;&quot;</span></span></span><br><span class="line"><span class="tag">            &gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">              <span class="attr">th:if</span>=<span class="string">&quot;$&#123;not #strings.isEmpty(user.email)&#125;&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">th:text</span>=<span class="string">&quot;$&#123;user.email&#125;&quot;</span></span></span><br><span class="line"><span class="tag">            &gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:switch</span>=<span class="string">&quot;$&#123;user.role&#125;&quot;</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">button</span> <span class="attr">th:case</span>=<span class="string">&quot;&#x27;root&#x27;&quot;</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-primary&quot;</span>&gt;</span></span><br><span class="line">                root 用户</span><br><span class="line">              <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">button</span> <span class="attr">th:case</span>=<span class="string">&quot;&#x27;admin&#x27;&quot;</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-secondary&quot;</span>&gt;</span></span><br><span class="line">                管理员</span><br><span class="line">              <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">button</span> <span class="attr">th:case</span>=<span class="string">&quot;&#x27;test&#x27;&quot;</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-success&quot;</span>&gt;</span></span><br><span class="line">                测试员</span><br><span class="line">              <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">button</span> <span class="attr">th:case</span>=<span class="string">&quot;&#x27;user&#x27;&quot;</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-light&quot;</span>&gt;</span></span><br><span class="line">                用户</span><br><span class="line">              <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">              index（索引）：[[$&#123;stats.index&#125;]]<span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">              count（计数）：[[$&#123;stats.count&#125;]]<span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">              size（大小）：[[$&#123;stats.size&#125;]]<span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">              current（当前对象）：[[$&#123;stats.current&#125;]]<span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">              even(true)/odd(false)（奇数/偶数）：[[$&#123;stats.even&#125;]]<span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">              first（第一个）：[[$&#123;stats.first&#125;]]<span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">              last（最后的）：[[$&#123;stats.last&#125;]]<span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span></span></span><br><span class="line"><span class="tag">      <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">integrity</span>=<span class="string">&quot;sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">crossorigin</span>=<span class="string">&quot;anonymous&quot;</span></span></span><br><span class="line"><span class="tag">    &gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>iterStat 有以下属性：</p>
<ul>
<li><p>index：当前遍历元素的索引，从 0 开始。</p>
</li>
<li><p>count：当前遍历元素的索引，从 1 开始。</p>
</li>
<li><p>size：需要遍历元素的总数量。</p>
</li>
<li><p>current：当前正在遍历的元素对象。</p>
</li>
<li><p>even&#x2F;odd：是否为偶数&#x2F;奇数行。</p>
</li>
<li><p>first：是否第一个元素。</p>
</li>
<li><p>last：是否最后一个元素。</p>
</li>
</ul>
<h5 id="2-6-2-5-判断"><a href="#2-6-2-5-判断" class="headerlink" title="2.6.2.5 判断"></a>2.6.2.5 判断</h5><p><strong>th:if</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;|$&#123;user.age&#125;($&#123;user.age &gt;= 18 ? &#x27;成年&#x27; : &#x27;未成年&#x27;&#125;)|&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;#strings.isEmpty(user.email)&#125;&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;&#x27;联系不上&#x27;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;not #strings.isEmpty(user.email)&#125;&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;user.email&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>th:switch</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">td</span> <span class="attr">th:switch</span>=<span class="string">&quot;$&#123;user.role&#125;&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">th:case</span>=<span class="string">&quot;&#x27;root&#x27;&quot;</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-primary&quot;</span>&gt;</span></span><br><span class="line">    root 用户</span><br><span class="line">  <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">th:case</span>=<span class="string">&quot;&#x27;admin&#x27;&quot;</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-secondary&quot;</span>&gt;</span></span><br><span class="line">    管理员</span><br><span class="line">  <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">th:case</span>=<span class="string">&quot;&#x27;test&#x27;&quot;</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-success&quot;</span>&gt;</span>测试员<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">th:case</span>=<span class="string">&quot;&#x27;user&#x27;&quot;</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-light&quot;</span>&gt;</span>用户<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="2-6-2-6-属性优先级"><a href="#2-6-2-6-属性优先级" class="headerlink" title="2.6.2.6 属性优先级"></a>2.6.2.6 属性优先级</h5><ul>
<li><p>片段。</p>
</li>
<li><p>遍历。</p>
</li>
<li><p>判断。</p>
</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">tr</span> <span class="attr">th:each</span>=<span class="string">&quot;user, stats : $&#123;userList&#125;&quot;</span> <span class="attr">th:object</span>=<span class="string">&quot;$&#123;user&#125;&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">th</span> <span class="attr">scope</span>=<span class="string">&quot;row&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;user.id&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- &lt;td th:text=&quot;$&#123;user.userName&#125;&quot;&gt;&lt;/td&gt; --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;*&#123;userName&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>顺序</th>
<th>特性</th>
<th>属性</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>片段包含。</td>
<td><code>th:insert</code>、<code>th:replace</code></td>
</tr>
<tr>
<td>2</td>
<td>遍历。</td>
<td><code>th:each</code></td>
</tr>
<tr>
<td>3</td>
<td>判断。</td>
<td><code>th:if</code>、<code>th:unless</code>、<code>th:switch</code>、<code>th:case</code></td>
</tr>
<tr>
<td>4</td>
<td>定义本地变量。</td>
<td><code>th:object</code>、<code>th:with</code></td>
</tr>
<tr>
<td>5</td>
<td>通用方式属性修改。</td>
<td><code>th:attr</code>、<code>th:attrprepend</code>、<code>th:attrappend</code></td>
</tr>
<tr>
<td>6</td>
<td>指定属性修改。</td>
<td><code>th:value</code>、<code>th:href</code>、<code>th:src</code>、<code>...</code></td>
</tr>
<tr>
<td>7</td>
<td>文本值。</td>
<td><code>th:text</code>、<code>th:utext</code></td>
</tr>
<tr>
<td>8</td>
<td>片段指定。</td>
<td><code>th:fragment</code></td>
</tr>
<tr>
<td>9</td>
<td>片段移除。</td>
<td><code>th:remove</code></td>
</tr>
</tbody></table>
<h5 id="2-6-2-7-行内写法"><a href="#2-6-2-7-行内写法" class="headerlink" title="2.6.2.7 行内写法"></a>2.6.2.7 行内写法</h5><p><code>[[...]]</code> 或 <code>[(...)]</code>。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">tr</span> <span class="attr">th:each</span>=<span class="string">&quot;user, stats : $&#123;userList&#125;&quot;</span> <span class="attr">th:object</span>=<span class="string">&quot;$&#123;user&#125;&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">th</span> <span class="attr">scope</span>=<span class="string">&quot;row&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;user.id&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- &lt;td th:text=&quot;$&#123;user.userName&#125;&quot;&gt;&lt;/td&gt; --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;*&#123;userName&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">td</span>&gt;</span>[[$&#123;user.password&#125;]]<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="2-6-2-8-变量选择"><a href="#2-6-2-8-变量选择" class="headerlink" title="2.6.2.8 变量选择"></a>2.6.2.8 变量选择</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">tr</span> <span class="attr">th:each</span>=<span class="string">&quot;user, stats : $&#123;userList&#125;&quot;</span> <span class="attr">th:object</span>=<span class="string">&quot;$&#123;user&#125;&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">th</span> <span class="attr">scope</span>=<span class="string">&quot;row&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;user.id&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;*&#123;userName&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>等同于</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">tr</span> <span class="attr">th:each</span>=<span class="string">&quot;user, stats : $&#123;userList&#125;&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">th</span> <span class="attr">scope</span>=<span class="string">&quot;row&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;user.id&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;user.userName&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="2-6-2-9-模板布局"><a href="#2-6-2-9-模板布局" class="headerlink" title="2.6.2.9 模板布局"></a>2.6.2.9 模板布局</h5><ul>
<li><p>定义模板：<code>th:fragment</code></p>
</li>
<li><p>引用模板：<code>~&#123;templatename::selector&#125;</code></p>
</li>
<li><p>插入模板：<code>th:insert</code>、<code>th:replace</code></p>
</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 导航区使用公共部分进行替换 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- ~&#123; 模板名 :: 片段名&#125; --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:replace</span>=<span class="string">&quot;~&#123;common :: myheader&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="2-6-2-10-devtools"><a href="#2-6-2-10-devtools" class="headerlink" title="2.6.2.10 devtools"></a>2.6.2.10 devtools</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 热启动功能 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>修改页面后，<code>ctrl+F9</code> 刷新效果。</p>
<p>Java 代码的修改，如果 <code>devtools</code> 热启动了，可能会引起一些 bug，难以排查。</p>
<h3 id="2-7-国际化"><a href="#2-7-国际化" class="headerlink" title="2.7 国际化"></a>2.7 国际化</h3><p>国际化的自动配置参照 <code>MessageSourceAutoConfiguration</code>。</p>
<p><strong>实现步骤</strong>：</p>
<p>1、Spring Boot 在类路径根下查找 <code>messages</code> 资源绑定文件。文件名为：<code>messages.properties</code>。</p>
<p>2、多语言可以定义多个消息文件，命名为 <code>messages\_区域代码.properties</code>。例如：</p>
<ul>
<li><p>① <code>messages.properties</code>：默认。</p>
</li>
<li><p>② <code>messages_zh_CN.properties</code>：中文环境。</p>
</li>
<li><p>③ <code>messages_en_US.properties</code>：英语环境。</p>
</li>
</ul>
<p>3、在<strong>程序中可以自动注入</strong> <code>MessageSource</code> 组件，获取国际化的配置项值。</p>
<p>4、在<strong>页面中可以使用表达式</strong> <code>#&#123;&#125;</code> 获取国际化的配置项值。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.myxh.springboot.web.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> jakarta.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.MessageSource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Locale;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> MYXH</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2023/9/18</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">//适配服务端清染，前后不分离模式</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WelcomeController</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 国际化获取消息的组件</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    MessageSource messageSource;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/message&quot;)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">message</span><span class="params">(HttpServletRequest request)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">Locale</span> <span class="variable">locale</span> <span class="operator">=</span> request.getLocale();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 利用代码的方式获取国际化配置文件中指定的配置项的值</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">login</span> <span class="operator">=</span> messageSource.getMessage(<span class="string">&quot;login&quot;</span>, <span class="literal">null</span>, locale);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> login;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-8-错误处理"><a href="#2-8-错误处理" class="headerlink" title="2.8 错误处理"></a>2.8 错误处理</h3><h4 id="2-8-1-默认机制"><a href="#2-8-1-默认机制" class="headerlink" title="2.8.1 默认机制"></a>2.8.1 默认机制</h4><blockquote>
<p><strong>错误处理的自动配置</strong>都在 <strong>ErrorMvcAutoConfiguration</strong> 中，两大核心机制：</p>
<ul>
<li><p>1、SpringBoot 会<strong>自适应</strong>处理错误，<strong>响应页面</strong>或 <strong>JSON 数据</strong>。</p>
</li>
<li><p>2、<strong>SpringMVC 的错误处理机制</strong>依然保留，<strong>MVC 处理不了</strong>，才会<strong>交给 boot 进行处理</strong>。</p>
</li>
</ul>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://reggie-xiamou.oss-cn-beijing.aliyuncs.com/img/047b394477b042fcb849f1cce23f79d1.png" alt="默认机制"></p>
<ul>
<li><p>发生错误以后，转发给&#x2F;error 路径，SpringBoot 在底层写好一个 BasicErrorController 的组件，专门处理这个请求。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 返回 HTML</span></span><br><span class="line"><span class="meta">@RequestMapping(produces = MediaType.TEXT_HTML_VALUE)</span></span><br><span class="line"><span class="keyword">public</span> ModelAndView <span class="title function_">errorHtml</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">HttpStatus</span> <span class="variable">status</span> <span class="operator">=</span> getStatus(request);</span><br><span class="line">    Map&lt;String, Object&gt; model = Collections</span><br><span class="line">        .unmodifiableMap(getErrorAttributes(request, getErrorAttributeOptions(request, MediaType.TEXT_HTML)));</span><br><span class="line">    response.setStatus(status.value());</span><br><span class="line">    <span class="type">ModelAndView</span> <span class="variable">modelAndView</span> <span class="operator">=</span> resolveErrorView(request, response, status, model);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (modelAndView != <span class="literal">null</span>) ? modelAndView : <span class="keyword">new</span> <span class="title class_">ModelAndView</span>(<span class="string">&quot;error&quot;</span>, model);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//返回 ResponseEntity，JSON</span></span><br><span class="line"><span class="meta">@RequestMapping</span></span><br><span class="line"><span class="keyword">public</span> ResponseEntity&lt;Map&lt;String, Object&gt;&gt; <span class="title function_">error</span><span class="params">(HttpServletRequest request)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">HttpStatus</span> <span class="variable">status</span> <span class="operator">=</span> getStatus(request);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (status == HttpStatus.NO_CONTENT)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseEntity</span>&lt;&gt;(status);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Map&lt;String, Object&gt; body = getErrorAttributes(request, getErrorAttributeOptions(request, MediaType.ALL));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseEntity</span>&lt;&gt;(body, status);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>错误页面是这么解析到的。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1、解析错误的自定义视图地址</span></span><br><span class="line"><span class="type">ModelAndView</span> <span class="variable">modelAndView</span> <span class="operator">=</span> resolveErrorView(request, response, status, model);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2、如果解析不到错误页面的地址，默认的错误页就是 error</span></span><br><span class="line"><span class="keyword">return</span> (modelAndView != <span class="literal">null</span>) ? modelAndView : <span class="keyword">new</span> <span class="title class_">ModelAndView</span>(<span class="string">&quot;error&quot;</span>, model);</span><br></pre></td></tr></table></figure>
</li>
<li><p>容器中专门有一个错误视图解析器。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@ConditionalOnBean(DispatcherServlet.class)</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(ErrorViewResolver.class)</span></span><br><span class="line">DefaultErrorViewResolver <span class="title function_">conventionErrorViewResolver</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DefaultErrorViewResolver</span>(<span class="built_in">this</span>.applicationContext, <span class="built_in">this</span>.resources);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>SpringBoot 解析自定义错误页的默认规则。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> ModelAndView <span class="title function_">resolveErrorView</span><span class="params">(HttpServletRequest request, HttpStatus status, Map&lt;String, Object&gt; model)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">ModelAndView</span> <span class="variable">modelAndView</span> <span class="operator">=</span> resolve(String.valueOf(status.value()), model);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (modelAndView == <span class="literal">null</span> &amp;&amp; SERIES_VIEWS.containsKey(status.series()))</span><br><span class="line">    &#123;</span><br><span class="line">        modelAndView = resolve(SERIES_VIEWS.get(status.series()), model);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> modelAndView;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> ModelAndView <span class="title function_">resolve</span><span class="params">(String viewName, Map&lt;String, Object&gt; model)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">errorViewName</span> <span class="operator">=</span> <span class="string">&quot;error/&quot;</span> + viewName;</span><br><span class="line">    <span class="type">TemplateAvailabilityProvider</span> <span class="variable">provider</span> <span class="operator">=</span> <span class="built_in">this</span>.templateAvailabilityProviders.getProvider(errorViewName,</span><br><span class="line">        <span class="built_in">this</span>.applicationContext);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (provider != <span class="literal">null</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ModelAndView</span>(errorViewName, model);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> resolveResource(errorViewName, model);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> ModelAndView <span class="title function_">resolveResource</span><span class="params">(String viewName, Map&lt;String, Object&gt; model)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">for</span> (String location : <span class="built_in">this</span>.resources.getStaticLocations())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">Resource</span> <span class="variable">resource</span> <span class="operator">=</span> <span class="built_in">this</span>.applicationContext.getResource(location);</span><br><span class="line">            resource = resource.createRelative(viewName + <span class="string">&quot;.html&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (resource.exists())</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ModelAndView</span>(<span class="keyword">new</span> <span class="title class_">HtmlResourceView</span>(resource), model);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (Exception ex)</span><br><span class="line">        &#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>容器中有一个默认的名为 error 的 view，提供了默认白页功能。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean(name = &quot;error&quot;)</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(name = &quot;error&quot;)</span></span><br><span class="line"><span class="keyword">public</span> View <span class="title function_">defaultErrorView</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.defaultErrorView;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>封装了 JSON 格式的错误信息。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(value = ErrorAttributes.class, search = SearchStrategy.CURRENT)</span></span><br><span class="line"><span class="keyword">public</span> DefaultErrorAttributes <span class="title function_">errorAttributes</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DefaultErrorAttributes</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p>规则：</p>
<p>1、<strong>解析一个错误页</strong>。</p>
<ul>
<li><p>① 如果发生了 500、404、503、403 这些错误。</p>
<ul>
<li><p>(1) 如果有<strong>模板引擎</strong>，默认在 <code>classpath:/templates/error/精确码.html</code>。</p>
</li>
<li><p>(2) 如果没有模板引擎，在静态资源文件夹下找<code>精确码.html</code>。</p>
</li>
</ul>
</li>
<li><p>② 如果匹配不到<code>精确码.html</code> 这些精确的错误页，就去找 <code>5xx.html</code>，<code>4xx.html</code> <strong>模糊匹配</strong>。</p>
<ul>
<li><p>(1) 如果有模板引擎，默认在 <code>classpath:/templates/error/5xx.html</code>。</p>
</li>
<li><p>(2) 如果没有模板引擎，在静态资源文件夹下找 <code>5xx.html</code>。</p>
</li>
</ul>
</li>
</ul>
<p>2、如果模板引擎路径 <code>templates</code> 下有 <code>error.html</code> 页面，就直接渲染。</p>
<h4 id="2-8-2-自定义错误响应"><a href="#2-8-2-自定义错误响应" class="headerlink" title="2.8.2 自定义错误响应"></a>2.8.2 自定义错误响应</h4><h5 id="2-8-2-1-自定义-json-响应"><a href="#2-8-2-1-自定义-json-响应" class="headerlink" title="2.8.2.1 自定义 json 响应"></a>2.8.2.1 自定义 json 响应</h5><blockquote>
<p>使用 @ControllerAdvice + @ExceptionHandler 进行统一异常处理。</p>
</blockquote>
<h5 id="2-8-2-2-自定义页面响应"><a href="#2-8-2-2-自定义页面响应" class="headerlink" title="2.8.2.2 自定义页面响应"></a>2.8.2.2 自定义页面响应</h5><blockquote>
<p>根据 boot 的错误页面规则，自定义页面模板。</p>
</blockquote>
<h4 id="2-8-3-最佳实战"><a href="#2-8-3-最佳实战" class="headerlink" title="2.8.3 最佳实战"></a>2.8.3 最佳实战</h4><ul>
<li><p><strong>前后分离</strong>。</p>
<ul>
<li>后台发生的所有错误，<code>@ControllerAdvice + @ExceptionHandler</code> 进行统一异常处理。</li>
</ul>
</li>
<li><p><strong>服务端页面渲染</strong>。</p>
<ul>
<li><p><code>不可预知的一些，HTTP 码表示的服务器或客户端错误</code>。</p>
<ul>
<li><p>给 <code>classpath:/templates/error/</code> 下面，放常用精确的错误码页面。<code>500.html</code>，<code>404.html</code>。</p>
</li>
<li><p>给 <code>classpath:/templates/error/</code> 下面，放通用模糊匹配的错误码页面。<code>5xx.html</code>，<code>4xx.html</code>。</p>
</li>
</ul>
</li>
<li><p><strong>发生业务错误</strong>。</p>
<ul>
<li><p><strong>核心业务</strong>，每一种错误，都应该代码控制，<strong>跳转到自己定制的错误页</strong>。</p>
</li>
<li><p><strong>通用业务</strong>，<code>classpath:/templates/error.html</code> 页面，<strong>显示错误信息</strong>。</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>在 HTML 页面、JSON 数据中，可用的 Model 数据如下。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://reggie-xiamou.oss-cn-beijing.aliyuncs.com/img/01b942689c7149daafd242ccc2a346ab.png" alt="最佳实战"></p>
<h3 id="2-9-嵌入式容器"><a href="#2-9-嵌入式容器" class="headerlink" title="2.9 嵌入式容器"></a>2.9 嵌入式容器</h3><blockquote>
<p><strong>Servlet 容器</strong>：管理、运行 <strong>Servlet 组件</strong>（Servlet、Filter、Listener）的环境，一般指<strong>服务器</strong>。</p>
</blockquote>
<h4 id="2-9-1-自动配置原理"><a href="#2-9-1-自动配置原理" class="headerlink" title="2.9.1 自动配置原理"></a>2.9.1 自动配置原理</h4><blockquote>
<ul>
<li><p>SpringBoot 默认嵌入 Tomcat 作为 Servlet 容器。</p>
</li>
<li><p><strong>自动配置类</strong>是 <strong>ServletWebServerFactoryAutoConfiguration</strong>，<strong>EmbeddedWebServerFactoryCustomizerAutoConfiguration</strong>。</p>
</li>
<li><p>自动配置类开始分析功能，<strong>xxxAutoConfiguration</strong>。</p>
</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@AutoConfiguration</span></span><br><span class="line"><span class="meta">@AutoConfigureOrder(Ordered.HIGHEST_PRECEDENCE)</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(ServletRequest.class)</span></span><br><span class="line"><span class="meta">@ConditionalOnWebApplication(type = Type.SERVLET)</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(ServerProperties.class)</span></span><br><span class="line"><span class="meta">@Import(&#123;ServletWebServerFactoryAutoConfiguration.BeanPostProcessorsRegistrar.class,</span></span><br><span class="line"><span class="meta">    ServletWebServerFactoryConfiguration.EmbeddedTomcat.class,</span></span><br><span class="line"><span class="meta">    ServletWebServerFactoryConfiguration.EmbeddedJetty.class,</span></span><br><span class="line"><span class="meta">    ServletWebServerFactoryConfiguration.EmbeddedUndertow.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServletWebServerFactoryAutoConfiguration</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>1、<code>ServletWebServerFactoryAutoConfiguration</code> 自动配置了嵌入式容器场景。</p>
<p>2、绑定了 <code>ServerProperties</code> 配置类，所有和服务器有关的配置 <code>server</code>。</p>
<p>3、<code>ServletWebServerFactoryAutoConfiguration</code> 导入了嵌入式的三大服务器 <code>Tomcat</code>、<code>Jetty</code>、<code>Undertow</code>。</p>
<ul>
<li><p>① 导入 <code>Tomcat</code>、<code>Jetty</code>、<code>Undertow</code> 都有条件注解，系统中有这个类才行（也就是导了包）。</p>
</li>
<li><p>② 默认 <code>Tomcat</code> 配置生效。给容器中放 TomcatServletWebServerFactory。</p>
</li>
<li><p>③ 都给容器中 <code>ServletWebServerFactory</code> 放了一个 <strong>Web 服务器工厂</strong>（<strong>造 Web 服务器的</strong>）。</p>
</li>
<li><p>④ <strong>Web 服务器工厂都有一个功能</strong>，<code>getWebServe</code>r 获取 Web 服务器。</p>
</li>
<li><p>⑤ TomcatServletWebServerFactory 创建了 tomcat。</p>
</li>
</ul>
<p>4、ServletWebServerFactory 什么时候会创建 webServer 出来。</p>
<p>5、<code>ServletWebServerApplicationContext</code> ioc 容器，启动的时候会调用创建 Web 服务器。</p>
<p>6、Spring <strong>容器刷新</strong>（<strong>启动</strong>）的时候，会预留一个时机，刷新子容器，<code>onRefresh()</code>。</p>
<p>7、refresh() 容器刷新，十二个步骤的刷新，子容器会调用 <code>onRefresh()</code>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onRefresh</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">super</span>.onRefresh();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span></span><br><span class="line">    &#123;</span><br><span class="line">        createWebServer();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (Throwable ex)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ApplicationContextException</span>(<span class="string">&quot;Unable to start web server&quot;</span>, ex);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Web 场景的 Spring 容器启动，在 onRefresh 的时候，会调用创建 Web 服务器的方法。</p>
<p>Web 服务器的创建是通过 WebServerFactory 搞定的。容器中又会根据导了什么包条件注解，启动相关的 服务器配置，默认 <strong>EmbeddedTomcat</strong> 会给容器中放一个 <strong>TomcatServletWebServerFactory</strong>，导致项目启动，自动创建出 Tomcat。</p>
</blockquote>
<h4 id="2-9-2-自定义"><a href="#2-9-2-自定义" class="headerlink" title="2.9.2 自定义"></a>2.9.2 自定义</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://reggie-xiamou.oss-cn-beijing.aliyuncs.com/img/d0624c15035347bfaab059c412115a01.png" alt="自定义"></p>
<blockquote>
<p>切换服务器。</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 排除 Tomcat 依赖项 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 改为使用 Jetty --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jetty<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="2-9-3-最佳实践"><a href="#2-9-3-最佳实践" class="headerlink" title="2.9.3 最佳实践"></a>2.9.3 最佳实践</h4><p><strong>用法</strong>：</p>
<ul>
<li><p>修改 <code>server</code> 下的相关配置就可以修改<strong>服务器参数</strong>。</p>
</li>
<li><p>通过给容器中放一个 <code>ServletWebServerFactory</code>，来禁用掉 SpringBoot 默认放的服务器工厂，实现自定义嵌入<strong>任意服务器</strong>。</p>
</li>
</ul>
<h3 id="2-10-全面接管-SpringMVC"><a href="#2-10-全面接管-SpringMVC" class="headerlink" title="2.10 全面接管 SpringMVC"></a>2.10 全面接管 SpringMVC</h3><blockquote>
<ul>
<li><p>SpringBoot 默认配置好了 SpringMVC 的所有常用特性。</p>
</li>
<li><p>如果需要全面接管 SpringMVC 的所有配置并<strong>禁用默认配置</strong>，仅需要编写一个 <strong>WebMvcConfigurer</strong> 配置类，并标注 <strong>@EnableWebMvc</strong> 即可。</p>
</li>
<li><p>全手动模式。</p>
<ul>
<li><p><strong>@EnableWebMvc</strong> : 禁用默认配置。</p>
</li>
<li><p><strong>WebMvcConfigurer</strong> 组件：定义 MVC 的底层行为。</p>
</li>
</ul>
</li>
</ul>
</blockquote>
<h4 id="2-10-1-WebMvcAutoConfiguration-到底自动配置了哪些规则"><a href="#2-10-1-WebMvcAutoConfiguration-到底自动配置了哪些规则" class="headerlink" title="2.10.1 WebMvcAutoConfiguration 到底自动配置了哪些规则"></a>2.10.1 WebMvcAutoConfiguration 到底自动配置了哪些规则</h4><blockquote>
<p>SpringMVC 自动配置场景配置了如下所有<strong>默认行为</strong>。</p>
</blockquote>
<p>1、<code>WebMvcAutoConfiguration</code> Web 场景的自动配置类。</p>
<ul>
<li><p>① 支持 RESTful 的 filter：HiddenHttpMethodFilter。</p>
</li>
<li><p>② 支持非 POST 请求，请求体携带数据：FormContentFilter。</p>
</li>
<li><p>③ 导入 <code>EnableWebMvcConfiguration</code>：</p>
<ul>
<li><p>(1) <code>RequestMappingHandlerAdapter</code>。</p>
</li>
<li><p>(2) <code>WelcomePageHandlerMapping</code>：<strong>欢迎页功能</strong>支持（模板引擎目录、静态资源目录放 index.html），项目访问 &#x2F; 就默认展示这个页面。</p>
</li>
<li><p>(3) <code>RequestMappingHandlerMapping</code>：找每个请求由谁处理的映射关系。</p>
</li>
<li><p>(4) <code>ExceptionHandlerExceptionResolver</code>：默认的异常解析器。</p>
</li>
<li><p>(5) <code>LocaleResolver</code>：国际化解析器。</p>
</li>
<li><p>(6) <code>ThemeResolver</code>：主题解析器。</p>
</li>
<li><p>(7) <code>FlashMapManager</code>：临时数据共享。</p>
</li>
<li><p>(8) <code>FormattingConversionService</code>：数据格式化、类型转化。</p>
</li>
<li><p>(9) <code>Validator</code>：数据校验 <code>JSR303</code> 提供的数据校验功能。</p>
</li>
<li><p>(10) <code>WebBindingInitializer</code>：请求参数的封装与绑定。</p>
</li>
<li><p>(11) <code>ContentNegotiationManager</code>：内容协商管理器。</p>
</li>
</ul>
</li>
<li><p>④ <code>WebMvcAutoConfigurationAdapter</code> 配置生效，它是一个 <code>WebMvcConfigurer</code>，定义 mvc 底层组件。</p>
<ul>
<li><p>(1) 定义好 <code>WebMvcConfigurer</code> <strong>底层组件默认功能</strong>，<strong>所有功能详见列表</strong>。</p>
</li>
<li><p>(2) 视图解析器：<code>InternalResourceViewResolver</code>。</p>
</li>
<li><p>(3) 视图解析器：<code>BeanNameViewResolver</code>，<strong>视图名</strong>（<strong>controller 方法的返回值字符串</strong>）就是组件名。</p>
</li>
<li><p>(4) 内容协商解析器：<code>ContentNegotiatingViewResolver</code>。</p>
</li>
<li><p>(5) 请求上下文过滤器：<code>RequestContextFilter</code>，任意位置直接获取当前请求。</p>
</li>
<li><p>(6) 静态资源链规则。</p>
</li>
<li><p>(7) <code>ProblemDetailsExceptionHandler</code>：错误详情。</p>
<ul>
<li>[1] SpringMVC 内部场景异常被它捕获。</li>
</ul>
</li>
</ul>
</li>
<li><p>⑤ 定义了 MVC 默认的底层行为: <code>WebMvcConfigurer</code>。</p>
</li>
</ul>
<h4 id="2-10-2-EnableWebMvc-禁用默认行为"><a href="#2-10-2-EnableWebMvc-禁用默认行为" class="headerlink" title="2.10.2 @EnableWebMvc 禁用默认行为"></a>2.10.2 @EnableWebMvc 禁用默认行为</h4><p>1、<code>@EnableWebMvc</code> 给容器中导入 <code>DelegatingWebMvcConfiguration</code> 组件，<br>是 <code>WebMvcConfigurationSupport</code>。</p>
<p>2、<code>WebMvcAutoConfiguration</code> 有一个核心的条件注解，<code>@ConditionalOnMissingBean(WebMvcConfigurationSupport.class)</code>，容器中没有 <code>WebMvcConfigurationSupport</code>，<code>WebMvcAutoConfiguration</code> 才生效。</p>
<p>3、 @EnableWebMvc 导入 <code>WebMvcConfigurationSupport</code> 导致 <code>WebMvcAutoConfiguration</code> 失效，导致禁用了默认行为。</p>
<blockquote>
<p>@EnableWebMVC 禁用了 Mvc 的自动配置。</p>
<p>WebMvcConfigurer 定义 SpringMVC 底层组件的功能类。</p>
</blockquote>
<h4 id="2-10-3-WebMvcConfigurer-功能"><a href="#2-10-3-WebMvcConfigurer-功能" class="headerlink" title="2.10.3 WebMvcConfigurer 功能"></a>2.10.3 WebMvcConfigurer 功能</h4><blockquote>
<p>定义扩展 SpringMVC 底层功能。</p>
</blockquote>
<table>
<thead>
<tr>
<th>提供方法</th>
<th>核心参数</th>
<th>功能</th>
<th>默认</th>
</tr>
</thead>
<tbody><tr>
<td>addFormatters</td>
<td>FormatterRegistry</td>
<td><strong>格式化器</strong>：支持属性上 <code>@NumberFormat</code> 和<code>@DatetimeFormat</code> 的数据类型转换。</td>
<td>GenericConversionService</td>
</tr>
<tr>
<td>getValidator</td>
<td>无</td>
<td><strong>数据校验</strong>：校验 Controller 上使用 <code>@Valid</code> 标注的参数合法性，需要导入 <code>starter-validator</code>。</td>
<td>无</td>
</tr>
<tr>
<td><code>addInterceptors</code></td>
<td>InterceptorRegistry</td>
<td><strong>拦截器</strong>：拦截收到的所有请求。</td>
<td>无</td>
</tr>
<tr>
<td><code>configureContentNegotiation</code></td>
<td>ContentNegotiationConfigurer</td>
<td><strong>内容协商</strong>：支持多种数据格式返回，需要配合支持这种类型的 <code>HttpMessageConverter</code>。</td>
<td>支持 json。</td>
</tr>
<tr>
<td><code>configureMessageConverters</code></td>
<td><code>List&lt;HttpMessageConverter&lt;?&gt;&gt;</code></td>
<td><strong>消息转换器</strong>：标注 <code>@ResponseBody</code> 的返回值会利用 <code>MessageConverter</code> 直接写出去。</td>
<td>8 个，支持 <code>byte</code>, <code>string</code>, <code>multipart</code>, <code>resource</code>, <code>json</code>。</td>
</tr>
<tr>
<td>addViewControllers</td>
<td>ViewControllerRegistry</td>
<td><strong>视图映射</strong>：直接将请求路径与物理视图映射，用于无 Java 业务逻辑的直接视图页渲染。</td>
<td><code>&lt;mvc:view-controller&gt;</code></td>
</tr>
<tr>
<td>configureViewResolvers</td>
<td>ViewResolverRegistry</td>
<td><strong>视图解析器</strong>：逻辑视图转为物理视图。</td>
<td>iewResolverComposite</td>
</tr>
<tr>
<td>addResourceHandlers</td>
<td>ResourceHandlerRegistry</td>
<td><strong>静态资源处理</strong>：静态资源路径映射、缓存控制。</td>
<td>ResourceHandlerRegistry</td>
</tr>
<tr>
<td>configureDefaultServletHandling</td>
<td>DefaultServletHandlerConfigurer</td>
<td><strong>默认 Servlet</strong>：可以覆盖 Tomcat 的 <code>DefaultServlet</code>，让 <code>DispatcherServlet</code> 拦截 <code>/</code>。</td>
<td>无</td>
</tr>
<tr>
<td>configurePathMatch</td>
<td>PathMatchConfigurer</td>
<td><strong>路径匹配</strong>：自定义 URL 路径匹配，可以自动为所有路径加上指定前缀，比如 <code>/api</code>。</td>
<td>无</td>
</tr>
<tr>
<td><code>configureAsyncSupport</code></td>
<td>AsyncSupportConfigurer</td>
<td><strong>异步支持</strong>：</td>
<td><code>TaskExecutionAutoConfiguration</code></td>
</tr>
<tr>
<td>addCorsMappings</td>
<td>CorsRegistry</td>
<td><strong>跨域</strong>：</td>
<td>无</td>
</tr>
<tr>
<td>addArgumentResolvers</td>
<td><code>List&lt;HandlerMethodArgumentResolver&gt;</code></td>
<td><strong>参数解析器</strong>：</td>
<td>mvc 默认提供。</td>
</tr>
<tr>
<td>addReturnValueHandlers</td>
<td><code>List&lt;HandlerMethodReturnValueHandler&gt;</code></td>
<td>返回值解析器：</td>
<td>mvc 默认提供。</td>
</tr>
<tr>
<td>configureHandlerExceptionResolvers</td>
<td>List<HandlerExceptionResolver></td>
<td><strong>异常处理器</strong>：</td>
<td>默认 3 个，ExceptionHandlerExceptionResolver、ResponseStatusExceptionResolver、DefaultHandlerExceptionResolver。</td>
</tr>
<tr>
<td>getMessageCodesResolver</td>
<td>无</td>
<td><strong>消息码解析器</strong>：国际化使用</td>
<td>无</td>
</tr>
</tbody></table>
<h3 id="2-11-最佳实践"><a href="#2-11-最佳实践" class="headerlink" title="2.11 最佳实践"></a>2.11 最佳实践</h3><blockquote>
<p>SpringBoot 已经默认配置好了 <strong>Web 开发场景</strong>常用功能，直接使用即可。</p>
</blockquote>
<h4 id="2-11-1-三种方式"><a href="#2-11-1-三种方式" class="headerlink" title="2.11.1 三种方式"></a>2.11.1 三种方式</h4><table>
<thead>
<tr>
<th>方式</th>
<th>用法</th>
<th>效果</th>
</tr>
</thead>
<tbody><tr>
<td><strong>全自动</strong></td>
<td>直接编写控制器逻辑。</td>
<td>全部使用<strong>自动配置默认效果</strong>。</td>
</tr>
<tr>
<td><strong>半自动</strong></td>
<td>注解 <code>@Configuration</code> + 配置 <code>WebMvcConfigurer</code> + 配置 <code>WebMvcRegistrations</code>，<strong>不要标注</strong> 注解 <code>@EnableWebMvc</code>。</td>
<td><strong>保留自动配置效果</strong>，<strong>手动设置部分功能</strong>，定义 MVC 底层组件。</td>
</tr>
<tr>
<td><strong>全手动</strong></td>
<td>注解 <code>@Configuration</code> + 配置 <code>WebMvcConfigurer</code>，<strong>标注</strong>注解 <code>@EnableWebMvc</code>。</td>
<td><strong>禁用自动配置效果</strong>，<strong>全手动设置</strong>。</td>
</tr>
</tbody></table>
<p>总结：</p>
<p><strong>给容器中写一个配置类</strong> <code>@Configuration</code> <strong>实现</strong> <code>WebMvcConfigurer</code> <strong>但是不要标注</strong> <code>@EnableWebMvc</code> <strong>注解</strong>，<strong>实现半自动的效果</strong>。</p>
<h4 id="2-11-2-两种模式"><a href="#2-11-2-两种模式" class="headerlink" title="2.11.2 两种模式"></a>2.11.2 两种模式</h4><p>1、<code>前后分离模式</code>：<code>@RestController</code> 响应 JSON 数据。</p>
<p>2、<code>前后不分离模式</code>：<code>@Controller</code> + Thymeleaf 模板引擎。</p>
<h3 id="2-12-Web-新特性"><a href="#2-12-Web-新特性" class="headerlink" title="2.12 Web 新特性"></a>2.12 Web 新特性</h3><h4 id="2-12-1-Problemdetails"><a href="#2-12-1-Problemdetails" class="headerlink" title="2.12.1 Problemdetails"></a>2.12.1 Problemdetails</h4><blockquote>
<p>RFC 7807: <a target="_blank" rel="noopener" href="https://www.rfc-editor.org/rfc/rfc7807">https://www.rfc-editor.org/rfc/rfc7807</a></p>
<p><strong>错误信息</strong>返回新格式。</p>
</blockquote>
<p>原理：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration(proxyBeanMethods = false)</span></span><br><span class="line"><span class="comment">// 配置一个属性 spring.mvc.problemdetails.enabled=true</span></span><br><span class="line"><span class="meta">@ConditionalOnProperty(prefix = &quot;spring.mvc.problemdetails&quot;, name = &quot;enabled&quot;, havingValue = &quot;true&quot;)</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">ProblemDetailsErrorHandlingConfiguration</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean(ResponseEntityExceptionHandler.class)</span></span><br><span class="line">    ProblemDetailsExceptionHandler <span class="title function_">problemDetailsExceptionHandler</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ProblemDetailsExceptionHandler</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>1、<code>ProblemDetailsExceptionHandler</code> 是一个 <code>@ControllerAdvice</code> 集中处理系统异常。</p>
<p>2、处理以下异常。如果系统出现以下异常，会被 SpringBoot 支持以 <code>RFC 7807</code> 规范方式返回错误数据。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ExceptionHandler(&#123;</span></span><br><span class="line"><span class="meta">    // 请求方式不支持</span></span><br><span class="line"><span class="meta">    HttpRequestMethodNotSupportedException.class,</span></span><br><span class="line"><span class="meta">    HttpMediaTypeNotSupportedException.class,</span></span><br><span class="line"><span class="meta">    HttpMediaTypeNotAcceptableException.class,</span></span><br><span class="line"><span class="meta">    MissingPathVariableException.class,</span></span><br><span class="line"><span class="meta">    MissingServletRequestParameterException.class,</span></span><br><span class="line"><span class="meta">    MissingServletRequestPartException.class,</span></span><br><span class="line"><span class="meta">    ServletRequestBindingException.class,</span></span><br><span class="line"><span class="meta">    MethodArgumentNotValidException.class,</span></span><br><span class="line"><span class="meta">    NoHandlerFoundException.class,</span></span><br><span class="line"><span class="meta">    AsyncRequestTimeoutException.class,</span></span><br><span class="line"><span class="meta">    ErrorResponseException.class,</span></span><br><span class="line"><span class="meta">    ConversionNotSupportedException.class,</span></span><br><span class="line"><span class="meta">    TypeMismatchException.class,</span></span><br><span class="line"><span class="meta">    HttpMessageNotReadableException.class,</span></span><br><span class="line"><span class="meta">    HttpMessageNotWritableException.class,</span></span><br><span class="line"><span class="meta">    BindException.class</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br></pre></td></tr></table></figure>

<p>效果：</p>
<p>默认响应错误的 json。状态码 405。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;timestamp&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2023-09-18T11:13:05.515+00:00&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span> <span class="number">405</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;error&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Method Not Allowed&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;trace&quot;</span><span class="punctuation">:</span> <span class="string">&quot;org.springframework.web.HttpRequestMethodNotSupportedException: Request method &#x27;POST&#x27; is not supported\r\n\tat org.springframework.web.servlet.mvc.method.RequestMappingInfoHandlerMapping.handleNoMatch(RequestMappingInfoHandlerMapping.java:265)\r\n\tat org.springframework.web.servlet.handler.AbstractHandlerMethodMapping.lookupHandlerMethod(AbstractHandlerMethodMapping.java:441)\r\n\tat org.springframework.web.servlet.handler.AbstractHandlerMethodMapping.getHandlerInternal(AbstractHandlerMethodMapping.java:382)\r\n\tat org.springframework.web.servlet.mvc.method.RequestMappingInfoHandlerMapping.getHandlerInternal(RequestMappingInfoHandlerMapping.java:126)\r\n\tat org.springframework.web.servlet.mvc.method.RequestMappingInfoHandlerMapping.getHandlerInternal(RequestMappingInfoHandlerMapping.java:68)\r\n\tat org.springframework.web.servlet.handler.AbstractHandlerMapping.getHandler(AbstractHandlerMapping.java:505)\r\n\tat org.springframework.web.servlet.DispatcherServlet.getHandler(DispatcherServlet.java:1275)\r\n\tat org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1057)\r\n\tat org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:974)\r\n\tat org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1011)\r\n\tat org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914)\r\n\tat jakarta.servlet.http.HttpServlet.service(HttpServlet.java:563)\r\n\tat org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)\r\n\tat jakarta.servlet.http.HttpServlet.service(HttpServlet.java:631)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)\r\n\tat org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:53)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)\r\n\tat org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)\r\n\tat org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)\r\n\tat org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)\r\n\tat org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)\r\n\tat org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)\r\n\tat org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)\r\n\tat org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:166)\r\n\tat org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)\r\n\tat org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:493)\r\n\tat org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)\r\n\tat org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)\r\n\tat org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)\r\n\tat org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:341)\r\n\tat org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:390)\r\n\tat org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)\r\n\tat org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:894)\r\n\tat org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1741)\r\n\tat org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)\r\n\tat org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)\r\n\tat org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)\r\n\tat org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)\r\n\tat java.base/java.lang.Thread.run(Thread.java:833)\r\n&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Method &#x27;POST&#x27; is not supported.&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/list&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>开启 ProblemDetails 返回，使用新的 MediaType<br><code>Content-Type: application/problem+json</code> + 额外扩展返回。</p>
<h4 id="2-12-2-函数式-Web"><a href="#2-12-2-函数式-Web" class="headerlink" title="2.12.2 函数式 Web"></a>2.12.2 函数式 Web</h4><blockquote>
<p><strong>SpringMVC 5.2</strong> 以后允许使用<strong>函数式</strong>的方式，<strong>定义 Web 的请求处理流程</strong>。</p>
<p>函数式接口。</p>
<p>Web 请求处理的方式：</p>
<p>1、**@Controller + @RequestMapping<strong>：</strong>耦合式<strong>（</strong>路由、业务**耦合）。</p>
<p>2、<strong>函数式 Web</strong>：分离式（路由、业务分离）。</p>
</blockquote>
<h5 id="2-12-2-1-场景"><a href="#2-12-2-1-场景" class="headerlink" title="2.12.2.1 场景"></a>2.12.2.1 场景</h5><blockquote>
<p>场景：User RESTful - CRUD。</p>
</blockquote>
<ul>
<li><p>GET &#x2F;user&#x2F;1 获取 1 号用户。</p>
</li>
<li><p>GET &#x2F;users 获取所有用户。</p>
</li>
<li><p>POST &#x2F;user <strong>请求体</strong>携带 JSON，新增一个用户。</p>
</li>
<li><p>PUT &#x2F;user&#x2F;1 <strong>请求体</strong>携带 JSON，修改 1 号用户。</p>
</li>
<li><p>DELETE &#x2F;user&#x2F;1 <strong>删除</strong> 1 号用户。</p>
</li>
</ul>
<h5 id="2-12-2-2-核心类"><a href="#2-12-2-2-核心类" class="headerlink" title="2.12.2.2 核心类"></a>2.12.2.2 核心类</h5><ul>
<li><p><strong>RouterFunction</strong></p>
</li>
<li><p><strong>RequestPredicate</strong></p>
</li>
<li><p><strong>ServerRequest</strong></p>
</li>
<li><p><strong>ServerResponse</strong></p>
</li>
</ul>
<h5 id="2-12-2-3-示例"><a href="#2-12-2-3-示例" class="headerlink" title="2.12.2.3 示例"></a>2.12.2.3 示例</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.myxh.springboot.web.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.myxh.springboot.web.biz.UserBizHandler;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.MediaType;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.function.RequestPredicates;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.function.RouterFunction;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.function.RouterFunctions;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.function.ServerResponse;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> MYXH</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2023/9/18</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span></span></span><br><span class="line"><span class="comment"> * 场景：User RESTful - CRUD</span></span><br><span class="line"><span class="comment"> * GET /user/1 获取 1 号用户</span></span><br><span class="line"><span class="comment"> * GET /users 获取所有用户</span></span><br><span class="line"><span class="comment"> * POST /user 请求体携带 JSON，新增一个用户</span></span><br><span class="line"><span class="comment"> * PUT /user/1 请求体携带 JSON，修改 1 号用户</span></span><br><span class="line"><span class="comment"> * DELETE /user/1 删除 1 号用户</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebFunctionConfig</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 函数式 Web</span></span><br><span class="line"><span class="comment">     * 1、给容器中放一个 Bean: 类型是 RouterFunction&lt;ServerResponse&gt;，集中所有路由信息</span></span><br><span class="line"><span class="comment">     * 2、每个业务准备一个自己的 Handler</span></span><br><span class="line"><span class="comment">     * &lt;br&gt;</span></span><br><span class="line"><span class="comment">     * 核心四大对象</span></span><br><span class="line"><span class="comment">     * 1、RouterFunction：定义路由信息，发什么请求，谁来处理</span></span><br><span class="line"><span class="comment">     * 2、RequestPredicate：定义请求，请求谓语，请求方式（GET、POST），请求参数</span></span><br><span class="line"><span class="comment">     * 3、ServerRequest：封装请求完整数据</span></span><br><span class="line"><span class="comment">     * 4、ServerResponse：封装响应完整数据</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userBizHandler 用户业务处理程序（userBizHandler 会被自动注入进来）</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> routerFunction 路由器功能</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RouterFunction&lt;ServerResponse&gt; <span class="title function_">userRouter</span><span class="params">(UserBizHandler userBizHandler)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 开始定义路由信息</span></span><br><span class="line">        RouterFunction&lt;ServerResponse&gt; routerFunction = RouterFunctions.route()</span><br><span class="line">                .GET(<span class="string">&quot;/user/&#123;id&#125;&quot;</span>, RequestPredicates.accept(MediaType.ALL), userBizHandler::getUser)</span><br><span class="line">                .GET(<span class="string">&quot;/users&quot;</span>, userBizHandler::getUsers)</span><br><span class="line">                .POST(<span class="string">&quot;/user&quot;</span>, RequestPredicates.accept(MediaType.APPLICATION_JSON), userBizHandler::saveUser)</span><br><span class="line">                .PUT(<span class="string">&quot;/user&#123;id&#125;&quot;</span>, RequestPredicates.accept(MediaType.APPLICATION_JSON), userBizHandler::updateUser)</span><br><span class="line">                .DELETE(<span class="string">&quot;/user&#123;id&#125;&quot;</span>, userBizHandler::deleteUser)</span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> routerFunction;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.myxh.springboot.web.biz;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.myxh.springboot.web.bean.User;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.function.ServerRequest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.function.ServerResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> MYXH</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2023/9/18</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 专门处理 User 有关的业务</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserBizHandler</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> User user;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询指定 id 的用户</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request 请求</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> response 响应</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception 异常</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> ServerResponse <span class="title function_">getUser</span><span class="params">(ServerRequest request)</span> <span class="keyword">throws</span> Exception</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 业务处理</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">id</span> <span class="operator">=</span> request.pathVariable(<span class="string">&quot;id&quot;</span>);</span><br><span class="line"></span><br><span class="line">        user.setId(<span class="number">1L</span>);</span><br><span class="line">        user.setUserName(<span class="string">&quot;MYXH&quot;</span>);</span><br><span class="line">        user.setPassword(<span class="string">&quot;520.ILY!&quot;</span>);</span><br><span class="line">        user.setAge(<span class="number">21</span>);</span><br><span class="line">        user.setEmail(<span class="string">&quot;1735350920@qq.com&quot;</span>);</span><br><span class="line"></span><br><span class="line">        log.info(<span class="string">&quot;查询 &#123;&#125; 号用户信息成功&quot;</span>, id);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 构造响应</span></span><br><span class="line">        <span class="type">ServerResponse</span> <span class="variable">response</span> <span class="operator">=</span> ServerResponse</span><br><span class="line">                .ok()</span><br><span class="line">                <span class="comment">// 凡是 body 中的对象，就是以前 @ResponseBody 原理，利用 HttpMessageConverter 写出为 json</span></span><br><span class="line">                .body(user);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> response;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取所有用户</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request 请求</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> response 响应</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception 异常</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> ServerResponse <span class="title function_">getUsers</span><span class="params">(ServerRequest request)</span> <span class="keyword">throws</span> Exception</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 业务处理</span></span><br><span class="line">        List&lt;User&gt; userList = Arrays.asList(</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">User</span>(<span class="number">1L</span>, <span class="string">&quot;MYXH&quot;</span>,<span class="string">&quot;520.ILY!&quot;</span>,<span class="number">21</span>,<span class="string">&quot;1735350920@qq.com&quot;</span>,<span class="string">&quot;root&quot;</span>),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">User</span>(<span class="number">2L</span>, <span class="string">&quot;root&quot;</span>,<span class="string">&quot;000000&quot;</span>,<span class="number">21</span>,<span class="string">&quot;root@qq.com&quot;</span>,<span class="string">&quot;root&quot;</span>),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">User</span>(<span class="number">3L</span>, <span class="string">&quot;admin&quot;</span>,<span class="string">&quot;123456&quot;</span>,<span class="number">21</span>,<span class="string">&quot;admin@qq.com&quot;</span>,<span class="string">&quot;admin&quot;</span>),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">User</span>(<span class="number">4L</span>, <span class="string">&quot;test&quot;</span>,<span class="string">&quot;test&quot;</span>,<span class="number">18</span>,<span class="string">&quot;test@qq.com&quot;</span>,<span class="string">&quot;test&quot;</span>),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">User</span>(<span class="number">5L</span>, <span class="string">&quot;张三&quot;</span>,<span class="string">&quot;123456&quot;</span>,<span class="number">18</span>,<span class="string">&quot;&quot;</span>,<span class="string">&quot;user&quot;</span>)</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        log.info(<span class="string">&quot;查询所有用户信息成功&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 构造响应</span></span><br><span class="line">        <span class="type">ServerResponse</span> <span class="variable">response</span> <span class="operator">=</span> ServerResponse</span><br><span class="line">                .ok()</span><br><span class="line">                .body(userList);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> response;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 保存用户</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request 请求</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> response 响应</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception 异常</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> ServerResponse <span class="title function_">saveUser</span><span class="params">(ServerRequest request)</span> <span class="keyword">throws</span> Exception</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 业务处理</span></span><br><span class="line">        <span class="comment">// 提取请求体</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">body</span> <span class="operator">=</span> request.body(User.class);</span><br><span class="line"></span><br><span class="line">        log.info(<span class="string">&quot;保存用户信息成功，用户信息：&#123;&#125;&quot;</span>, body);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 构造响应</span></span><br><span class="line">        <span class="type">ServerResponse</span> <span class="variable">response</span> <span class="operator">=</span> ServerResponse</span><br><span class="line">                .ok()</span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> response;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 更新指定 id 的用户</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request 请求</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> response 响应</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception 异常</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> ServerResponse <span class="title function_">updateUser</span><span class="params">(ServerRequest request)</span> <span class="keyword">throws</span> Exception</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 业务处理</span></span><br><span class="line">        <span class="comment">// 提取请求体</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">body</span> <span class="operator">=</span> request.body(User.class);</span><br><span class="line"></span><br><span class="line">        log.info(<span class="string">&quot;更新用户信息成功，用户信息：&#123;&#125;&quot;</span>, body);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 构造响应</span></span><br><span class="line">        <span class="type">ServerResponse</span> <span class="variable">response</span> <span class="operator">=</span> ServerResponse</span><br><span class="line">                .ok()</span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> response;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除指定 id 的用户</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request 请求</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> response 响应</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception 异常</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> ServerResponse <span class="title function_">deleteUser</span><span class="params">(ServerRequest request)</span> <span class="keyword">throws</span> Exception</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 业务处理</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">id</span> <span class="operator">=</span> request.pathVariable(<span class="string">&quot;id&quot;</span>);</span><br><span class="line"></span><br><span class="line">        log.info(<span class="string">&quot;删除 &#123;&#125; 号用户信息成功&quot;</span>, id);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 构造响应</span></span><br><span class="line">        <span class="type">ServerResponse</span> <span class="variable">response</span> <span class="operator">=</span> ServerResponse</span><br><span class="line">                .ok()</span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> response;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="第-3-章-SpringBoot3-数据访问"><a href="#第-3-章-SpringBoot3-数据访问" class="headerlink" title="第 3 章 SpringBoot3-数据访问"></a>第 3 章 SpringBoot3-数据访问</h2><p><strong>整合 SSM 场景</strong></p>
<blockquote>
<p>SpringBoot 整合 <strong>Spring</strong>、<strong>SpringMVC</strong>、<strong>MyBatis</strong> 进行<strong>数据访问场景</strong>开发。</p>
</blockquote>
<h3 id="3-1-创建-SSM-整合项目"><a href="#3-1-创建-SSM-整合项目" class="headerlink" title="3.1 创建 SSM 整合项目"></a>3.1 创建 SSM 整合项目</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.myxh.springboot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>boot3-05-ssm<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>boot3-05-ssm<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>boot3-05-ssm<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>17<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">excludes</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">exclude</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">exclude</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">excludes</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="3-2-配置数据源"><a href="#3-2-配置数据源" class="headerlink" title="3.2 配置数据源"></a>3.2 配置数据源</h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1、先配置数据源信息</span></span><br><span class="line"><span class="attr">spring.datasource.driver-class-name</span>=<span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="attr">spring.datasource.type</span>=<span class="string">com.zaxxer.hikari.HikariDataSource</span></span><br><span class="line"><span class="attr">spring.datasource.url</span>=<span class="string">jdbc:mysql://localhost:3306/spring_boot</span></span><br><span class="line"><span class="attr">spring.datasource.username</span>=<span class="string">MYXH</span></span><br><span class="line"><span class="attr">spring.datasource.password</span>=<span class="string">520.ILY!</span></span><br></pre></td></tr></table></figure>

<p>安装 Free MyBatis Tool 或 MyBatisX 插件，生成 Mapper 接口的 xml 文件即可。</p>
<h3 id="3-3-配置-MyBatis"><a href="#3-3-配置-MyBatis" class="headerlink" title="3.3 配置 MyBatis"></a>3.3 配置 MyBatis</h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 2、配置整合 MyBatis</span></span><br><span class="line"><span class="attr">mybatis.mapper-locations</span>=<span class="string">classpath:/mapper/*.xml</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 打开驼峰命名规则</span></span><br><span class="line"><span class="attr">mybatis.configuration.map-underscore-to-camel-case</span>=<span class="string">true</span></span><br></pre></td></tr></table></figure>

<h3 id="3-4-CRUD-编写"><a href="#3-4-CRUD-编写" class="headerlink" title="3.4 CRUD 编写"></a>3.4 CRUD 编写</h3><ul>
<li><p>编写 Bean。</p>
</li>
<li><p>编写 Mapper。</p>
</li>
<li><p>使用 <code>Free MyBatis Tool</code> 插件，快速生成 MapperXML。</p>
</li>
<li><p>测试 CRUD。</p>
</li>
</ul>
<h3 id="3-5-自动配置原理"><a href="#3-5-自动配置原理" class="headerlink" title="3.5 自动配置原理"></a>3.5 自动配置原理</h3><p><strong>SSM 整合总结</strong>：</p>
<blockquote>
<p>1、<strong>导入</strong> <strong>mybatis-spring-boot-starter</strong>。</p>
<p>2、配置<strong>数据源</strong>信息。</p>
<p>3、配置 MyBatis 的 <strong>Mapper 接口扫描</strong>与 <strong>xml 映射文件扫描</strong>。</p>
<p>4、编写 Bean，Mapper，生成 xml，编写 SQL 进行 CRUD。<strong>事务等操作依然和 Spring 中用法一样</strong>。</p>
<p>5、效果：</p>
<ul>
<li><p>① 所有 SQL 写在 xml 中。</p>
</li>
<li><p>② 所有 <strong>MyBatis 配置</strong>写在 <strong>application.properties</strong> 下面。</p>
</li>
</ul>
</blockquote>
<ul>
<li><p><code>jdbc 场景的自动配置</code>：</p>
<ul>
<li><p><code>mybatis-spring-boot-starter</code> 导入 <code>spring-boot-starter-jdbc</code>，jdbc 是操作数据库的场景。</p>
</li>
<li><p><code>jdbc</code> 场景的几个自动配置。</p>
<ul>
<li><p>org.springframework.boot.autoconfigure.jdbc.<strong>DataSourceAutoConfiguration</strong></p>
<ul>
<li><p><strong>数据源的自动配置</strong>。</p>
</li>
<li><p>所有和数据源有关的配置都绑定在 <code>DataSourceProperties</code>。</p>
</li>
<li><p>默认使用 <code>HikariDataSource</code>。</p>
</li>
</ul>
</li>
<li><p>org.springframework.boot.autoconfigure.jdbc.<strong>JdbcTemplateAutoConfiguration</strong></p>
<ul>
<li>给容器中放了 <code>JdbcTemplate</code> 操作数据库。</li>
</ul>
</li>
<li><p>org.springframework.boot.autoconfigure.jdbc.<strong>JndiDataSourceAutoConfiguration</strong></p>
</li>
<li><p>org.springframework.boot.autoconfigure.jdbc.<strong>XADataSourceAutoConfiguration</strong></p>
<ul>
<li><strong>基于 XA 二阶提交协议的分布式事务数据源</strong>。</li>
</ul>
</li>
<li><p>org.springframework.boot.autoconfigure.jdbc.<strong>DataSourceTransactionManagerAutoConfiguration</strong></p>
<ul>
<li><strong>支持事务</strong>。</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>具有的底层能力</strong>：<strong>数据源</strong>、<code>JdbcTemplate</code>、<strong>事务</strong>。</p>
</li>
</ul>
</li>
<li><p><code>MyBatisAutoConfiguration</code>：配置了 MyBatis 的整合流程。</p>
<ul>
<li><p><code>mybatis-spring-boot-starter</code> 导入 <code>mybatis-spring-boot-autoconfigure（mybatis 的自动配置包）</code>。</p>
</li>
<li><p>默认加载两个自动配置类：</p>
<ul>
<li><p>org.mybatis.spring.boot.autoconfigure.MybatisLanguageDriverAutoConfiguration</p>
</li>
<li><p>org.mybatis.spring.boot.autoconfigure.<strong>MybatisAutoConfiguration</strong></p>
<ul>
<li><p><strong>必须在数据源配置好之后才配置</strong>。</p>
</li>
<li><p>给容器中 <code>SqlSessionFactory</code> 组件，创建和数据库的一次会话。</p>
</li>
<li><p>给容器中 <code>SqlSessionTemplate</code> 组件，操作数据库。</p>
</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>MyBatis 的所有配置绑定在</strong> <code>MybatisProperties</code>。</p>
</li>
<li><p>每个 <strong>Mapper 接口</strong>的<strong>代理对象</strong>是怎么创建放到容器中，详见 <strong>@MapperScan</strong> 原理：</p>
<ul>
<li>利用 <code>@Import(MapperScannerRegistrar.class)</code> 批量给容器中注册组件，解析指定的包路径里面的每一个类，为每一个 Mapper 接口类，创建 Bean 定义信息，注册到容器中。</li>
</ul>
</li>
</ul>
</li>
</ul>
<blockquote>
<p>如何分析哪个场景导入以后，开启了哪些自动配置类。</p>
<p>寻找：<strong>classpath:&#x2F;META-INF&#x2F;spring&#x2F;org.springframework.boot.autoconfigure.AutoConfiguration.imports</strong> 文件中配置的所有值，就是要开启的自动配置类，但是每个类可能有条件注解，基于条件注解判断哪个自动配置类生效了。</p>
</blockquote>
<h3 id="3-6-快速定位生效的配置"><a href="#3-6-快速定位生效的配置" class="headerlink" title="3.6 快速定位生效的配置"></a>3.6 快速定位生效的配置</h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 开启调试模式，详细打印开启了哪些自动配置</span></span><br><span class="line"><span class="comment"># Positive（生效的自动配置），Negative（不生效的自动配置）</span></span><br><span class="line"><span class="attr">debug</span>=<span class="string">true</span></span><br></pre></td></tr></table></figure>

<h3 id="3-7-扩展：整合其他数据源"><a href="#3-7-扩展：整合其他数据源" class="headerlink" title="3.7 扩展：整合其他数据源"></a>3.7 扩展：整合其他数据源</h3><h4 id="3-7-1-Druid-数据源"><a href="#3-7-1-Druid-数据源" class="headerlink" title="3.7.1 Druid 数据源"></a>3.7.1 Druid 数据源</h4><blockquote>
<p>暂不支持 <strong>SpringBoot3</strong></p>
<ul>
<li><p>导入 <strong>druid-starter</strong>。</p>
</li>
<li><p>写配置。</p>
</li>
<li><p>分析自动配置了哪些东西，怎么用。</p>
</li>
</ul>
</blockquote>
<p>Druid 官网：<a target="_blank" rel="noopener" href="https://github.com/alibaba/druid">https://github.com/alibaba/druid</a></p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 数据源基本配置</span></span><br><span class="line"><span class="attr">spring.datasource.driver-class-name</span>=<span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="attr">spring.datasource.type</span>=<span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line"><span class="attr">spring.datasource.url</span>=<span class="string">jdbc:mysql://localhost:3306/spring_boot</span></span><br><span class="line"><span class="attr">spring.datasource.username</span>=<span class="string">MYXH</span></span><br><span class="line"><span class="attr">spring.datasource.password</span>=<span class="string">520.ILY!</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 配置 StatFilter 监控</span></span><br><span class="line"><span class="attr">spring.datasource.druid.filter.stat.enabled</span>=<span class="string">true</span></span><br><span class="line"><span class="attr">spring.datasource.druid.filter.stat.db-type</span>=<span class="string">mysql</span></span><br><span class="line"><span class="attr">spring.datasource.druid.filter.stat.log-slow-sql</span>=<span class="string">true</span></span><br><span class="line"><span class="attr">spring.datasource.druid.filter.stat.slow-sql-millis</span>=<span class="string">2000</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 配置 WallFilter 防火墙</span></span><br><span class="line"><span class="attr">spring.datasource.druid.filter.wall.enabled</span>=<span class="string">true</span></span><br><span class="line"><span class="attr">spring.datasource.druid.filter.wall.db-type</span>=<span class="string">mysql</span></span><br><span class="line"><span class="attr">spring.datasource.druid.filter.wall.config.delete-allow</span>=<span class="string">false</span></span><br><span class="line"><span class="attr">spring.datasource.druid.filter.wall.config.drop-table-allow</span>=<span class="string">false</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 配置监控页，内置监控页面的首页是 /druid/index.html</span></span><br><span class="line"><span class="attr">spring.datasource.druid.stat-view-servlet.enabled</span>=<span class="string">true</span></span><br><span class="line"><span class="attr">spring.datasource.druid.stat-view-servlet.login-username</span>=<span class="string">admin</span></span><br><span class="line"><span class="attr">spring.datasource.druid.stat-view-servlet.login-password</span>=<span class="string">admin</span></span><br><span class="line"><span class="attr">spring.datasource.druid.stat-view-servlet.allow</span>=<span class="string">\*</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 其他 Filter 配置不再演示</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 目前为以下 Filter 提供了配置支持，请参考文档或者根据 IDE 提示（spring.datasource.druid.filter.\*）进行配置。</span></span><br><span class="line"><span class="comment"># StatFilter</span></span><br><span class="line"><span class="comment"># WallFilter</span></span><br><span class="line"><span class="comment"># ConfigFilter</span></span><br><span class="line"><span class="comment"># EncodingConvertFilter</span></span><br><span class="line"><span class="comment"># Slf4jLogFilter</span></span><br><span class="line"><span class="comment"># Log4jFilter</span></span><br><span class="line"><span class="comment"># Log4j2Filter</span></span><br><span class="line"><span class="comment"># CommonsLogFilter</span></span><br></pre></td></tr></table></figure>

<h3 id="3-8-附录：示例数据库"><a href="#3-8-附录：示例数据库" class="headerlink" title="3.8 附录：示例数据库"></a>3.8 附录：示例数据库</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"># 创建数据库 spring_boot</span><br><span class="line"><span class="keyword">CREATE</span> DATABASE IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> spring_boot;</span><br><span class="line"></span><br><span class="line"># 选择数据库 spring_boot</span><br><span class="line">USE spring_boot;</span><br><span class="line"></span><br><span class="line"># 创建用户表 t_user</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `t_user`</span><br><span class="line">(</span><br><span class="line">    `id`         <span class="type">BIGINT</span>(<span class="number">20</span>)   <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;编号&#x27;</span>,</span><br><span class="line">    `login_name` <span class="type">VARCHAR</span>(<span class="number">200</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;用户名称&#x27;</span> <span class="keyword">COLLATE</span> <span class="string">&#x27;utf8_general_ci&#x27;</span>,</span><br><span class="line">    `nick_name`  <span class="type">VARCHAR</span>(<span class="number">200</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;用户昵称&#x27;</span> <span class="keyword">COLLATE</span> <span class="string">&#x27;utf8_general_ci&#x27;</span>,</span><br><span class="line">    `password`   <span class="type">VARCHAR</span>(<span class="number">200</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;用户密码&#x27;</span> <span class="keyword">COLLATE</span> <span class="string">&#x27;utf8_general_ci&#x27;</span>,</span><br><span class="line">    <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"># 添加用户表 t_user 的数据</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `t_user`(`id`, `login_name`, `nick_name`, `password`)</span><br><span class="line"><span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="string">&#x27;MYXH&#x27;</span>, <span class="string">&#x27;末影小黑xh&#x27;</span>, <span class="string">&#x27;520.ILY!&#x27;</span>),</span><br><span class="line">       (<span class="number">2</span>, <span class="string">&#x27;root&#x27;</span>, <span class="string">&#x27;root 用户&#x27;</span>, <span class="string">&#x27;000000&#x27;</span>),</span><br><span class="line">       (<span class="number">3</span>, <span class="string">&#x27;admin&#x27;</span>, <span class="string">&#x27;管理员&#x27;</span>, <span class="string">&#x27;123456&#x27;</span>),</span><br><span class="line">       (<span class="number">4</span>, <span class="string">&#x27;test&#x27;</span>, <span class="string">&#x27;测试员&#x27;</span>, <span class="string">&#x27;test&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="第-4-章-SpringBoot3-基础特性"><a href="#第-4-章-SpringBoot3-基础特性" class="headerlink" title="第 4 章 SpringBoot3-基础特性"></a>第 4 章 SpringBoot3-基础特性</h2><h3 id="4-1-SpringApplication"><a href="#4-1-SpringApplication" class="headerlink" title="4.1 SpringApplication"></a>4.1 SpringApplication</h3><h4 id="4-1-1-自定义-banner"><a href="#4-1-1-自定义-banner" class="headerlink" title="4.1.1 自定义 banner"></a>4.1.1 自定义 banner</h4><p>1、类路径添加 <code>banner.txt</code> 或设置 <code>spring.banner.location</code> 就可以定制 banner。</p>
<p>2、推荐网站：链接: <a target="_blank" rel="noopener" href="https://www.bootschool.net/ascii">Spring Boot banner 在线生成工具</a>，制作下载英文 banner.txt，修改替换 banner.txt 文字实现自定义，个性化启动。</p>
<h4 id="4-1-2-自定义-SpringApplication"><a href="#4-1-2-自定义-SpringApplication" class="headerlink" title="4.1.2 自定义 SpringApplication"></a>4.1.2 自定义 SpringApplication</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.myxh.springboot.features;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.Banner;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 主程序类</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Boot306FeaturesApplication</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 1、SpringApplication：Boot 应用的核心 API 入口</span></span><br><span class="line">        <span class="comment">// SpringApplication.run(Boot306FeaturesApplication.class, args);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1.1 自定义 SpringApplication 的底层设置</span></span><br><span class="line">        <span class="type">SpringApplication</span> <span class="variable">springApplication</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SpringApplication</span>(Boot306FeaturesApplication.class);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1.2 程序化调整 SpringApplication 的参数，配置文件优先级高于程序化调整的优先级</span></span><br><span class="line">        springApplication.setBannerMode(Banner.Mode.OFF);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1.3 SpringApplication 运行起来</span></span><br><span class="line">        springApplication.run(args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-1-3-FluentBuilder-API"><a href="#4-1-3-FluentBuilder-API" class="headerlink" title="4.1.3 FluentBuilder API"></a>4.1.3 FluentBuilder API</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.myxh.springboot.features;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.Banner;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.builder.SpringApplicationBuilder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ConfigurableApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 主程序类</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Boot306FeaturesApplication</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 1、SpringApplication：Boot 应用的核心 API 入口</span></span><br><span class="line">        <span class="comment">// SpringApplication.run(Boot306FeaturesApplication.class, args);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1.1 自定义 SpringApplication 的底层设置</span></span><br><span class="line">        <span class="comment">// SpringApplication springApplication = new SpringApplication(Boot306FeaturesApplication.class);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1.2 程序化调整 SpringApplication 的参数，配置文件优先级高于程序化调整的优先级</span></span><br><span class="line">        <span class="comment">// springApplication.setBannerMode(Banner.Mode.OFF);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1.3 SpringApplication 运行起来</span></span><br><span class="line">        <span class="comment">// springApplication.run(args);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2、Builder 方式构建 SpringApplication：通过 FluentAPI 进行设置</span></span><br><span class="line">        <span class="type">ConfigurableApplicationContext</span> <span class="variable">applicationContext</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SpringApplicationBuilder</span>()</span><br><span class="line">                .main(Boot306FeaturesApplication.class)</span><br><span class="line">                .sources(Boot306FeaturesApplication.class)</span><br><span class="line">                .bannerMode(Banner.Mode.OFF)</span><br><span class="line">                .run(args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-2-Profiles"><a href="#4-2-Profiles" class="headerlink" title="4.2 Profiles"></a>4.2 Profiles</h3><blockquote>
<p>环境隔离能力，快速切换开发、测试、生产环境。</p>
<p>步骤：</p>
<p>1、<strong>标识环境</strong>：指定哪些组件、配置在哪个环境生效。</p>
<p>2、<strong>切换环境</strong>：这个环境对应的所有组件和配置就应该生效。</p>
</blockquote>
<h4 id="4-2-1-使用"><a href="#4-2-1-使用" class="headerlink" title="4.2.1 使用"></a>4.2.1 使用</h4><h5 id="4-2-1-1-指定环境"><a href="#4-2-1-1-指定环境" class="headerlink" title="4.2.1.1 指定环境"></a>4.2.1.1 指定环境</h5><ul>
<li><p>Spring Profiles 提供一种<strong>隔离配置</strong>的方式，使其仅在<strong>特定环境</strong>生效。</p>
</li>
<li><p>任何 <code>@Component</code>，<code>@Configuration</code> 或 <code>@ConfigurationProperties</code> 可以使用 <code>@Profile</code> 标记，来指定何时被加载。（<strong>容器中的组件</strong>都可以被 <code>@Profile</code> 标记）</p>
</li>
</ul>
<h5 id="4-2-1-2-环境激活"><a href="#4-2-1-2-环境激活" class="headerlink" title="4.2.1.2 环境激活"></a>4.2.1.2 环境激活</h5><p>1、配置激活指定环境，配置文件。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 激活指定的一个或多个环境</span></span><br><span class="line"><span class="attr">spring.profiles.active</span>=<span class="string">dev, test</span></span><br></pre></td></tr></table></figure>

<p>2、也可以使用命令行激活。<code>--spring.profiles.active=dev, test</code>。</p>
<p>3、还可以配置<strong>默认环境</strong>，不标注 @Profile 的组件永远都存在。</p>
<ul>
<li><p>① 以前默认环境叫 default。</p>
</li>
<li><p>② <code>spring.profiles.default=dev</code>。</p>
</li>
</ul>
<p>4、推荐使用激活方式激活指定环境。</p>
<h5 id="4-2-1-3-环境包含"><a href="#4-2-1-3-环境包含" class="headerlink" title="4.2.1.3 环境包含"></a>4.2.1.3 环境包含</h5><p>注意：</p>
<p>1、<code>spring.profiles.active</code> 和 <code>spring.profiles.default</code> 只能用到<strong>无 profile 的文件</strong>中，如果在 <code>application-dev.properties/yaml</code> 中编写就是无效的。</p>
<p>2、也可以额外添加生效文件，而不是激活替换。比如：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 包含指定环境，不管激活哪个环境，这个环境都有，总是要生效的环境</span></span><br><span class="line"><span class="attr">spring.profiles.include</span>=<span class="string">dev, test</span></span><br></pre></td></tr></table></figure>

<p>最佳实战：</p>
<ul>
<li><p><strong>生效的环境 &#x3D; 激活的环境&#x2F;默认环境 + 包含的环境</strong>。</p>
</li>
<li><p>项目里面这么用。</p>
<ul>
<li><p>基础的配置 <code>mybatis</code>、<code>log</code>：写到<strong>包含环境中</strong>。</p>
</li>
<li><p>需要动态切换变化的 <code>db</code>、<code>redis</code>：写到<strong>激活的环境中</strong>。</p>
</li>
</ul>
</li>
</ul>
<h4 id="4-2-2-Profile-分组"><a href="#4-2-2-Profile-分组" class="headerlink" title="4.2.2 Profile 分组"></a>4.2.2 Profile 分组</h4><p>创建 <code>prod</code> 组，指定包含 <code>db</code> 和 <code>mq</code> 配置。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Profile 分组</span></span><br><span class="line"><span class="attr">spring.profiles.group.prod[0]</span>=<span class="string">db</span></span><br><span class="line"><span class="attr">spring.profiles.group.prod[1]</span>=<span class="string">mq</span></span><br></pre></td></tr></table></figure>

<p>使用 <code>--spring.profiles.active=prod</code>，就会激活 <code>prod</code>，<code>db</code>，<code>mq</code> 配置文件。</p>
<h4 id="4-2-3-Profile-配置文件"><a href="#4-2-3-Profile-配置文件" class="headerlink" title="4.2.3 Profile 配置文件"></a>4.2.3 Profile 配置文件</h4><ul>
<li><p><code>application-&#123;profile&#125;.properties</code> 可以作为<strong>指定环境的配置文件</strong>。</p>
</li>
<li><p>激活这个环境，<strong>配置</strong>就会生效。最终生效的所有<strong>配置</strong>是。</p>
<ul>
<li><p><code>application.properties</code>：主配置文件，任意时候都生效。</p>
</li>
<li><p><code>application-&#123;profile&#125;.properties</code>：指定环境配置文件，激活指定环境生效。</p>
</li>
</ul>
</li>
</ul>
<p>profile 优先级 &gt; application 优先级。</p>
<h3 id="4-3-外部化配置"><a href="#4-3-外部化配置" class="headerlink" title="4.3 外部化配置"></a>4.3 外部化配置</h3><blockquote>
<p><strong>场景</strong>：线上应用如何<strong>快速修改配置</strong>，并<strong>应用最新配置</strong>？</p>
<p>SpringBoot 使用<strong>配置优先级 + 外部配置</strong>简化配置更新、简化运维。</p>
<p>只需要给 <strong>jar</strong> 应用所在的文件夹放一个 <strong>application.properties</strong> 最新配置文件，重启项目就能自动应用最新配置。</p>
</blockquote>
<h4 id="4-3-1-配置优先级"><a href="#4-3-1-配置优先级" class="headerlink" title="4.3.1 配置优先级"></a>4.3.1 配置优先级</h4><p>Spring Boot 允许将<strong>配置外部化</strong>，以便可以在不同的环境中使用相同的应用程序代码。</p>
<p>可以使用各种<strong>外部配置源</strong>，包括 <code>Java Properties 文件</code>、<code>YAML 文件</code>、<code>环境变量</code>和<code>命令行参数</code>。</p>
<p><code>@Value</code> 可以获取值，也可以用 <code>@ConfigurationProperties</code> 将所有属性绑定到 <code>Java Object</code> 中。</p>
<p><strong>以下是 SpringBoot 属性源加载顺序</strong>，<strong>后面的会覆盖前面的值</strong>，<strong>由低到高，高优先级配置覆盖低优先级</strong>。</p>
<p>1、<strong>默认属性</strong>（通过 <code>SpringApplication.setDefaultProperties</code> 指定的）。</p>
<p>2、<code>@PropertySource</code> 指定加载的配置（需要写在<code>@Configuration</code> 类上才可生效）。</p>
<p>3、<strong>配置文件</strong>（<strong>application.properties&#x2F;yml 等</strong>）。</p>
<p>4、<code>RandomValuePropertySource</code> 支持的 <code>random.*</code> 配置（如：@Value(“${random.int}”)）。</p>
<p>5、OS 环境变量。</p>
<p>6、Java 系统属性（<code>System.getProperties()</code>）。</p>
<p>7、JNDI 属性（来自 <code>java:comp/env</code>）。</p>
<p><code>8、ServletContext</code> 初始化参数。</p>
<p><code>9、ServletConfig</code> 初始化参数。</p>
<p>10、<code>SPRING_APPLICATION_JSON</code> 属性（内置在环境变量或系统属性中的 JSON）。</p>
<p>11、<strong>命令行参数</strong>。</p>
<p>12、测试属性。（<code>@SpringBootTest</code> 进行测试时指定的属性）。</p>
<p>13、测试类 <code>@TestPropertySource</code> 注解。</p>
<p>14、Devtools 设置的全局属性。（<code>$HOME/.config/spring-boot</code>）。</p>
<blockquote>
<p>结论：配置可以写到很多位置，常见的优先级顺序：</p>
<ul>
<li><strong>命令行</strong> &gt; <strong>配置文件</strong> &gt; <strong>springapplication 配置</strong></li>
</ul>
</blockquote>
<p><strong>配置文件优先级</strong>如下：（<strong>后面覆盖前面</strong>）</p>
<p>1、<strong>jar 包内</strong>的 <code>application.properties/yml</code>。</p>
<p>2、<strong>jar 包内</strong>的 <code>application-&#123;profile&#125;.properties/yml</code>。</p>
<p>3、<strong>jar 包外</strong>的 <code>application.properties/yml</code>。</p>
<p>4、<strong>jar 包外</strong>的 <code>application-&#123;profile&#125;.properties/yml</code>。</p>
<p><strong>建议</strong>：<strong>用一种格式的配置文件</strong>。<strong>如果</strong> <code>.properties</code> <strong>和</strong> <code>.yml</code> <strong>同时存在，则</strong> <code>.properties</code> <strong>优先</strong>。</p>
<blockquote>
<p>结论：<strong>包外 &gt; 包内</strong>，同级情况：<strong>profile 配置 &gt; application 配置</strong>。</p>
</blockquote>
<p><strong>所有参数均可由命令行传入</strong>，<strong>使用</strong> <code>--参数项=参数值</code>，<strong>将会被添加到环境变量中</strong>，<strong>并优先于</strong><code>配置文件</code>。</p>
<p><strong>比如</strong> <code>java -jar app.jar --name=&quot;Spring&quot;</code>，<strong>可以使用</strong> <code>@Value(&quot;$&#123;name&#125;&quot;)</code> <strong>获取</strong>。</p>
<p>演示场景：</p>
<ul>
<li><p>包内：application.properties <code>server.port=8080</code>。</p>
</li>
<li><p>包内：application-dev.properties <code>server.port=8081</code></p>
</li>
<li><p>包外：application.properties <code>server.port=8180</code></p>
</li>
<li><p>包外：application-dev.properties <code>server.port=8181</code></p>
</li>
</ul>
<p>启动端口？：<code>命令行</code> &gt; <code>8181</code> &gt; <code>8180</code> &gt; <code>8081</code> &gt; <code>8080</code>。</p>
<h4 id="4-3-2-外部配置"><a href="#4-3-2-外部配置" class="headerlink" title="4.3.2 外部配置"></a>4.3.2 外部配置</h4><p>SpringBoot 应用启动时会自动寻找 <code>application.properties</code> 和 <code>application.yaml</code> 位置，进行加载。顺序如下：（<strong>后面覆盖前面</strong>）</p>
<p>1、类路径：内部。</p>
<ul>
<li><p>① 类根路径.</p>
</li>
<li><p>② 类下 <code>/config</code> 包。</p>
</li>
</ul>
<p>2、当前路径：项目所在的位置。</p>
<ul>
<li><p>① 当前路径。</p>
</li>
<li><p>② 当前下 <code>/config</code> 子目录。</p>
</li>
<li><p>③ <code>/config</code> 目录的直接子目录。</p>
</li>
</ul>
<p>最终效果：优先级由高到低，前面覆盖后面。</p>
<ul>
<li><p>命令行 &gt; 包外 config 直接子目录 &gt; 包外 config 目录 &gt; 包外根目录 &gt; 包内目录。</p>
</li>
<li><p>同级比较：</p>
<ul>
<li><p>profile 配置 &gt; 默认配置。</p>
</li>
<li><p>properties 配置 &gt; yaml 配置。</p>
</li>
</ul>
</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://reggie-xiamou.oss-cn-beijing.aliyuncs.com/img/958e78de934440a6a2092e02e91f8498.png" alt="外部配置"></p>
<p>规律：最外层的最优先。</p>
<ul>
<li><p>命令行 &gt; 所有。</p>
</li>
<li><p>包外 &gt; 包内。</p>
</li>
<li><p>config 目录 &gt; 根目录。</p>
</li>
<li><p>profile &gt; application。</p>
</li>
</ul>
<p>配置不同就都生效（互补），配置相同高优先级覆盖低优先级。</p>
<h4 id="4-3-3-导入配置"><a href="#4-3-3-导入配置" class="headerlink" title="4.3.3 导入配置"></a>4.3.3 导入配置</h4><p>使用 <code>spring.config.import</code> 可以导入额外配置。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 导入指定的配置</span></span><br><span class="line"><span class="attr">spring.config.import</span>=<span class="string">classpath:/a.properties</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 导入配置优先级低于配置文件的优先级</span></span><br><span class="line"><span class="attr">a</span>=<span class="string">c</span></span><br></pre></td></tr></table></figure>

<p>无论以上写法的先后顺序，<code>a.properties</code> 的值总是优先于直接在文件中编写的 a。</p>
<h4 id="4-3-4-属性占位符"><a href="#4-3-4-属性占位符" class="headerlink" title="4.3.4 属性占位符"></a>4.3.4 属性占位符</h4><p>配置文件中可以使用 <code>$&#123;name:default&#125;</code> 形式取出之前配置过的值。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server.port</span>=<span class="string">8080</span></span><br><span class="line"></span><br><span class="line"><span class="attr">my.server.port</span>=<span class="string">我的服务端口是：$&#123;server.port&#125;，我的用户名是：$&#123;my.username:末影小黑xh&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="4-4-单元测试-JUnit5"><a href="#4-4-单元测试-JUnit5" class="headerlink" title="4.4 单元测试 JUnit5"></a>4.4 单元测试 JUnit5</h3><h4 id="4-4-1-整合"><a href="#4-4-1-整合" class="headerlink" title="4.4.1 整合"></a>4.4.1 整合</h4><p>SpringBoot 提供一系列测试工具集及注解方便进行测试。</p>
<p><code>spring-boot-test</code> 提供核心测试能力，<code>spring-boot-test-autoconfigure</code> 提供测试的一些自动配置。</p>
<p>只需要导入 <code>spring-boot-starter-test</code> 即可整合测试。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>spring-boot-starter-test</code> 默认提供了以下库供测试使用。</p>
<ul>
<li><p><a target="_blank" rel="noopener" href="https://junit.org/junit5/">JUnit 5</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/6.0.4/reference/html/testing.html#integration-testing">Spring Test</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://assertj.github.io/doc/">AssertJ</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/hamcrest/JavaHamcrest">Hamcrest</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://site.mockito.org/">Mockito</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/skyscreamer/JSONassert">JSONassert</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/json-path/JsonPath">JsonPath</a></p>
</li>
</ul>
<h4 id="4-4-2-测试"><a href="#4-4-2-测试" class="headerlink" title="4.4.2 测试"></a>4.4.2 测试</h4><h5 id="4-4-2-1-组件测试"><a href="#4-4-2-1-组件测试" class="headerlink" title="4.4.2.1 组件测试"></a>4.4.2.1 组件测试</h5><p>直接 <code>@Autowired</code> 容器中的组件进行测试。</p>
<h5 id="4-4-2-2-注解"><a href="#4-4-2-2-注解" class="headerlink" title="4.4.2.2 注解"></a>4.4.2.2 注解</h5><p>JUnit5 的注解与 JUnit4 的注解有所变化。</p>
<p><a target="_blank" rel="noopener" href="https://junit.org/junit5/docs/current/user-guide/#writing-tests-annotations">https://junit.org/junit5/docs/current/user-guide/#writing-tests-annotations</a></p>
<ul>
<li><p><strong>@Test</strong>：表示方法是测试方法，但是与 JUnit4 的 @Test 不同，他的职责非常单一不能声明任何属性，拓展的测试将会由 Jupiter 提供额外测试。</p>
</li>
<li><p><strong>@ParameterizedTest</strong>：表示方法是参数化测试，下方会有详细介绍。</p>
</li>
<li><p><strong>@RepeatedTest</strong>：表示方法可重复执行，下方会有详细介绍。</p>
</li>
<li><p><strong>@DisplayName</strong>：为测试类或者测试方法设置展示名称。</p>
</li>
<li><p><strong>@BeforeEach</strong>：表示在每个单元测试之前执行。</p>
</li>
<li><p><strong>@AfterEach</strong>：表示在每个单元测试之后执行。</p>
</li>
<li><p><strong>@BeforeAll</strong>：表示在所有单元测试之前执行。</p>
</li>
<li><p><strong>@AfterAll</strong>：表示在所有单元测试之后执行。</p>
</li>
<li><p><strong>@Tag</strong>：表示单元测试类别，类似于 JUnit4 中的 @Categories。</p>
</li>
<li><p><strong>@Disabled</strong>：表示测试类或测试方法不执行，类似于 JUnit4 中的 @Ignore。</p>
</li>
<li><p><strong>@Timeout</strong>：表示测试方法运行如果超过了指定时间将会返回错误。</p>
</li>
<li><p><strong>@ExtendWith</strong>：为测试类或测试方法提供扩展类引用。</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.myxh.springboot.features;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.myxh.springboot.features.service.HelloService;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具备测试 SpringBoot 应用容器中所有组件的功能，测试类必须在主程序所在的包及其子包</span></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Boot306FeaturesApplicationTests</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 自动注入任意组件即可测试</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    HelloService helloService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@DisplayName(&quot;测试 sum() 方法 &quot;)</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">contextLoads</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">sum</span> <span class="operator">=</span> helloService.sum(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">        Assertions.assertEquals(<span class="number">3</span>, sum);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@DisplayName(&quot;测试1&quot;)</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;test1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 所有测试方法运行之前先运行这个，只打印一次</span></span><br><span class="line">    <span class="meta">@BeforeAll</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">initAll</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 每个测试方法运行之前先运行这个，每个方法运行打印一次</span></span><br><span class="line">    <span class="meta">@BeforeEach</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;world&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="4-4-2-3-断言"><a href="#4-4-2-3-断言" class="headerlink" title="4.4.2.3 断言"></a>4.4.2.3 断言</h5><table>
<thead>
<tr>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>assertEquals</td>
<td>判断两个对象或两个原始类型是否相等。</td>
</tr>
<tr>
<td>assertNotEquals</td>
<td>判断两个对象或两个原始类型是否不相等。</td>
</tr>
<tr>
<td>assertSame</td>
<td>判断两个对象引用是否指向同一个对象。</td>
</tr>
<tr>
<td>assertNotSame</td>
<td>判断两个对象引用是否指向不同的对象。</td>
</tr>
<tr>
<td>assertTrue</td>
<td>判断给定的布尔值是否为 true。</td>
</tr>
<tr>
<td>assertFalse</td>
<td>判断给定的布尔值是否为 false。</td>
</tr>
<tr>
<td>assertNull</td>
<td>判断给定的对象引用是否为 null。</td>
</tr>
<tr>
<td>assertNotNull</td>
<td>判断给定的对象引用是否不为 null。</td>
</tr>
<tr>
<td><strong>assertArrayEquals</strong></td>
<td><strong>数组断言</strong>。</td>
</tr>
<tr>
<td><strong>assertAll</strong></td>
<td><strong>组合断言</strong>。</td>
</tr>
<tr>
<td><strong>assertThrows</strong></td>
<td><strong>异常断言</strong>。</td>
</tr>
<tr>
<td><strong>assertTimeout</strong></td>
<td><strong>超时断言</strong>。</td>
</tr>
<tr>
<td><strong>fail</strong></td>
<td><strong>快速失败</strong>。</td>
</tr>
</tbody></table>
<h5 id="4-4-2-4-嵌套测试"><a href="#4-4-2-4-嵌套测试" class="headerlink" title="4.4.2.4 嵌套测试"></a>4.4.2.4 嵌套测试</h5><blockquote>
<p>JUnit 5 可以通过 Java 中的内部类和 @Nested 注解实现嵌套测试，从而可以更好的把相关的测试方法组织在一起。在内部类中可以使用 @BeforeEach 和 @AfterEach 注解，而且嵌套的层次没有限制。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.myxh.springboot.features;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.BeforeEach;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.DisplayName;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Nested;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.EmptyStackException;</span><br><span class="line"><span class="keyword">import</span> java.util.Stack;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.jupiter.api.Assertions.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> MYXH</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2023/9/23</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="meta">@DisplayName(&quot;一个堆栈&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloTest</span></span><br><span class="line">&#123;</span><br><span class="line">    Stack&lt;Object&gt; stack;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@DisplayName(&quot;使用 new Stack() 实例化堆栈&quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">isInstantiatedWithNew</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Stack</span>&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Nested</span></span><br><span class="line">    <span class="meta">@DisplayName(&quot;当新建时&quot;)</span></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">WhenNew</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="meta">@BeforeEach</span></span><br><span class="line">        <span class="keyword">void</span> <span class="title function_">createNewStack</span><span class="params">()</span></span><br><span class="line">        &#123;</span><br><span class="line">            stack = <span class="keyword">new</span> <span class="title class_">Stack</span>&lt;&gt;();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Test</span></span><br><span class="line">        <span class="meta">@DisplayName(&quot;为空&quot;)</span></span><br><span class="line">        <span class="keyword">void</span> <span class="title function_">isEmpty</span><span class="params">()</span></span><br><span class="line">        &#123;</span><br><span class="line">            assertTrue(stack.isEmpty());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Test</span></span><br><span class="line">        <span class="meta">@DisplayName(&quot;在弹出时抛出 EmptyStackException 异常&quot;)</span></span><br><span class="line">        <span class="keyword">void</span> <span class="title function_">throwsExceptionWhenPopped</span><span class="params">()</span></span><br><span class="line">        &#123;</span><br><span class="line">            assertThrows(EmptyStackException.class, stack::pop);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Test</span></span><br><span class="line">        <span class="meta">@DisplayName(&quot;在查看时抛出 EmptyStackException 异常&quot;)</span></span><br><span class="line">        <span class="keyword">void</span> <span class="title function_">throwsExceptionWhenPeeked</span><span class="params">()</span></span><br><span class="line">        &#123;</span><br><span class="line">            assertThrows(EmptyStackException.class, stack::peek);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Nested</span></span><br><span class="line">        <span class="meta">@DisplayName(&quot;在推入元素后&quot;)</span></span><br><span class="line">        <span class="keyword">class</span> <span class="title class_">AfterPushing</span></span><br><span class="line">        &#123;</span><br><span class="line"></span><br><span class="line">            <span class="type">String</span> <span class="variable">anElement</span> <span class="operator">=</span> <span class="string">&quot;一个元素&quot;</span>;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@BeforeEach</span></span><br><span class="line">            <span class="keyword">void</span> <span class="title function_">pushAnElement</span><span class="params">()</span></span><br><span class="line">            &#123;</span><br><span class="line">                stack.push(anElement);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Test</span></span><br><span class="line">            <span class="meta">@DisplayName(&quot;它不再为空&quot;)</span></span><br><span class="line">            <span class="keyword">void</span> <span class="title function_">isNotEmpty</span><span class="params">()</span></span><br><span class="line">            &#123;</span><br><span class="line">                assertFalse(stack.isEmpty());</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Test</span></span><br><span class="line">            <span class="meta">@DisplayName(&quot;当弹出元素并且为空时返回该元素&quot;)</span></span><br><span class="line">            <span class="keyword">void</span> <span class="title function_">returnElementWhenPopped</span><span class="params">()</span></span><br><span class="line">            &#123;</span><br><span class="line">                assertEquals(anElement, stack.pop());</span><br><span class="line">                assertTrue(stack.isEmpty());</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Test</span></span><br><span class="line">            <span class="meta">@DisplayName(&quot;当查看元素时返回该元素，但仍然保持非空&quot;)</span></span><br><span class="line">            <span class="keyword">void</span> <span class="title function_">returnElementWhenPeeked</span><span class="params">()</span></span><br><span class="line">            &#123;</span><br><span class="line">                assertEquals(anElement, stack.peek());</span><br><span class="line">                assertFalse(stack.isEmpty());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="4-4-2-5-参数化测试"><a href="#4-4-2-5-参数化测试" class="headerlink" title="4.4.2.5 参数化测试"></a>4.4.2.5 参数化测试</h5><p>参数化测试是 JUnit5 很重要的一个新特性，它使得用不同的参数多次运行测试成为了可能，也为单元测试带来许多便利。</p>
<p>利用 @<strong>ValueSource</strong> 等注解，指定入参，将可以使用不同的参数进行多次单元测试，而不需要每新增一个参数就新增一个单元测试，省去了很多冗余代码。</p>
<p>@<strong>ValueSource</strong>：为参数化测试指定入参来源，支持八大基础类以及 String 类型，Class 类型。</p>
<p>@NullSource：表示为参数化测试提供一个 null 的入参。</p>
<p>@EnumSource：表示为参数化测试提供一个枚举入参。</p>
<p>@CsvFileSource：表示读取指定 CSV 文件内容作为参数化测试入参。</p>
<p>@MethodSource：表示读取指定方法的返回值作为参数化测试入参（注意方法返回需要是一个流）。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.myxh.springboot.features;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.myxh.springboot.features.service.HelloService;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.*;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.params.ParameterizedTest;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.params.provider.MethodSource;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.params.provider.ValueSource;</span><br><span class="line"><span class="keyword">import</span> org.junit.platform.commons.util.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.stream.Stream;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具备测试 SpringBoot 应用容器中所有组件的功能，测试类必须在主程序所在的包及其子包</span></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Boot306FeaturesApplicationTests</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 自动注入任意组件即可测试</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    HelloService helloService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@DisplayName(&quot;测试 sum() 方法 &quot;)</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">contextLoads</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">sum</span> <span class="operator">=</span> helloService.sum(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">        Assertions.assertEquals(<span class="number">3</span>, sum);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@DisplayName(&quot;测试1&quot;)</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;test1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 参数化测试</span></span><br><span class="line">    <span class="meta">@ParameterizedTest</span></span><br><span class="line">    <span class="meta">@ValueSource(strings = &#123;&quot;one&quot;, &quot;two&quot;, &quot;three&quot;&#125;)</span></span><br><span class="line">    <span class="meta">@DisplayName(&quot;参数化测试1&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">parameterizedTest1</span><span class="params">(String string)</span></span><br><span class="line">    &#123;</span><br><span class="line">        System.out.println(string);</span><br><span class="line">        Assertions.assertTrue(StringUtils.isNotBlank(string));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ParameterizedTest</span></span><br><span class="line">    <span class="comment">// 指定方法名，返回值就是测试用的参数</span></span><br><span class="line">    <span class="meta">@MethodSource(&quot;method&quot;)</span></span><br><span class="line">    <span class="meta">@DisplayName(&quot;方法来源参数&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testWithExplicitLocalMethodSource</span><span class="params">(String name)</span></span><br><span class="line">    &#123;</span><br><span class="line">        System.out.println(name);</span><br><span class="line">        Assertions.assertNotNull(name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> Stream&lt;String&gt; <span class="title function_">method</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 返回 Stream 则可</span></span><br><span class="line">        <span class="keyword">return</span> Stream.of(<span class="string">&quot;apple&quot;</span>, <span class="string">&quot;banana&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 所有测试方法运行之前先运行这个，只打印一次</span></span><br><span class="line">    <span class="meta">@BeforeAll</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">initAll</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 每个测试方法运行之前先运行这个，每个方法运行打印一次</span></span><br><span class="line">    <span class="meta">@BeforeEach</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;world&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="第-5-章-SpringBoot3-核心原理"><a href="#第-5-章-SpringBoot3-核心原理" class="headerlink" title="第 5 章 SpringBoot3-核心原理"></a>第 5 章 SpringBoot3-核心原理</h2><h3 id="5-1-事件和监听器"><a href="#5-1-事件和监听器" class="headerlink" title="5.1 事件和监听器"></a>5.1 事件和监听器</h3><h4 id="5-1-1-生命周期监听"><a href="#5-1-1-生命周期监听" class="headerlink" title="5.1.1 生命周期监听"></a>5.1.1 生命周期监听</h4><p>场景：监听<strong>应用</strong>的<strong>生命周期</strong>。</p>
<h5 id="5-1-1-1-监听器-SpringApplicationRunListener"><a href="#5-1-1-1-监听器-SpringApplicationRunListener" class="headerlink" title="5.1.1.1 监听器 SpringApplicationRunListener"></a>5.1.1.1 监听器 SpringApplicationRunListener</h5><p>1、自定义 <code>SpringApplicationRunListener</code> 来<strong>监听事件</strong>。</p>
<ul>
<li><p>① 编写 <code>SpringApplicationRunListener</code> <strong>实现类</strong>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.myxh.springboot.core.listener;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.ConfigurableBootstrapContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplicationRunListener;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ConfigurableApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.env.ConfigurableEnvironment;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.time.Duration;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> MYXH</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2023/9/24</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span></span></span><br><span class="line"><span class="comment"> * SpringBoot 应用生命周期监听</span></span><br><span class="line"><span class="comment"> * &lt;br&gt;</span></span><br><span class="line"><span class="comment"> * Listener先要从 META-INF/spring.factories 读到</span></span><br><span class="line"><span class="comment"> * &lt;br&gt;</span></span><br><span class="line"><span class="comment"> * 1、引导：利用 BootstrapContext 引导整个项目启动</span></span><br><span class="line"><span class="comment"> *         starting：               应用开始，SpringApplication 的 run 方法一调用，只要有了 BootstrapContext 就执行</span></span><br><span class="line"><span class="comment"> *         environmentPrepared：    环境准备好（把启动参数等绑定到环境变量中），但是 ioc 还没有创建（调一次）</span></span><br><span class="line"><span class="comment"> * 2、启动：</span></span><br><span class="line"><span class="comment"> *        contextPrepared：         ioc 容器创建并准备好，但是 sources（主配置类）没加载，并关闭引导上下文，组件都没创建（调一次）</span></span><br><span class="line"><span class="comment"> *        contextLoaded：           ioc 容器加载，主配置类加载进去了，但是 ioc 容器还没刷新（bean 没创建）</span></span><br><span class="line"><span class="comment"> *        ----- 截止现在，ioc 容器里面还没造 bean -----</span></span><br><span class="line"><span class="comment"> *        started：                 ioc 容器刷新了（所有 bean 造好了），但是 runner 没调用</span></span><br><span class="line"><span class="comment"> *        ready：                   ioc 容器刷新了（所有 bean 造好了），所有 runner 调用完了</span></span><br><span class="line"><span class="comment"> * 3、运行：</span></span><br><span class="line"><span class="comment"> *       以上步骤都正确执行，代表容器 running。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAppListener</span> <span class="keyword">implements</span> <span class="title class_">SpringApplicationRunListener</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">starting</span><span class="params">(ConfigurableBootstrapContext bootstrapContext)</span></span><br><span class="line">    &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;--------------- starting() 正在启动 ---------------&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">environmentPrepared</span><span class="params">(ConfigurableBootstrapContext bootstrapContext, ConfigurableEnvironment environment)</span></span><br><span class="line">    &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;--------------- environmentPrepared() 环境准备完成 ---------------&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">contextPrepared</span><span class="params">(ConfigurableApplicationContext context)</span></span><br><span class="line">    &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;--------------- contextPrepared() ioc 容器准备完成 ---------------&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">contextLoaded</span><span class="params">(ConfigurableApplicationContext context)</span></span><br><span class="line">    &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;--------------- contextLoaded() ioc 容器加载完成 ---------------&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">started</span><span class="params">(ConfigurableApplicationContext context, Duration timeTaken)</span></span><br><span class="line">    &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;--------------- started() 启动完成 ---------------&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">ready</span><span class="params">(ConfigurableApplicationContext context, Duration timeTaken)</span></span><br><span class="line">    &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;--------------- ready() 准备就绪 ---------------&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">failed</span><span class="params">(ConfigurableApplicationContext context, Throwable exception)</span></span><br><span class="line">    &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;--------------- failed() 应用启动失败 ---------------&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.myxh.springboot.core.listener;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationEvent;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationListener;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> MYXH</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2023/9/24</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyListener</span> <span class="keyword">implements</span> <span class="title class_">ApplicationListener</span>&lt;ApplicationEvent&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onApplicationEvent</span><span class="params">(ApplicationEvent event)</span></span><br><span class="line">    &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;-------- 事件到达 --------&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;event = &quot;</span> + event);</span><br><span class="line">        System.out.println(<span class="string">&quot;------------------------&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>② 在 <code>META-INF/spring.factories</code> 中配置 <code>org.springframework.boot.SpringApplicationRunListener=自己的 Listener</code>，还可以指定一个<strong>有参构造器</strong>，接受两个参数<code>(SpringApplication application, String[] args)</code>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">org.springframework.boot.SpringApplicationRunListener=\</span><br><span class="line">com.myxh.springboot.core.listener.MyAppListener</span><br><span class="line"></span><br><span class="line">org.springframework.context.ApplicationListener=\</span><br><span class="line">com.myxh.springboot.core.listener.MyListener</span><br></pre></td></tr></table></figure>
</li>
<li><p>③ springboot 在 <code>spring-boot.jar</code> 中配置了默认的 Listener，如下。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># Run Listeners</span><br><span class="line">org.springframework.boot.SpringApplicationRunListener=\</span><br><span class="line">org.springframework.boot.context.event.EventPublishingRunListener</span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="5-1-1-2-生命周期全流程"><a href="#5-1-1-2-生命周期全流程" class="headerlink" title="5.1.1.2 生命周期全流程"></a>5.1.1.2 生命周期全流程</h5><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://reggie-xiamou.oss-cn-beijing.aliyuncs.com/img/4862e326b6784082ae0ba11a17438ce2.png" alt="生命周期全流程"></p>
<h4 id="5-1-2-事件触发时机"><a href="#5-1-2-事件触发时机" class="headerlink" title="5.1.2 事件触发时机"></a>5.1.2 事件触发时机</h4><h5 id="5-1-2-1-各种回调监听器"><a href="#5-1-2-1-各种回调监听器" class="headerlink" title="5.1.2.1 各种回调监听器"></a>5.1.2.1 各种回调监听器</h5><ul>
<li><p><code>BootstrapRegistryInitializer</code>：<strong>感知特定阶段</strong>，感知<strong>引导初始化</strong>。</p>
<ul>
<li><p><code>META-INF/spring.factories</code>。</p>
</li>
<li><p><strong>创建引导上下文</strong> <code>bootstrapContext</code> <strong>的时候触发</strong>。</p>
</li>
<li><p><code>application.addBootstrapRegistryInitializer();</code></p>
</li>
<li><p><strong>场景</strong>：<strong>进行密钥校对授权</strong>。</p>
</li>
</ul>
</li>
<li><p>ApplicationContextInitializer：<strong>感知特定阶段</strong>，感知 ioc 容器初始化。</p>
<ul>
<li><p><code>META-INF/spring.factories</code>。</p>
</li>
<li><p><code>application.addInitializers();</code></p>
</li>
</ul>
</li>
<li><p><strong>ApplicationListener</strong>：<strong>感知全阶段，基于事件机制，感知事件，一旦到了哪个阶段可以做别的事。</strong></p>
<ul>
<li><p><code>@Bean</code> 或 <code>@EventListener</code>：<strong>事件驱动</strong>。</p>
</li>
<li><p><code>SpringApplication.addListeners(...)</code> 或 <code>SpringApplicationBuilder.listeners(...)</code>。</p>
</li>
<li><p><code>META-INF/spring.factories</code>。</p>
</li>
</ul>
</li>
<li><p><strong>SpringApplicationRunListener</strong>：<strong>感知全阶段生命周期 + 各种阶段都能自定义操作，功能更完善。</strong></p>
<ul>
<li><code>META-INF/spring.factories</code>。</li>
</ul>
</li>
<li><p><strong>ApplicationRunner</strong>：<strong>感知特定阶段，感知应用就绪 Ready，卡死应用，就不会就绪。</strong></p>
<ul>
<li><code>@Bean</code>。</li>
</ul>
</li>
<li><p><strong>CommandLineRunner</strong>：<strong>感知特定阶段，感知应用就绪 Ready，卡死应用，就不会就绪。</strong></p>
<ul>
<li><code>@Bean</code>。</li>
</ul>
</li>
</ul>
<p>最佳实战：</p>
<ul>
<li><p>如果想要在项目启动前操作：<code>BootstrapRegistryInitializer</code> 和 <code>ApplicationContextInitializer</code>。</p>
</li>
<li><p>如果想要在项目启动完成后操作：<strong>ApplicationRunner</strong> 和 <strong>CommandLineRunner</strong>。</p>
</li>
<li><p><strong>如果要干涉生命周期做事</strong>：<strong>SpringApplicationRunListener</strong>。</p>
</li>
<li><p><strong>如果想要用事件机制</strong>：<strong>ApplicationListener</strong>。</p>
</li>
</ul>
<h5 id="5-1-2-2-完整触发流程"><a href="#5-1-2-2-完整触发流程" class="headerlink" title="5.1.2.2 完整触发流程"></a>5.1.2.2 完整触发流程</h5><p><strong>9 大事件</strong>触发顺序和时机：</p>
<p>1、<code>ApplicationStartingEvent</code>：应用启动但未做任何事情, 除过注册 <code>listeners</code> 和 <code>initializers</code>。</p>
<p>2、<code>ApplicationEnvironmentPreparedEvent</code>：Environment 准备好，但 context 未创建。</p>
<p>3、<code>ApplicationContextInitializedEvent</code>：ApplicationContext 准备好，ApplicationContextInitializers 调用，但是任何 bean 未加载。</p>
<p>4、<code>ApplicationPreparedEvent</code>：容器刷新之前，bean 定义信息加载。</p>
<p>5、<code>ApplicationStartedEvent</code>：容器刷新完成， runner 未调用。</p>
<blockquote>
<p>以下就开始插入了探针机制。</p>
</blockquote>
<p>6、<code>AvailabilityChangeEvent</code>：<code>LivenessState.CORRECT</code> 应用存活，<strong>存活探针</strong>。</p>
<p>7、<code>ApplicationReadyEvent</code>：任何 runner 被调用。</p>
<p>8、<code>AvailabilityChangeEvent</code>：<code>ReadinessState.ACCEPTING_TRAFFIC</code> <strong>就绪探针</strong>，可以接请求。</p>
<p>9、<code>ApplicationFailedEvent</code>：启动出错。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://reggie-xiamou.oss-cn-beijing.aliyuncs.com/img/6b6757fe30ef4c2ab0ae5999c898cffa.png" alt="完整触发流程"></p>
<p>应用事件发送顺序如下：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://reggie-xiamou.oss-cn-beijing.aliyuncs.com/img/1cb875f2dc334c43b9a04c3848fad92f.png" alt="完整触发流程"></p>
<p>感知应用是否<strong>存活</strong>了：可能植物状态，虽然活着但是不能处理请求。</p>
<p>应用是否<strong>就绪</strong>了：能响应请求，说明确实活的比较好。</p>
<h5 id="5-1-2-3-SpringBoot-事件驱动开发"><a href="#5-1-2-3-SpringBoot-事件驱动开发" class="headerlink" title="5.1.2.3 SpringBoot 事件驱动开发"></a>5.1.2.3 SpringBoot 事件驱动开发</h5><blockquote>
<p>应用启动过程生命周期事件感知（9 大事件）、应用运行中事件感知（无数种）。</p>
</blockquote>
<ul>
<li><p><strong>事件发布</strong>：<code>ApplicationEventPublisherAware</code> 或<code>注入 ApplicationEventMulticaster</code>。</p>
</li>
<li><p><strong>事件监听</strong>：<code>组件 + @EventListener</code>。</p>
</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://reggie-xiamou.oss-cn-beijing.aliyuncs.com/img/49c5943f77474d78a66211f04944ac5b.png" alt="SpringBoot 事件驱动开发"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://reggie-xiamou.oss-cn-beijing.aliyuncs.com/img/bf0a43d500aa4a8ea94e38dbb2772e71.png" alt="SpringBoot 事件驱动开发"></p>
<blockquote>
<p>事件发布者。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.myxh.springboot.core.event;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationEvent;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationEventPublisher;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationEventPublisherAware;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> MYXH</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2023/9/24</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 事件是广播出去的，所有监听这个事件的监听器都可以收到</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EventPublisher</span> <span class="keyword">implements</span> <span class="title class_">ApplicationEventPublisherAware</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 底层发送事件用的组件，SpringBoot 会通过 ApplicationEventPublisherAware 接口自动注入</span></span><br><span class="line">    ApplicationEventPublisher applicationEventPublisher;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 所有事件都可以发</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> event 事件</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendEvent</span><span class="params">(ApplicationEvent event)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 调用底层 API 发送事件</span></span><br><span class="line">        applicationEventPublisher.publishEvent(event);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 会被自动调用，把真正发事件的底层组组件给注入进来</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> applicationEventPublisher 此对象要使用的事件发布者</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setApplicationEventPublisher</span><span class="params">(ApplicationEventPublisher applicationEventPublisher)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">this</span>.applicationEventPublisher = applicationEventPublisher;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.myxh.springboot.core.event;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.myxh.springboot.core.entity.UserEntity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationEvent;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> MYXH</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2023/9/24</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 登录成功事件，所有事件都推荐继承 ApplicationEvent</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginSuccessEvent</span> <span class="keyword">extends</span> <span class="title class_">ApplicationEvent</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 登录成功事件</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> source 事件来源，代表是谁登录成了</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LoginSuccessEvent</span><span class="params">(UserEntity source)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">super</span>(source);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>事件订阅者。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.myxh.springboot.core.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.myxh.springboot.core.entity.UserEntity;</span><br><span class="line"><span class="keyword">import</span> com.myxh.springboot.core.event.LoginSuccessEvent;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.event.EventListener;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.annotation.Order;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> MYXH</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2023/9/24</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SystemService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Order(1)</span></span><br><span class="line">    <span class="meta">@EventListener</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onEvent</span><span class="params">(LoginSuccessEvent event)</span></span><br><span class="line">    &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;-------- SystemService 感知到事件 --------&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;event = &quot;</span> + event);</span><br><span class="line">        System.out.println(<span class="string">&quot;------------------------&quot;</span>);</span><br><span class="line">        <span class="type">UserEntity</span> <span class="variable">source</span> <span class="operator">=</span> (UserEntity) event.getSource();</span><br><span class="line">        recordLog(source.getUsername());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">recordLog</span><span class="params">(String username)</span></span><br><span class="line">    &#123;</span><br><span class="line">        System.out.println(username + <span class="string">&quot;登录信息已被记录&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.myxh.springboot.core.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.myxh.springboot.core.entity.UserEntity;</span><br><span class="line"><span class="keyword">import</span> com.myxh.springboot.core.event.LoginSuccessEvent;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationListener;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.annotation.Order;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> MYXH</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2023/9/24</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Order(2)</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AccountService</span> <span class="keyword">implements</span> <span class="title class_">ApplicationListener</span>&lt;LoginSuccessEvent&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addAccountScore</span><span class="params">(String username)</span></span><br><span class="line">    &#123;</span><br><span class="line">        System.out.println(username + <span class="string">&quot; 加了 1 分&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onApplicationEvent</span><span class="params">(LoginSuccessEvent event)</span></span><br><span class="line">    &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;-------- AccountService  收到事件 --------&quot;</span>);</span><br><span class="line">        <span class="type">UserEntity</span> <span class="variable">source</span> <span class="operator">=</span> (UserEntity) event.getSource();</span><br><span class="line">        addAccountScore(source.getUsername());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.myxh.springboot.core.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.myxh.springboot.core.entity.UserEntity;</span><br><span class="line"><span class="keyword">import</span> com.myxh.springboot.core.event.LoginSuccessEvent;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.event.EventListener;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.annotation.Order;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.annotation.Async;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> MYXH</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2023/9/24</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CouponService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CouponService</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;构造器调用&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Async</span></span><br><span class="line">    <span class="meta">@Order(3)</span></span><br><span class="line">    <span class="meta">@EventListener</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onEvent</span><span class="params">(LoginSuccessEvent loginSuccessEvent)</span></span><br><span class="line">    &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;-------- CouponService 感知到事件 --------&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;loginSuccessEvent = &quot;</span> + loginSuccessEvent);</span><br><span class="line">        System.out.println(<span class="string">&quot;------------------------&quot;</span>);</span><br><span class="line">        <span class="type">UserEntity</span> <span class="variable">source</span> <span class="operator">=</span> (UserEntity) loginSuccessEvent.getSource();</span><br><span class="line">        sendCoupon(source.getUsername());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendCoupon</span><span class="params">(String username)</span></span><br><span class="line">    &#123;</span><br><span class="line">        System.out.println(username + <span class="string">&quot; 随机得到了一张优惠券&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.myxh.springboot.core.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.myxh.springboot.core.event.LoginSuccessEvent;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.event.EventListener;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> MYXH</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2023/9/24</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@EventListener</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onEvent</span><span class="params">(LoginSuccessEvent event)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;-------- HelloService 感知到事件 --------&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;event = &quot;</span> + event);</span><br><span class="line">        System.out.println(<span class="string">&quot;------------------------&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 调用业务</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-2-自动配置原理"><a href="#5-2-自动配置原理" class="headerlink" title="5.2 自动配置原理"></a>5.2 自动配置原理</h3><h4 id="5-2-1-入门理解"><a href="#5-2-1-入门理解" class="headerlink" title="5.2.1 入门理解"></a>5.2.1 入门理解</h4><blockquote>
<p>应用关注的三大核心：场景、配置、组件。</p>
</blockquote>
<h5 id="5-2-1-1-自动配置流程"><a href="#5-2-1-1-自动配置流程" class="headerlink" title="5.2.1.1 自动配置流程"></a>5.2.1.1 自动配置流程</h5><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://reggie-xiamou.oss-cn-beijing.aliyuncs.com/img/3d28ae3daa994763b4d03ca627bcd969.png" alt="自动配置流程"></p>
<p>1、导入 <code>starter</code>。</p>
<p>2、依赖导入 <code>autoconfigure</code>。</p>
<p>3、寻找类路径下 <code>META-INF/spring/org.springframework.boot.autoconfigure.AutoConfiguration.imports</code> 文件。</p>
<p>4、启动，加载所有<strong>自动配置类</strong> <code>xxxAutoConfiguration</code>。</p>
<ul>
<li><p>① 给容器中配置<strong>功能组件</strong>。</p>
</li>
<li><p>② <code>组件参数</code>绑定到<code>属性类</code>中，<code>xxxProperties</code>。</p>
</li>
<li><p>③ <code>属性类</code>和<code>配置文件</code>前缀项绑定。</p>
</li>
<li><p>④ <code>@Contional 派生的条件注解进</code>行判断<strong>是否组件生效</strong>。</p>
</li>
</ul>
<p>5、效果：</p>
<ul>
<li><p>① 修改配置文件，修改底层参数。</p>
</li>
<li><p>② 所有场景自动配置好直接使用。</p>
</li>
<li><p>③ 可以注入 SpringBoot 配置好的组件随时使用。</p>
</li>
</ul>
<h5 id="5-2-1-2-SPI-机制"><a href="#5-2-1-2-SPI-机制" class="headerlink" title="5.2.1.2 SPI 机制"></a>5.2.1.2 SPI 机制</h5><blockquote>
<ul>
<li><p><strong>Java 中的 SPI（Service Provider Interface）是一种软件设计模式，用于在应用程序中动态地发现和加载组件</strong>。<strong>SPI 的思想</strong>是，定义一个接口或抽象类，然后通过在 classpath 中定义实现该接口的类来实现对组件的动态发现和加载。</p>
</li>
<li><p><strong>SPI</strong> 的主要目的是解决在应用程序中使用可插拔组件的问题。例如，一个应用程序可能需要使用不同的日志框架或数据库连接池，但是这些组件的选择可能取决于运行时的条件。通过使用 <strong>SPI</strong>，应用程序可以在运行时发现并加载适当的组件，而无需在代码中硬编码这些组件的实现类。</p>
</li>
<li><p>在 Java 中，<strong>SPI</strong> 的实现方式是通过在 <strong>META-INF&#x2F;services</strong> 目录下创建一个以服务接口全限定名为名字的文件，文件中包含实现该服务接口的类的全限定名。当应用程序启动时，Java 的 <strong>SPI</strong> 机制会自动扫描 classpath 中的这些文件，并根据文件中指定的类名来加载实现类。</p>
</li>
<li><p>通过使用 <strong>SPI</strong>，应用程序可以实现更灵活、可扩展的架构，同时也可以避免硬编码依赖关系和增加代码的可维护性。</p>
</li>
</ul>
</blockquote>
<p>在 SpringBoot 中，<code>META-INF/spring/org.springframework.boot.autoconfigure.AutoConfiguration.imports</code>。</p>
<blockquote>
<p>写一段 Java 的 SPI 机制代码。</p>
</blockquote>
<p>下面是一个简单的 Java SPI（Service Provider Interface）机制的示例代码，代码中包含了详细的注释说明：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.spi;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义服务接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">MyService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">execute</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.spi;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义服务提供者 1</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyService1</span> <span class="keyword">implements</span> <span class="title class_">MyService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">execute</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;MyService1 正在执行。&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.spi;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义服务提供者 2</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyService2</span> <span class="keyword">implements</span> <span class="title class_">MyService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">execute</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;MyService2 正在执行。&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.spi;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ServiceLoader;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义服务加载器</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServiceLoader</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 加载并执行服务</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">loadAndExecuteServices</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 使用Java SPI机制加载所有的服务提供者</span></span><br><span class="line">        java.util.ServiceLoader&lt;MyService&gt; serviceLoader = java.util.ServiceLoader.load(MyService.class);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 遍历所有的服务提供者，并执行服务</span></span><br><span class="line">        <span class="keyword">for</span> (MyService service : serviceLoader)</span><br><span class="line">        &#123;</span><br><span class="line">            service.execute();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.spi;</span><br><span class="line"><span class="comment">// 测试代码</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">ServiceLoader</span> <span class="variable">loader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServiceLoader</span>();</span><br><span class="line">        loader.loadAndExecuteServices();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面的代码展示了如何使用 Java SPI 机制来加载并执行服务提供者。其中，<code>MyService</code> 是服务接口，<code>MyService1</code> 和 <code>MyService2</code> 是两个具体的服务提供者实现。<code>ServiceLoader</code> 是服务加载器，它通过 <code>java.util.ServiceLoader</code> 来加载所有的服务提供者，并执行服务的 <code>execute()</code> 方法。最后，在 <code>Main</code> 类的 <code>main()</code> 方法中调用 <code>ServiceLoader</code> 的 <code>loadAndExecuteServices()</code> 方法即可加载并执行服务提供者。</p>
<p>注意：在实际使用 Java SPI 机制时，需要在 <code>src/main/resources/META-INF/services</code> 目录下创建一个以服务接口全限定名命名的文件，文件内容为具体的服务提供者实现类的全限定名。在本示例中，需要创建 <code>src/main/resources/META-INF/services/com.example.MyService</code> 文件，并在其中分别写入 <code>com.example.MyService1</code> 和 <code>com.example.MyService2</code>。这样，在调用 <code>java.util.ServiceLoader.load()</code> 方法时，就能正确加载到所有的服务提供者实现类。</p>
<h5 id="5-2-1-3-功能开关"><a href="#5-2-1-3-功能开关" class="headerlink" title="5.2.1.3 功能开关"></a>5.2.1.3 功能开关</h5><ul>
<li><p>自动配置：全部都配置好，什么都不用管，自动批量导入。</p>
<ul>
<li>项目一启动，SPI 文件中指定的所有都加载。</li>
</ul>
</li>
<li><p><code>@EnableXxx</code>：手动控制哪些功能的开启，手动导入。</p>
<ul>
<li><p>开启 xxx 功能。</p>
</li>
<li><p>都是利用 @Import 把此功能要用的组件导入进去。</p>
</li>
</ul>
</li>
</ul>
<h4 id="5-2-2-进阶理解"><a href="#5-2-2-进阶理解" class="headerlink" title="5.2.2 进阶理解"></a>5.2.2 进阶理解</h4><h5 id="5-2-2-1-SpringBootApplication"><a href="#5-2-2-1-SpringBootApplication" class="headerlink" title="5.2.2.1 @SpringBootApplication"></a>5.2.2.1 @SpringBootApplication</h5><p><strong>@SpringBootConfiguration</strong>。</p>
<p>就是 @Configuration，容器中的组件，配置类，Spring IOC 启动就会加载创建这个类对象。</p>
<p><strong>@EnableAutoConfiguration：开启自动配置</strong>。</p>
<p>开启自动配置。</p>
<p><strong>@AutoConfigurationPackage：扫描主程序包，加载自己的组件</strong>。</p>
<ul>
<li><p>利用 <code>@Import(AutoConfigurationPackages.Registrar.class)</code> 想要给容器中导入组件。</p>
</li>
<li><p>把<strong>主程序所在的包</strong>的所有组件导入进来。</p>
</li>
<li><p><strong>为什么 SpringBoot 默认只扫描主程序所在的包及其子包。</strong></p>
</li>
</ul>
<p><strong>@Import(AutoConfigurationImportSelector.class)：加载所有自动配置类，加载 starter 导入的组件</strong>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; configurations = ImportCandidates.load(AutoConfiguration.class, getBeanClassLoader())</span><br><span class="line">    .getCandidates();</span><br></pre></td></tr></table></figure>

<blockquote>
<p>扫描 SPI 文件：<strong>META-INF&#x2F;spring&#x2F;org.springframework.boot.autoconfigure.AutoConfiguration.imports</strong>。</p>
</blockquote>
<p><strong>@ComponentScan</strong>。</p>
<blockquote>
<p>组件扫描：排除一些组件（哪些不要）。</p>
<p>排除前面已经扫描进来的<strong>配置类</strong>、和<strong>自动配置类</strong>。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ComponentScan(excludeFilters = &#123;@Filter(type = FilterType.CUSTOM, classes = TypeExcludeFilter.class),</span></span><br><span class="line"><span class="meta">    @Filter(type = FilterType.CUSTOM, classes = AutoConfigurationExcludeFilter.class)&#125;)</span></span><br></pre></td></tr></table></figure>

<h5 id="5-2-2-2-完整启动加载流程"><a href="#5-2-2-2-完整启动加载流程" class="headerlink" title="5.2.2.2 完整启动加载流程"></a>5.2.2.2 完整启动加载流程</h5><blockquote>
<p>生命周期启动加载流程。</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://reggie-xiamou.oss-cn-beijing.aliyuncs.com/img/fdd18182fd5045368a80db61a5352b94.png" alt="完整启动加载流程"></p>
<h3 id="5-3-自定义-starter"><a href="#5-3-自定义-starter" class="headerlink" title="5.3 自定义 starter"></a>5.3 自定义 starter</h3><blockquote>
<p>场景：<strong>抽取聊天机器人场景，它可以打招呼</strong>。</p>
<p>效果：任何项目导入此 <strong>starter</strong> 都具有打招呼功能，并且<strong>问候语</strong>中的<strong>人名</strong>需要可以在<strong>配置文件</strong>中修改。</p>
</blockquote>
<ul>
<li><p>1、创建<code>自定义 starter</code> 项目，引入 <code>spring-boot-starter</code> 基础依赖。</p>
</li>
<li><p>2、编写模块功能，引入模块所有需要的依赖。</p>
</li>
<li><p>3、编写 <code>xxxAutoConfiguration</code> 自动配置类，帮其他项目导入这个模块需要的所有组件。</p>
</li>
<li><p>4、编写配置文件 <code>META-INF/spring/org.springframework.boot.autoconfigure.AutoConfiguration.imports</code> 指定启动需要加载的自动配置。</p>
</li>
<li><p>5、其他项目引入即可使用。</p>
</li>
</ul>
<h4 id="5-3-1-业务代码"><a href="#5-3-1-业务代码" class="headerlink" title="5.3.1 业务代码"></a>5.3.1 业务代码</h4><blockquote>
<p>自定义配置有提示，导入以下依赖重启项目，再写配置文件就有提示。</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 导入配置处理器，配置文件自定义的 properties 配置都会有提示 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.myxh.springboot.starter.robot.properties;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> MYXH</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2023/9/24</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">// 此属性类和配置文件指定前缀绑定</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;robot&quot;)</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RobotProperties</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">robot.name</span>=<span class="string">MYXH</span></span><br><span class="line"><span class="attr">robot.age</span>=<span class="string">21</span></span><br><span class="line"><span class="attr">robot.email</span>=<span class="string">1735350920@qq.com</span></span><br></pre></td></tr></table></figure>

<h4 id="5-3-2-基本抽取"><a href="#5-3-2-基本抽取" class="headerlink" title="5.3.2 基本抽取"></a>5.3.2 基本抽取</h4><ul>
<li><p>创建 starter 项目，把公共代码需要的所有依赖导入。</p>
</li>
<li><p>把公共代码复制进来。</p>
</li>
<li><p>自己写一个 <code>RobotAutoConfiguration</code>，给容器中导入这个场景需要的所有组件。</p>
<ul>
<li><p>为什么这些组件默认不会扫描进去？</p>
</li>
<li><p><strong>starter 所在的包和引入它的项目的主程序所在的包不是父子层级</strong>。</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.myxh.springboot.starter.robot;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.myxh.springboot.starter.robot.controller.RobotController;</span><br><span class="line"><span class="keyword">import</span> com.myxh.springboot.starter.robot.properties.RobotProperties;</span><br><span class="line"><span class="keyword">import</span> com.myxh.springboot.starter.robot.service.RobotService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Import;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> MYXH</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2023/9/24</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">// 给容器中导入 Robot 功能要用的所有组件</span></span><br><span class="line"><span class="meta">@Import(&#123;RobotProperties.class, RobotController.class, RobotService.class&#125;)</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RobotAutoConfiguration</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    // 把组件导入到容器中</span></span><br><span class="line"><span class="comment">    @Bean</span></span><br><span class="line"><span class="comment">    public RobotController robotController()</span></span><br><span class="line"><span class="comment">    &#123;</span></span><br><span class="line"><span class="comment">        return new RobotController();</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>别人引用这个 <code>starter</code>，直接导入这个 <code>RobotAutoConfiguration</code>，就能把这个场景的组件导入进来。</p>
</li>
<li><p>功能生效。</p>
</li>
<li><p>测试编写配置文件。</p>
</li>
</ul>
<h4 id="5-3-3-使用-EnableXxx-机制"><a href="#5-3-3-使用-EnableXxx-机制" class="headerlink" title="5.3.3 使用@EnableXxx 机制"></a>5.3.3 使用@EnableXxx 机制</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.myxh.springboot.starter.robot.annotation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.myxh.springboot.starter.robot.RobotAutoConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Import;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> MYXH</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2023/9/24</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Target(&#123;ElementType.TYPE&#125;)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Import(RobotAutoConfiguration.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> EnableRobot</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>别人引入 <code>starter</code> 需要使用 <code>@EnableRobot</code> 开启功能。</p>
<h4 id="5-3-4-完全自动配置"><a href="#5-3-4-完全自动配置" class="headerlink" title="5.3.4 完全自动配置"></a>5.3.4 完全自动配置</h4><ul>
<li><p>依赖 SpringBoot 的 SPI 机制。</p>
</li>
<li><p><code>META-INF/spring/org.springframework.boot.autoconfigure.AutoConfiguration.imports</code> <strong>文件中编写好自动配置类的全类名即可</strong>。</p>
</li>
<li><p><strong>项目启动，自动加载自动配置类</strong>。</p>
</li>
</ul>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="http://example.com">Xiamou</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2023/10/09/SpringBoot3%20%E5%85%A8%E6%A0%88%E6%8C%87%E5%8D%97%E6%95%99%E7%A8%8B%E2%80%94%E2%80%94%E5%B0%9A%E7%A1%85%E8%B0%B7%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%202023%E5%B9%B4/">http://example.com/2023/10/09/SpringBoot3%20%E5%85%A8%E6%A0%88%E6%8C%87%E5%8D%97%E6%95%99%E7%A8%8B%E2%80%94%E2%80%94%E5%B0%9A%E7%A1%85%E8%B0%B7%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%202023%E5%B9%B4/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">X</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Java/">Java</a><a class="post-meta__tags" href="/tags/Springboot/">Springboot</a></div><div class="post_share"><div class="social-share" data-image="https://img1.baidu.com/it/u=4046275171,1854121622&amp;fm=253&amp;fmt=auto?w=640&amp;h=356" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://unpkg.com/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://unpkg.com/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>赞助</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.png" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/wechat.png" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/alipay.jpg" alt="alipay"/></a><div class="post-qr-code-desc">alipay</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/09/12/Jmeter%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/" title="微服务保护-Jmeter测压"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img1.baidu.com/it/u=2262705403,2451223120&amp;fm=253&amp;fmt=auto&amp;app=138&amp;f=JPEG?w=1079&amp;h=500" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">微服务保护-Jmeter测压</div></div></a></div><div class="next-post pull-right"><a href="/2023/10/16/day06-%E6%95%B0%E6%8D%AE%E5%BA%93-MySQL/" title="Javaweb-06-数据库-MySQL"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://ts1.cn.mm.bing.net/th/id/R-C.6b47d7fec15d3e1a5de086ac1c808f6d?rik=IIkC39481Md3Bw&amp;riu=http%3a%2f%2flogos-download.com%2fwp-content%2fuploads%2f2016%2f05%2fMySQL_logo_logotype.png&amp;ehk=aWHquyoObU%2fXSsDiw7VKaqGdBCxP2cRjipdNUO5Q6us%3d&amp;risl=&amp;pid=ImgRaw&amp;r=0" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Javaweb-06-数据库-MySQL</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2023/08/12/day04-SpringBootWeb%E5%85%A5%E9%97%A8/" title="Javaweb-04-SpringBootWeb入门"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img1.baidu.com/it/u=498065172,1977196320&fm=253&fmt=auto&app=138&f=JPEG?w=734&h=345" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-08-12</div><div class="title">Javaweb-04-SpringBootWeb入门</div></div></a></div><div><a href="/2023/08/24/day05-SpringBootWeb%E8%AF%B7%E6%B1%82%E5%93%8D%E5%BA%94/" title="Javaweb-05-SpringBootWeb请求响应"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img1.baidu.com/it/u=850096061,3652516542&fm=253&fmt=auto&app=138&f=JPEG?w=600&h=338" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-08-24</div><div class="title">Javaweb-05-SpringBootWeb请求响应</div></div></a></div><div><a href="/2023/09/12/Jmeter%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/" title="微服务保护-Jmeter测压"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img1.baidu.com/it/u=2262705403,2451223120&fm=253&fmt=auto&app=138&f=JPEG?w=1079&h=500" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-09-12</div><div class="title">微服务保护-Jmeter测压</div></div></a></div><div><a href="/2023/07/22/day01-HTML-CSS/" title="Javaweb-01-HTML-CSS"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img2.baidu.com/it/u=3903210978,452660782&fm=253&fmt=auto&app=138&f=JPEG?w=499&h=34zazaci" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-07-22</div><div class="title">Javaweb-01-HTML-CSS</div></div></a></div><div><a href="/2023/09/12/SpringCloud-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/" title="SpringCloud-微服务保护"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://reggie-xiamou.oss-cn-beijing.aliyuncs.com/img/image-20230912162649711.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-09-12</div><div class="title">SpringCloud-微服务保护</div></div></a></div><div><a href="/2023/07/27/day04-Maven/" title="Javaweb-04-Maven"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img2.baidu.com/it/u=3731752201,3579874012&fm=253&fmt=auto&app=120&f=JPEG?w=800&h=500" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-07-27</div><div class="title">Javaweb-04-Maven</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://reggie-xiamou.oss-cn-beijing.aliyuncs.com/other/QQ%E5%9B%BE%E7%89%8720230721130300.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Xiamou</div><div class="author-info__description">漂泊在平庸的海</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">23</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">14</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">1</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xiamou7777777"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/xiamou7777777" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="/2449882380@qq.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="http://wpa.qq.com/msgrd?v=3&amp;uin=2449882380&amp;site=qq&amp;menu=yes" target="_blank" title="QQ"><i class="fab fa-qq"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">欢迎来到夏某的博客!</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#SpringBoot3-%E5%85%A8%E6%A0%88%E6%8C%87%E5%8D%97%E6%95%99%E7%A8%8B%E2%80%94%E2%80%94%E5%B0%9A%E7%A1%85%E8%B0%B7%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-2023-%E5%B9%B4"><span class="toc-number">1.</span> <span class="toc-text">SpringBoot3 全栈指南教程——尚硅谷学习笔记 2023 年</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80%E3%80%81Spring-Boot-3-%E6%A0%B8%E5%BF%83%E7%89%B9%E6%80%A7"><span class="toc-number">2.</span> <span class="toc-text">一、Spring Boot 3-核心特性</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC-1-%E7%AB%A0-SpringBoot3-%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8"><span class="toc-number">2.1.</span> <span class="toc-text">第 1 章 SpringBoot3-快速入门</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-%E7%AE%80%E4%BB%8B"><span class="toc-number">2.1.1.</span> <span class="toc-text">1.1 简介</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-1-%E5%89%8D%E7%BD%AE%E7%9F%A5%E8%AF%86"><span class="toc-number">2.1.1.1.</span> <span class="toc-text">1.1.1 前置知识</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-2-%E7%8E%AF%E5%A2%83%E8%A6%81%E6%B1%82"><span class="toc-number">2.1.1.2.</span> <span class="toc-text">1.1.2 环境要求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-3-SpringBoot-%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-number">2.1.1.3.</span> <span class="toc-text">1.1.3 SpringBoot 是什么</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-%E5%BF%AB%E9%80%9F%E4%BD%93%E9%AA%8C"><span class="toc-number">2.1.2.</span> <span class="toc-text">1.2 快速体验</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-1-%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B"><span class="toc-number">2.1.2.1.</span> <span class="toc-text">1.2.1 开发流程</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-2-1-1-%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE"><span class="toc-number">2.1.2.1.1.</span> <span class="toc-text">1.2.1.1 创建项目</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-2-1-2-%E5%AF%BC%E5%85%A5%E5%9C%BA%E6%99%AF"><span class="toc-number">2.1.2.1.2.</span> <span class="toc-text">1.2.1.2 导入场景</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-2-1-3-%E4%B8%BB%E7%A8%8B%E5%BA%8F"><span class="toc-number">2.1.2.1.3.</span> <span class="toc-text">1.2.1.3 主程序</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-2-1-4-%E4%B8%9A%E5%8A%A1"><span class="toc-number">2.1.2.1.4.</span> <span class="toc-text">1.2.1.4 业务</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-2-1-5-%E6%B5%8B%E8%AF%95"><span class="toc-number">2.1.2.1.5.</span> <span class="toc-text">1.2.1.5 测试</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-2-1-6-%E6%89%93%E5%8C%85"><span class="toc-number">2.1.2.1.6.</span> <span class="toc-text">1.2.1.6 打包</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-2-%E7%89%B9%E6%80%A7%E5%B0%8F%E7%BB%93"><span class="toc-number">2.1.2.2.</span> <span class="toc-text">1.2.2 特性小结</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-2-2-1-%E7%AE%80%E5%8C%96%E6%95%B4%E5%90%88"><span class="toc-number">2.1.2.2.1.</span> <span class="toc-text">1.2.2.1 简化整合</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-2-2-2-%E7%AE%80%E5%8C%96%E5%BC%80%E5%8F%91"><span class="toc-number">2.1.2.2.2.</span> <span class="toc-text">1.2.2.2 简化开发</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-2-2-3-%E7%AE%80%E5%8C%96%E9%85%8D%E7%BD%AE"><span class="toc-number">2.1.2.2.3.</span> <span class="toc-text">1.2.2.3 简化配置</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-2-2-4-%E7%AE%80%E5%8C%96%E9%83%A8%E7%BD%B2"><span class="toc-number">2.1.2.2.4.</span> <span class="toc-text">1.2.2.4 简化部署</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-2-2-5-%E7%AE%80%E5%8C%96%E8%BF%90%E7%BB%B4"><span class="toc-number">2.1.2.2.5.</span> <span class="toc-text">1.2.2.5 简化运维</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-2-2-6-Spring-Initializr-%E5%88%9B%E5%BB%BA%E5%90%91%E5%AF%BC"><span class="toc-number">2.1.2.2.6.</span> <span class="toc-text">1.2.2.6 Spring Initializr 创建向导</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-%E5%BA%94%E7%94%A8%E5%88%86%E6%9E%90"><span class="toc-number">2.1.3.</span> <span class="toc-text">1.3 应用分析</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-1-%E4%BE%9D%E8%B5%96%E7%AE%A1%E7%90%86%E6%9C%BA%E5%88%B6"><span class="toc-number">2.1.3.1.</span> <span class="toc-text">1.3.1 依赖管理机制</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-2-%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E6%9C%BA%E5%88%B6"><span class="toc-number">2.1.3.2.</span> <span class="toc-text">1.3.2 自动配置机制</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-3-2-1-%E5%88%9D%E6%AD%A5%E7%90%86%E8%A7%A3"><span class="toc-number">2.1.3.2.1.</span> <span class="toc-text">1.3.2.1 初步理解</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-3-2-2-%E5%AE%8C%E6%95%B4%E6%B5%81%E7%A8%8B"><span class="toc-number">2.1.3.2.2.</span> <span class="toc-text">1.3.2.2 完整流程</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-3-2-3-%E5%A6%82%E4%BD%95%E5%AD%A6%E5%A5%BD-SpringBoot"><span class="toc-number">2.1.3.2.3.</span> <span class="toc-text">1.3.2.3 如何学好 SpringBoot</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-%E6%A0%B8%E5%BF%83%E6%8A%80%E8%83%BD"><span class="toc-number">2.1.4.</span> <span class="toc-text">1.4 核心技能</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4-1-%E5%B8%B8%E7%94%A8%E6%B3%A8%E8%A7%A3"><span class="toc-number">2.1.4.1.</span> <span class="toc-text">1.4.1 常用注解</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-4-1-1-%E7%BB%84%E4%BB%B6%E6%B3%A8%E5%86%8C"><span class="toc-number">2.1.4.1.1.</span> <span class="toc-text">1.4.1.1 组件注册</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-4-1-2-%E6%9D%A1%E4%BB%B6%E6%B3%A8%E8%A7%A3"><span class="toc-number">2.1.4.1.2.</span> <span class="toc-text">1.4.1.2 条件注解</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-4-1-3-%E5%B1%9E%E6%80%A7%E7%BB%91%E5%AE%9A"><span class="toc-number">2.1.4.1.3.</span> <span class="toc-text">1.4.1.3 属性绑定</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4-2-YAML-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">2.1.4.2.</span> <span class="toc-text">1.4.2 YAML 配置文件</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-4-2-1-%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95"><span class="toc-number">2.1.4.2.1.</span> <span class="toc-text">1.4.2.1. 基本语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-4-2-2-%E7%A4%BA%E4%BE%8B"><span class="toc-number">2.1.4.2.2.</span> <span class="toc-text">1.4.2.2 示例</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-4-2-3-%E7%BB%86%E8%8A%82"><span class="toc-number">2.1.4.2.3.</span> <span class="toc-text">1.4.2.3 细节</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-4-2-4-%E5%B0%8F%E6%8A%80%E5%B7%A7%EF%BC%9Alombok"><span class="toc-number">2.1.4.2.4.</span> <span class="toc-text">1.4.2.4. 小技巧：lombok</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4-3-%E6%97%A5%E5%BF%97%E9%85%8D%E7%BD%AE"><span class="toc-number">2.1.4.3.</span> <span class="toc-text">1.4.3 日志配置</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-4-3-1-%E7%AE%80%E4%BB%8B"><span class="toc-number">2.1.4.3.1.</span> <span class="toc-text">1.4.3.1 简介</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-4-3-2-%E6%97%A5%E5%BF%97%E6%A0%BC%E5%BC%8F"><span class="toc-number">2.1.4.3.2.</span> <span class="toc-text">1.4.3.2 日志格式</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-4-3-3-%E8%AE%B0%E5%BD%95%E6%97%A5%E5%BF%97"><span class="toc-number">2.1.4.3.3.</span> <span class="toc-text">1.4.3.3 记录日志</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-4-3-4-%E6%97%A5%E5%BF%97%E7%BA%A7%E5%88%AB"><span class="toc-number">2.1.4.3.4.</span> <span class="toc-text">1.4.3.4 日志级别</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-4-3-5-%E6%97%A5%E5%BF%97%E5%88%86%E7%BB%84"><span class="toc-number">2.1.4.3.5.</span> <span class="toc-text">1.4.3.5 日志分组</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-4-3-6-%E6%96%87%E4%BB%B6%E8%BE%93%E5%87%BA"><span class="toc-number">2.1.4.3.6.</span> <span class="toc-text">1.4.3.6 文件输出</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-4-3-7-%E6%96%87%E4%BB%B6%E5%BD%92%E6%A1%A3%E4%B8%8E%E6%BB%9A%E5%8A%A8%E5%88%87%E5%89%B2"><span class="toc-number">2.1.4.3.7.</span> <span class="toc-text">1.4.3.7 文件归档与滚动切割</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-4-3-8-%E8%87%AA%E5%AE%9A%E4%B9%89%E9%85%8D%E7%BD%AE"><span class="toc-number">2.1.4.3.8.</span> <span class="toc-text">1.4.3.8 自定义配置</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-4-3-9-%E5%88%87%E6%8D%A2%E6%97%A5%E5%BF%97%E7%BB%84%E5%90%88"><span class="toc-number">2.1.4.3.9.</span> <span class="toc-text">1.4.3.9 切换日志组合</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-4-3-10-%E6%9C%80%E4%BD%B3%E5%AE%9E%E6%88%98"><span class="toc-number">2.1.4.3.10.</span> <span class="toc-text">1.4.3.10 最佳实战</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC-2-%E7%AB%A0-SpringBoot3-Web-%E5%BC%80%E5%8F%91"><span class="toc-number">2.2.</span> <span class="toc-text">第 2 章 SpringBoot3-Web 开发</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-WebMvcAutoConfiguration-%E5%8E%9F%E7%90%86"><span class="toc-number">2.2.1.</span> <span class="toc-text">2.1 WebMvcAutoConfiguration 原理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-1-%E7%94%9F%E6%95%88%E6%9D%A1%E4%BB%B6"><span class="toc-number">2.2.1.1.</span> <span class="toc-text">2.1.1 生效条件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-2-%E6%95%88%E6%9E%9C"><span class="toc-number">2.2.1.2.</span> <span class="toc-text">2.1.2 效果</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-3-WebMvcConfigurer-%E6%8E%A5%E5%8F%A3"><span class="toc-number">2.2.1.3.</span> <span class="toc-text">2.1.3 WebMvcConfigurer 接口</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-4-%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E8%A7%84%E5%88%99%E6%BA%90%E7%A0%81"><span class="toc-number">2.2.1.4.</span> <span class="toc-text">2.1.4 静态资源规则源码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-5-EnableWebMvcConfiguration-%E6%BA%90%E7%A0%81"><span class="toc-number">2.2.1.5.</span> <span class="toc-text">2.1.5 EnableWebMvcConfiguration 源码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-6-%E4%B8%BA%E4%BB%80%E4%B9%88%E5%AE%B9%E5%99%A8%E4%B8%AD%E6%94%BE%E4%B8%80%E4%B8%AA-WebMvcConfigurer-%E5%B0%B1%E8%83%BD%E9%85%8D%E7%BD%AE%E5%BA%95%E5%B1%82%E8%A1%8C%E4%B8%BA"><span class="toc-number">2.2.1.6.</span> <span class="toc-text">2.1.6 为什么容器中放一个 WebMvcConfigurer 就能配置底层行为</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-7-WebMvcConfigurationSupport"><span class="toc-number">2.2.1.7.</span> <span class="toc-text">2.1.7 WebMvcConfigurationSupport</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-Web-%E5%9C%BA%E6%99%AF"><span class="toc-number">2.2.2.</span> <span class="toc-text">2.2 Web 场景</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-1-%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE"><span class="toc-number">2.2.2.1.</span> <span class="toc-text">2.2.1 自动配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-2-%E9%BB%98%E8%AE%A4%E6%95%88%E6%9E%9C"><span class="toc-number">2.2.2.2.</span> <span class="toc-text">2.2.2 默认效果</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90"><span class="toc-number">2.2.3.</span> <span class="toc-text">2.3 静态资源</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-1-%E9%BB%98%E8%AE%A4%E8%A7%84%E5%88%99"><span class="toc-number">2.2.3.1.</span> <span class="toc-text">2.3.1 默认规则</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2-3-1-1-%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E6%98%A0%E5%B0%84"><span class="toc-number">2.2.3.1.1.</span> <span class="toc-text">2.3.1.1 静态资源映射</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-3-1-2-%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E7%BC%93%E5%AD%98"><span class="toc-number">2.2.3.1.2.</span> <span class="toc-text">2.3.1.2 静态资源缓存</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-3-1-3-%E6%AC%A2%E8%BF%8E%E9%A1%B5"><span class="toc-number">2.2.3.1.3.</span> <span class="toc-text">2.3.1.3 欢迎页</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-3-1-4-Favicon"><span class="toc-number">2.2.3.1.4.</span> <span class="toc-text">2.3.1.4 Favicon</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-3-1-5-%E7%BC%93%E5%AD%98%E5%AE%9E%E9%AA%8C"><span class="toc-number">2.2.3.1.5.</span> <span class="toc-text">2.3.1.5 缓存实验</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-2-%E8%87%AA%E5%AE%9A%E4%B9%89%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E8%A7%84%E5%88%99"><span class="toc-number">2.2.3.2.</span> <span class="toc-text">2.3.2 自定义静态资源规则</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2-3-2-1-%E9%85%8D%E7%BD%AE%E6%96%B9%E5%BC%8F"><span class="toc-number">2.2.3.2.1.</span> <span class="toc-text">2.3.2.1 配置方式</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-3-2-2-%E4%BB%A3%E7%A0%81%E6%96%B9%E5%BC%8F"><span class="toc-number">2.2.3.2.2.</span> <span class="toc-text">2.3.2.2 代码方式</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-%E8%B7%AF%E5%BE%84%E5%8C%B9%E9%85%8D"><span class="toc-number">2.2.4.</span> <span class="toc-text">2.4 路径匹配</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-1-Ant-%E9%A3%8E%E6%A0%BC%E8%B7%AF%E5%BE%84%E7%94%A8%E6%B3%95"><span class="toc-number">2.2.4.1.</span> <span class="toc-text">2.4.1 Ant 风格路径用法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-2-%E6%A8%A1%E5%BC%8F%E5%88%87%E6%8D%A2"><span class="toc-number">2.2.4.2.</span> <span class="toc-text">2.4.2 模式切换</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-%E5%86%85%E5%AE%B9%E5%8D%8F%E5%95%86"><span class="toc-number">2.2.5.</span> <span class="toc-text">2.5 内容协商</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-5-1-%E5%A4%9A%E7%AB%AF%E5%86%85%E5%AE%B9%E9%80%82%E9%85%8D"><span class="toc-number">2.2.5.1.</span> <span class="toc-text">2.5.1 多端内容适配</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2-5-1-1-%E9%BB%98%E8%AE%A4%E8%A7%84%E5%88%99"><span class="toc-number">2.2.5.1.1.</span> <span class="toc-text">2.5.1.1 默认规则</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-5-1-2-%E6%95%88%E6%9E%9C%E6%BC%94%E7%A4%BA"><span class="toc-number">2.2.5.1.2.</span> <span class="toc-text">2.5.1.2 效果演示</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-5-1-3-%E9%85%8D%E7%BD%AE%E5%8D%8F%E5%95%86%E8%A7%84%E5%88%99%E4%B8%8E%E6%94%AF%E6%8C%81%E7%B1%BB%E5%9E%8B"><span class="toc-number">2.2.5.1.3.</span> <span class="toc-text">2.5.1.3 配置协商规则与支持类型</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-5-2-%E8%87%AA%E5%AE%9A%E4%B9%89%E5%86%85%E5%AE%B9%E8%BF%94%E5%9B%9E"><span class="toc-number">2.2.5.2.</span> <span class="toc-text">2.5.2 自定义内容返回</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2-5-2-1-%E5%A2%9E%E5%8A%A0-yaml-%E8%BF%94%E5%9B%9E%E6%94%AF%E6%8C%81"><span class="toc-number">2.2.5.2.1.</span> <span class="toc-text">2.5.2.1 增加 yaml 返回支持</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-5-2-2-%E6%80%9D%E8%80%83%EF%BC%9A%E5%A6%82%E4%BD%95%E5%A2%9E%E5%8A%A0%E5%85%B6%E4%BB%96"><span class="toc-number">2.2.5.2.2.</span> <span class="toc-text">2.5.2.2 思考：如何增加其他</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-5-2-3-HttpMessageConverter-%E7%9A%84%E7%A4%BA%E4%BE%8B%E5%86%99%E6%B3%95"><span class="toc-number">2.2.5.2.3.</span> <span class="toc-text">2.5.2.3 HttpMessageConverter 的示例写法</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-5-3-%E5%86%85%E5%AE%B9%E5%8D%8F%E5%95%86%E5%8E%9F%E7%90%86-HttpMessageConverter"><span class="toc-number">2.2.5.3.</span> <span class="toc-text">2.5.3 内容协商原理 HttpMessageConverter</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2-5-3-1-ResponseBody-%E7%94%B1-HttpMessageConverter-%E5%A4%84%E7%90%86"><span class="toc-number">2.2.5.3.1.</span> <span class="toc-text">2.5.3.1 @ResponseBody 由 HttpMessageConverter 处理</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-5-3-2-WebMvcAutoConfiguration-%E6%8F%90%E4%BE%9B%E5%87%A0%E7%A7%8D%E9%BB%98%E8%AE%A4-HttpMessageConverters"><span class="toc-number">2.2.5.3.2.</span> <span class="toc-text">2.5.3.2 WebMvcAutoConfiguration 提供几种默认 HttpMessageConverters</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-6-%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E"><span class="toc-number">2.2.6.</span> <span class="toc-text">2.6 模板引擎</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-6-1-Thymeleaf-%E6%95%B4%E5%90%88"><span class="toc-number">2.2.6.1.</span> <span class="toc-text">2.6.1 Thymeleaf 整合</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-6-2-%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95"><span class="toc-number">2.2.6.2.</span> <span class="toc-text">2.6.2 基础语法</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2-6-2-1-%E6%A0%B8%E5%BF%83%E7%94%A8%E6%B3%95"><span class="toc-number">2.2.6.2.1.</span> <span class="toc-text">2.6.2.1 核心用法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-6-2-2-%E8%AF%AD%E6%B3%95%E7%A4%BA%E4%BE%8B"><span class="toc-number">2.2.6.2.2.</span> <span class="toc-text">2.6.2.2 语法示例</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-6-2-3-%E5%B1%9E%E6%80%A7%E8%AE%BE%E7%BD%AE"><span class="toc-number">2.2.6.2.3.</span> <span class="toc-text">2.6.2.3 属性设置</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-6-2-4-%E9%81%8D%E5%8E%86"><span class="toc-number">2.2.6.2.4.</span> <span class="toc-text">2.6.2.4 遍历</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-6-2-5-%E5%88%A4%E6%96%AD"><span class="toc-number">2.2.6.2.5.</span> <span class="toc-text">2.6.2.5 判断</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-6-2-6-%E5%B1%9E%E6%80%A7%E4%BC%98%E5%85%88%E7%BA%A7"><span class="toc-number">2.2.6.2.6.</span> <span class="toc-text">2.6.2.6 属性优先级</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-6-2-7-%E8%A1%8C%E5%86%85%E5%86%99%E6%B3%95"><span class="toc-number">2.2.6.2.7.</span> <span class="toc-text">2.6.2.7 行内写法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-6-2-8-%E5%8F%98%E9%87%8F%E9%80%89%E6%8B%A9"><span class="toc-number">2.2.6.2.8.</span> <span class="toc-text">2.6.2.8 变量选择</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-6-2-9-%E6%A8%A1%E6%9D%BF%E5%B8%83%E5%B1%80"><span class="toc-number">2.2.6.2.9.</span> <span class="toc-text">2.6.2.9 模板布局</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-6-2-10-devtools"><span class="toc-number">2.2.6.2.10.</span> <span class="toc-text">2.6.2.10 devtools</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-7-%E5%9B%BD%E9%99%85%E5%8C%96"><span class="toc-number">2.2.7.</span> <span class="toc-text">2.7 国际化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-8-%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86"><span class="toc-number">2.2.8.</span> <span class="toc-text">2.8 错误处理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-8-1-%E9%BB%98%E8%AE%A4%E6%9C%BA%E5%88%B6"><span class="toc-number">2.2.8.1.</span> <span class="toc-text">2.8.1 默认机制</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-8-2-%E8%87%AA%E5%AE%9A%E4%B9%89%E9%94%99%E8%AF%AF%E5%93%8D%E5%BA%94"><span class="toc-number">2.2.8.2.</span> <span class="toc-text">2.8.2 自定义错误响应</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2-8-2-1-%E8%87%AA%E5%AE%9A%E4%B9%89-json-%E5%93%8D%E5%BA%94"><span class="toc-number">2.2.8.2.1.</span> <span class="toc-text">2.8.2.1 自定义 json 响应</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-8-2-2-%E8%87%AA%E5%AE%9A%E4%B9%89%E9%A1%B5%E9%9D%A2%E5%93%8D%E5%BA%94"><span class="toc-number">2.2.8.2.2.</span> <span class="toc-text">2.8.2.2 自定义页面响应</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-8-3-%E6%9C%80%E4%BD%B3%E5%AE%9E%E6%88%98"><span class="toc-number">2.2.8.3.</span> <span class="toc-text">2.8.3 最佳实战</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-9-%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%AE%B9%E5%99%A8"><span class="toc-number">2.2.9.</span> <span class="toc-text">2.9 嵌入式容器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-9-1-%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%8E%9F%E7%90%86"><span class="toc-number">2.2.9.1.</span> <span class="toc-text">2.9.1 自动配置原理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-9-2-%E8%87%AA%E5%AE%9A%E4%B9%89"><span class="toc-number">2.2.9.2.</span> <span class="toc-text">2.9.2 自定义</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-9-3-%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><span class="toc-number">2.2.9.3.</span> <span class="toc-text">2.9.3 最佳实践</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-10-%E5%85%A8%E9%9D%A2%E6%8E%A5%E7%AE%A1-SpringMVC"><span class="toc-number">2.2.10.</span> <span class="toc-text">2.10 全面接管 SpringMVC</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-10-1-WebMvcAutoConfiguration-%E5%88%B0%E5%BA%95%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E4%BA%86%E5%93%AA%E4%BA%9B%E8%A7%84%E5%88%99"><span class="toc-number">2.2.10.1.</span> <span class="toc-text">2.10.1 WebMvcAutoConfiguration 到底自动配置了哪些规则</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-10-2-EnableWebMvc-%E7%A6%81%E7%94%A8%E9%BB%98%E8%AE%A4%E8%A1%8C%E4%B8%BA"><span class="toc-number">2.2.10.2.</span> <span class="toc-text">2.10.2 @EnableWebMvc 禁用默认行为</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-10-3-WebMvcConfigurer-%E5%8A%9F%E8%83%BD"><span class="toc-number">2.2.10.3.</span> <span class="toc-text">2.10.3 WebMvcConfigurer 功能</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-11-%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><span class="toc-number">2.2.11.</span> <span class="toc-text">2.11 最佳实践</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-11-1-%E4%B8%89%E7%A7%8D%E6%96%B9%E5%BC%8F"><span class="toc-number">2.2.11.1.</span> <span class="toc-text">2.11.1 三种方式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-11-2-%E4%B8%A4%E7%A7%8D%E6%A8%A1%E5%BC%8F"><span class="toc-number">2.2.11.2.</span> <span class="toc-text">2.11.2 两种模式</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-12-Web-%E6%96%B0%E7%89%B9%E6%80%A7"><span class="toc-number">2.2.12.</span> <span class="toc-text">2.12 Web 新特性</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-12-1-Problemdetails"><span class="toc-number">2.2.12.1.</span> <span class="toc-text">2.12.1 Problemdetails</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-12-2-%E5%87%BD%E6%95%B0%E5%BC%8F-Web"><span class="toc-number">2.2.12.2.</span> <span class="toc-text">2.12.2 函数式 Web</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2-12-2-1-%E5%9C%BA%E6%99%AF"><span class="toc-number">2.2.12.2.1.</span> <span class="toc-text">2.12.2.1 场景</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-12-2-2-%E6%A0%B8%E5%BF%83%E7%B1%BB"><span class="toc-number">2.2.12.2.2.</span> <span class="toc-text">2.12.2.2 核心类</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-12-2-3-%E7%A4%BA%E4%BE%8B"><span class="toc-number">2.2.12.2.3.</span> <span class="toc-text">2.12.2.3 示例</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC-3-%E7%AB%A0-SpringBoot3-%E6%95%B0%E6%8D%AE%E8%AE%BF%E9%97%AE"><span class="toc-number">2.3.</span> <span class="toc-text">第 3 章 SpringBoot3-数据访问</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-%E5%88%9B%E5%BB%BA-SSM-%E6%95%B4%E5%90%88%E9%A1%B9%E7%9B%AE"><span class="toc-number">2.3.1.</span> <span class="toc-text">3.1 创建 SSM 整合项目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-%E9%85%8D%E7%BD%AE%E6%95%B0%E6%8D%AE%E6%BA%90"><span class="toc-number">2.3.2.</span> <span class="toc-text">3.2 配置数据源</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-%E9%85%8D%E7%BD%AE-MyBatis"><span class="toc-number">2.3.3.</span> <span class="toc-text">3.3 配置 MyBatis</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-CRUD-%E7%BC%96%E5%86%99"><span class="toc-number">2.3.4.</span> <span class="toc-text">3.4 CRUD 编写</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-5-%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%8E%9F%E7%90%86"><span class="toc-number">2.3.5.</span> <span class="toc-text">3.5 自动配置原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-6-%E5%BF%AB%E9%80%9F%E5%AE%9A%E4%BD%8D%E7%94%9F%E6%95%88%E7%9A%84%E9%85%8D%E7%BD%AE"><span class="toc-number">2.3.6.</span> <span class="toc-text">3.6 快速定位生效的配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-7-%E6%89%A9%E5%B1%95%EF%BC%9A%E6%95%B4%E5%90%88%E5%85%B6%E4%BB%96%E6%95%B0%E6%8D%AE%E6%BA%90"><span class="toc-number">2.3.7.</span> <span class="toc-text">3.7 扩展：整合其他数据源</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-7-1-Druid-%E6%95%B0%E6%8D%AE%E6%BA%90"><span class="toc-number">2.3.7.1.</span> <span class="toc-text">3.7.1 Druid 数据源</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-8-%E9%99%84%E5%BD%95%EF%BC%9A%E7%A4%BA%E4%BE%8B%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">2.3.8.</span> <span class="toc-text">3.8 附录：示例数据库</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC-4-%E7%AB%A0-SpringBoot3-%E5%9F%BA%E7%A1%80%E7%89%B9%E6%80%A7"><span class="toc-number">2.4.</span> <span class="toc-text">第 4 章 SpringBoot3-基础特性</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-SpringApplication"><span class="toc-number">2.4.1.</span> <span class="toc-text">4.1 SpringApplication</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-1-%E8%87%AA%E5%AE%9A%E4%B9%89-banner"><span class="toc-number">2.4.1.1.</span> <span class="toc-text">4.1.1 自定义 banner</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-2-%E8%87%AA%E5%AE%9A%E4%B9%89-SpringApplication"><span class="toc-number">2.4.1.2.</span> <span class="toc-text">4.1.2 自定义 SpringApplication</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-3-FluentBuilder-API"><span class="toc-number">2.4.1.3.</span> <span class="toc-text">4.1.3 FluentBuilder API</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-Profiles"><span class="toc-number">2.4.2.</span> <span class="toc-text">4.2 Profiles</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-1-%E4%BD%BF%E7%94%A8"><span class="toc-number">2.4.2.1.</span> <span class="toc-text">4.2.1 使用</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#4-2-1-1-%E6%8C%87%E5%AE%9A%E7%8E%AF%E5%A2%83"><span class="toc-number">2.4.2.1.1.</span> <span class="toc-text">4.2.1.1 指定环境</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-2-1-2-%E7%8E%AF%E5%A2%83%E6%BF%80%E6%B4%BB"><span class="toc-number">2.4.2.1.2.</span> <span class="toc-text">4.2.1.2 环境激活</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-2-1-3-%E7%8E%AF%E5%A2%83%E5%8C%85%E5%90%AB"><span class="toc-number">2.4.2.1.3.</span> <span class="toc-text">4.2.1.3 环境包含</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-2-Profile-%E5%88%86%E7%BB%84"><span class="toc-number">2.4.2.2.</span> <span class="toc-text">4.2.2 Profile 分组</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-3-Profile-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">2.4.2.3.</span> <span class="toc-text">4.2.3 Profile 配置文件</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-%E5%A4%96%E9%83%A8%E5%8C%96%E9%85%8D%E7%BD%AE"><span class="toc-number">2.4.3.</span> <span class="toc-text">4.3 外部化配置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-1-%E9%85%8D%E7%BD%AE%E4%BC%98%E5%85%88%E7%BA%A7"><span class="toc-number">2.4.3.1.</span> <span class="toc-text">4.3.1 配置优先级</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-2-%E5%A4%96%E9%83%A8%E9%85%8D%E7%BD%AE"><span class="toc-number">2.4.3.2.</span> <span class="toc-text">4.3.2 外部配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-3-%E5%AF%BC%E5%85%A5%E9%85%8D%E7%BD%AE"><span class="toc-number">2.4.3.3.</span> <span class="toc-text">4.3.3 导入配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-4-%E5%B1%9E%E6%80%A7%E5%8D%A0%E4%BD%8D%E7%AC%A6"><span class="toc-number">2.4.3.4.</span> <span class="toc-text">4.3.4 属性占位符</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4-%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95-JUnit5"><span class="toc-number">2.4.4.</span> <span class="toc-text">4.4 单元测试 JUnit5</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-4-1-%E6%95%B4%E5%90%88"><span class="toc-number">2.4.4.1.</span> <span class="toc-text">4.4.1 整合</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-4-2-%E6%B5%8B%E8%AF%95"><span class="toc-number">2.4.4.2.</span> <span class="toc-text">4.4.2 测试</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#4-4-2-1-%E7%BB%84%E4%BB%B6%E6%B5%8B%E8%AF%95"><span class="toc-number">2.4.4.2.1.</span> <span class="toc-text">4.4.2.1 组件测试</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-4-2-2-%E6%B3%A8%E8%A7%A3"><span class="toc-number">2.4.4.2.2.</span> <span class="toc-text">4.4.2.2 注解</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-4-2-3-%E6%96%AD%E8%A8%80"><span class="toc-number">2.4.4.2.3.</span> <span class="toc-text">4.4.2.3 断言</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-4-2-4-%E5%B5%8C%E5%A5%97%E6%B5%8B%E8%AF%95"><span class="toc-number">2.4.4.2.4.</span> <span class="toc-text">4.4.2.4 嵌套测试</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-4-2-5-%E5%8F%82%E6%95%B0%E5%8C%96%E6%B5%8B%E8%AF%95"><span class="toc-number">2.4.4.2.5.</span> <span class="toc-text">4.4.2.5 参数化测试</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC-5-%E7%AB%A0-SpringBoot3-%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86"><span class="toc-number">2.5.</span> <span class="toc-text">第 5 章 SpringBoot3-核心原理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-%E4%BA%8B%E4%BB%B6%E5%92%8C%E7%9B%91%E5%90%AC%E5%99%A8"><span class="toc-number">2.5.1.</span> <span class="toc-text">5.1 事件和监听器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-1-%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E7%9B%91%E5%90%AC"><span class="toc-number">2.5.1.1.</span> <span class="toc-text">5.1.1 生命周期监听</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#5-1-1-1-%E7%9B%91%E5%90%AC%E5%99%A8-SpringApplicationRunListener"><span class="toc-number">2.5.1.1.1.</span> <span class="toc-text">5.1.1.1 监听器 SpringApplicationRunListener</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-1-1-2-%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%85%A8%E6%B5%81%E7%A8%8B"><span class="toc-number">2.5.1.1.2.</span> <span class="toc-text">5.1.1.2 生命周期全流程</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-2-%E4%BA%8B%E4%BB%B6%E8%A7%A6%E5%8F%91%E6%97%B6%E6%9C%BA"><span class="toc-number">2.5.1.2.</span> <span class="toc-text">5.1.2 事件触发时机</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#5-1-2-1-%E5%90%84%E7%A7%8D%E5%9B%9E%E8%B0%83%E7%9B%91%E5%90%AC%E5%99%A8"><span class="toc-number">2.5.1.2.1.</span> <span class="toc-text">5.1.2.1 各种回调监听器</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-1-2-2-%E5%AE%8C%E6%95%B4%E8%A7%A6%E5%8F%91%E6%B5%81%E7%A8%8B"><span class="toc-number">2.5.1.2.2.</span> <span class="toc-text">5.1.2.2 完整触发流程</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-1-2-3-SpringBoot-%E4%BA%8B%E4%BB%B6%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91"><span class="toc-number">2.5.1.2.3.</span> <span class="toc-text">5.1.2.3 SpringBoot 事件驱动开发</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%8E%9F%E7%90%86"><span class="toc-number">2.5.2.</span> <span class="toc-text">5.2 自动配置原理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-1-%E5%85%A5%E9%97%A8%E7%90%86%E8%A7%A3"><span class="toc-number">2.5.2.1.</span> <span class="toc-text">5.2.1 入门理解</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#5-2-1-1-%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E6%B5%81%E7%A8%8B"><span class="toc-number">2.5.2.1.1.</span> <span class="toc-text">5.2.1.1 自动配置流程</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-2-1-2-SPI-%E6%9C%BA%E5%88%B6"><span class="toc-number">2.5.2.1.2.</span> <span class="toc-text">5.2.1.2 SPI 机制</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-2-1-3-%E5%8A%9F%E8%83%BD%E5%BC%80%E5%85%B3"><span class="toc-number">2.5.2.1.3.</span> <span class="toc-text">5.2.1.3 功能开关</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-2-%E8%BF%9B%E9%98%B6%E7%90%86%E8%A7%A3"><span class="toc-number">2.5.2.2.</span> <span class="toc-text">5.2.2 进阶理解</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#5-2-2-1-SpringBootApplication"><span class="toc-number">2.5.2.2.1.</span> <span class="toc-text">5.2.2.1 @SpringBootApplication</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-2-2-2-%E5%AE%8C%E6%95%B4%E5%90%AF%E5%8A%A8%E5%8A%A0%E8%BD%BD%E6%B5%81%E7%A8%8B"><span class="toc-number">2.5.2.2.2.</span> <span class="toc-text">5.2.2.2 完整启动加载流程</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-%E8%87%AA%E5%AE%9A%E4%B9%89-starter"><span class="toc-number">2.5.3.</span> <span class="toc-text">5.3 自定义 starter</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-3-1-%E4%B8%9A%E5%8A%A1%E4%BB%A3%E7%A0%81"><span class="toc-number">2.5.3.1.</span> <span class="toc-text">5.3.1 业务代码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-3-2-%E5%9F%BA%E6%9C%AC%E6%8A%BD%E5%8F%96"><span class="toc-number">2.5.3.2.</span> <span class="toc-text">5.3.2 基本抽取</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-3-3-%E4%BD%BF%E7%94%A8-EnableXxx-%E6%9C%BA%E5%88%B6"><span class="toc-number">2.5.3.3.</span> <span class="toc-text">5.3.3 使用@EnableXxx 机制</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-3-4-%E5%AE%8C%E5%85%A8%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE"><span class="toc-number">2.5.3.4.</span> <span class="toc-text">5.3.4 完全自动配置</span></a></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2023/11/23/SpringCloud/" title="SpringCloud"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://reggie-xiamou.oss-cn-beijing.aliyuncs.com/img/_8b995f15dbea5c87eb36571ef75128e6_250021544_oE9Cr8AXAIybKbrPekhkAYCyeAQAgA01nL6KDg~tplv-dy-aweme-images_q75" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="SpringCloud"/></a><div class="content"><a class="title" href="/2023/11/23/SpringCloud/" title="SpringCloud">SpringCloud</a><time datetime="2023-11-23T09:25:30.000Z" title="发表于 2023-11-23 17:25:30">2023-11-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/11/20/day14-Maven%E9%AB%98%E7%BA%A7/" title="Javaweb-day14-Maven高级"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://reggie-xiamou.oss-cn-beijing.aliyuncs.com/img/image-20231026211001412.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Javaweb-day14-Maven高级"/></a><div class="content"><a class="title" href="/2023/11/20/day14-Maven%E9%AB%98%E7%BA%A7/" title="Javaweb-day14-Maven高级">Javaweb-day14-Maven高级</a><time datetime="2023-11-20T12:25:32.000Z" title="发表于 2023-11-20 20:25:32">2023-11-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/11/19/day13-SpringBoot%E5%8E%9F%E7%90%86%E7%AF%87/" title="Javaweb-day13-SpringBoot原理篇"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://reggie-xiamou.oss-cn-beijing.aliyuncs.com/img/_870454b4ff78122679656681b8b1cc05_1940175742_edfcee39e6cd43c2a39440a69f0bd65c~tplv-dy-lqen-new_1456_816_q75" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Javaweb-day13-SpringBoot原理篇"/></a><div class="content"><a class="title" href="/2023/11/19/day13-SpringBoot%E5%8E%9F%E7%90%86%E7%AF%87/" title="Javaweb-day13-SpringBoot原理篇">Javaweb-day13-SpringBoot原理篇</a><time datetime="2023-11-19T10:25:32.000Z" title="发表于 2023-11-19 18:25:32">2023-11-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/11/18/day12-SpringBootWeb%20AOP/" title="Javaweb-day12-事务&amp;AOP"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://reggie-xiamou.oss-cn-beijing.aliyuncs.com/img/_687056d184063bd48b8a3cc74d9eb9a4_1310239863_2172878365" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Javaweb-day12-事务&amp;AOP"/></a><div class="content"><a class="title" href="/2023/11/18/day12-SpringBootWeb%20AOP/" title="Javaweb-day12-事务&amp;AOP">Javaweb-day12-事务&amp;AOP</a><time datetime="2023-11-18T10:25:32.000Z" title="发表于 2023-11-18 18:25:32">2023-11-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/11/07/day11-SpringBootWeb%E7%99%BB%E5%BD%95%E8%AE%A4%E8%AF%81/" title="Javaweb-day11-登录认证"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://reggie-xiamou.oss-cn-beijing.aliyuncs.com/img/_6e360fff468fdac7b342c46754cfe996_-893681575_oYDyTagWNAEbPlCLAzeyOqC7khACfAAX6UAIhD~tplv-dy-aweme-images_q75" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Javaweb-day11-登录认证"/></a><div class="content"><a class="title" href="/2023/11/07/day11-SpringBootWeb%E7%99%BB%E5%BD%95%E8%AE%A4%E8%AF%81/" title="Javaweb-day11-登录认证">Javaweb-day11-登录认证</a><time datetime="2023-11-07T10:25:32.000Z" title="发表于 2023-11-07 18:25:32">2023-11-07</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/11/06/day10-SpringBootWeb%E6%A1%88%E4%BE%8B-2/" title="Javaweb-day10-SpringBooot-简单curd"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://reggie-xiamou.oss-cn-beijing.aliyuncs.com/img/_4da64dc0c0fb62ee3ff3fb3b94a16db3_-431180562_c734fe63d18c487ea2479faf68789b79~tplv-dy-lqen-new_1456_816_q75" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Javaweb-day10-SpringBooot-简单curd"/></a><div class="content"><a class="title" href="/2023/11/06/day10-SpringBootWeb%E6%A1%88%E4%BE%8B-2/" title="Javaweb-day10-SpringBooot-简单curd">Javaweb-day10-SpringBooot-简单curd</a><time datetime="2023-11-06T10:25:31.000Z" title="发表于 2023-11-06 18:25:31">2023-11-06</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By Xiamou</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">简</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://unpkg.com/@fancyapps/ui/dist/fancybox/fancybox.umd.js"></script><script src="https://unpkg.com/instant.page/instantpage.js" type="module"></script><script src="https://unpkg.com/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="https://unpkg.com/node-snackbar/dist/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://unpkg.com/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><div class="js-pjax"></div><div class="aplayer no-destroy" data-id="147292559" data-server="netease" data-type="playlist" data-fixed="true" data-autoplay="true"  data-volume="0.4" data-order="random" data-mutex="true" data-listfolded="false"> </div><canvas id="universe"></canvas><script defer src="/js/universe.js"></script><link rel="stylesheet" href="https://unpkg.com/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://unpkg.com/aplayer/dist/APlayer.min.js"></script><script src="https://unpkg.com/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><script src="https://unpkg.com/pjax/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener
  btf.removeGlobalFnEvent('pjax')
  btf.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div><!-- hexo injector body_end start --> <script data-pjax>if(document.getElementById('recent-posts') && (location.pathname ==='/'|| '/' ==='all')){
    var parent = document.getElementById('recent-posts');
    var child = '<div class="recent-post-item" style="width:100%;height: auto"><div id="catalog_magnet"><div class="magnet_item"><a class="magnet_link" href="http://example.com/categories/编程/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">👩‍💻 编程学习 (23)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item" style="visibility: hidden"></div><a class="magnet_link_more"  href="http://example.com/categories" style="flex:1;text-align: center;margin-bottom: 10px;">查看更多...</a></div></div>';
    console.log('已挂载magnet')
    parent.insertAdjacentHTML("afterbegin",child)}
     </script><style>#catalog_magnet{flex-wrap: wrap;display: flex;width:100%;justify-content:space-between;padding: 10px 10px 0 10px;align-content: flex-start;}.magnet_item{flex-basis: calc(50% - 5px);background: #f2f2f2;margin-bottom: 10px;border-radius: 8px;transition: all 0.2s ease-in-out;}.magnet_item:hover{background: #b30070}.magnet_link_more{color:#555}.magnet_link{color:black}.magnet_link:hover{color:white}@media screen and (max-width: 600px) {.magnet_item {flex-basis: 100%;}}.magnet_link_context{display:flex;padding: 10px;font-size:16px;transition: all 0.2s ease-in-out;}.magnet_link_context:hover{padding: 10px 20px;}</style>
    <style></style><script data-pjax>
    function butterfly_categories_card_injector_config(){
      var parent_div_git = document.getElementById('recent-posts');
      var item_html = '<style>li.categoryBar-list-item{width:32.3%;}.categoryBar-list{max-height: 190px;overflow:auto;}.categoryBar-list::-webkit-scrollbar{width:0!important}@media screen and (max-width: 650px){.categoryBar-list{max-height: 160px;}}</style><div class="recent-post-item" style="height:auto;width:100%;padding:0px;"><div id="categoryBar"><ul class="categoryBar-list"><li class="categoryBar-list-item" style="background:url(https://img95.699pic.com/element/40137/3103.png_860.png);"> <a class="categoryBar-list-link" onclick="pjax.loadUrl(&quot;categories/编程/&quot;);" href="javascript:void(0);">编程</a><span class="categoryBar-list-count">23</span><span class="categoryBar-list-descr">编程笔记</span></li></ul></div></div>';
      console.log('已挂载butterfly_categories_card')
      parent_div_git.insertAdjacentHTML("afterbegin",item_html)
      }
    if( document.getElementById('recent-posts') && (location.pathname ==='/'|| '/' ==='all')){
    butterfly_categories_card_injector_config()
    }
  </script><script data-pjax>
  function butterfly_footer_beautify_injector_config(){
    var parent_div_git = document.getElementById('footer-wrap');
    var item_html = '<div id="workboard"></div><p id="ghbdages"><a class="github-badge" target="_blank" href="https://hexo.io/" style="margin-inline:5px" data-title="博客框架为Hexo_v6.2.0" title=""><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Frame-Hexo-blue?style=flat&amp;logo=hexo" alt=""/></a><a class="github-badge" target="_blank" href="https://butterfly.js.org/" style="margin-inline:5px" data-title="主题版本Butterfly_v4.3.1" title=""><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Theme-Butterfly-6513df?style=flat&amp;logo=bitdefender" alt=""/></a><a class="github-badge" target="_blank" href="https://dashboard.4everland.org/" style="margin-inline:5px" data-title="本站采用多线部署，备用线路托管于4EVERLAND" title=""><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Hosted-4EVERLAND-22DDDD?style=flat&amp;logo=IPFS" alt=""/></a><a class="github-badge" target="_blank" href="https://github.com/" style="margin-inline:5px" data-title="本站项目由Github托管" title=""><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Source-Github-d021d6?style=flat&amp;logo=GitHub" alt=""/></a><a class="github-badge" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" style="margin-inline:5px" data-title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可" title=""><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Copyright-BY--NC--SA%204.0-d42328?style=flat&amp;logo=Claris" alt=""/></a></p>';
    console.log('已挂载butterfly_footer_beautify')
    parent_div_git.insertAdjacentHTML("beforeend",item_html)
    }
  var elist = 'null'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_footer_beautify_injector_config();
  }
  else if (epage === cpage){
    butterfly_footer_beautify_injector_config();
  }
  </script><script async src="/js/runtime.js"></script><script data-pjax>
  function butterfly_clock_anzhiyu_injector_config(){
    var parent_div_git = document.getElementsByClassName('sticky_layout')[0];
    var item_html = '<div class="card-widget card-clock"><div class="card-glass"><div class="card-background"><div class="card-content"><div id="hexo_electric_clock"><img class="entered loading" id="card-clock-loading" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu/lib/loading.gif" style="height: 120px; width: 100%;" data-ll-status="loading"/></div></div></div></div></div>';
    console.log('已挂载butterfly_clock_anzhiyu')
    if(parent_div_git) {
      parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  }
  var elist = 'null'.split(',');
  var cpage = location.pathname;
  var epage = '/';
  var qweather_key = 'b16a1fa0e63c46a4b8f28abfb06ae3fe';
  var gaud_map_key = 'e2b04289e870b005374ee030148d64fd&s=rsv3';
  var baidu_ak_key = 'undefined';
  var flag = 0;
  var clock_rectangle = '113.34532,23.15624';
  var clock_default_rectangle_enable = 'false';

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_clock_anzhiyu_injector_config();
  }
  else if (epage === cpage){
    butterfly_clock_anzhiyu_injector_config();
  }
  </script><script src="https://widget.qweather.net/simple/static/js/he-simple-common.js?v=2.0"></script><script data-pjax src="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu/lib/clock.min.js"></script><script data-pjax>
  function butterfly_swiper_injector_config(){
    var parent_div_git = document.getElementById('recent-posts');
    var item_html = '<div class="recent-post-item" style="height: auto;width: 100%"><div class="blog-slider swiper-container-fade swiper-container-horizontal" id="swiper_container"><div class="blog-slider__wrp swiper-wrapper" style="transition-duration: 0ms;"><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;2023/07/10/sql笔记/&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img2.baidu.com/it/u=568898386,1867126536&amp;fm=253&amp;fmt=auto&amp;app=138&amp;f=JPEG?w=500&amp;h=333" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2023-07-10</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;2023/07/10/sql笔记/&quot;);" href="javascript:void(0);" alt="">数据库基础sql</a><div class="blog-slider__text">数据库基础详情</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;2023/07/10/sql笔记/&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;2023/10/09/SpringBoot3 全栈指南教程——尚硅谷学习笔记 2023年/&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img1.baidu.com/it/u=4046275171,1854121622&amp;fm=253&amp;fmt=auto?w=640&amp;h=356" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2023-10-09</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;2023/10/09/SpringBoot3 全栈指南教程——尚硅谷学习笔记 2023年/&quot;);" href="javascript:void(0);" alt="">SpringBoot3</a><div class="blog-slider__text">SpringBoot3 全栈指南教程——尚硅谷学习笔记 2023 年</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;2023/10/09/SpringBoot3 全栈指南教程——尚硅谷学习笔记 2023年/&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;2023/06/30/Linux课程笔记/&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img0.baidu.com/it/u=3558646961,215274081&amp;fm=253&amp;fmt=auto&amp;app=138&amp;f=JPEG?w=800&amp;h=500" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2023-06-30</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;2023/06/30/Linux课程笔记/&quot;);" href="javascript:void(0);" alt="">linux基础命令笔记</a><div class="blog-slider__text">linux的一些实用的0基础命令</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;2023/06/30/Linux课程笔记/&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div></div><div class="blog-slider__pagination swiper-pagination-clickable swiper-pagination-bullets"></div></div></div>';
    console.log('已挂载butterfly_swiper')
    parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  var elist = 'undefined'.split(',');
  var cpage = location.pathname;
  var epage = '/';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_swiper_injector_config();
  }
  else if (epage === cpage){
    butterfly_swiper_injector_config();
  }
  </script><script defer src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.js"></script><script defer data-pjax src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper_init.js"></script><div class="js-pjax"><script async="async">var arr = document.getElementsByClassName('recent-post-item');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__zoomIn');
    arr[i].setAttribute('data-wow-duration', '2s');
    arr[i].setAttribute('data-wow-delay', '1s');
    arr[i].setAttribute('data-wow-offset', '100');
    arr[i].setAttribute('data-wow-iteration', '2');
  }</script><script async="async">var arr = document.getElementsByClassName('card-widget');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__zoomIn');
    arr[i].setAttribute('data-wow-duration', '');
    arr[i].setAttribute('data-wow-delay', '');
    arr[i].setAttribute('data-wow-offset', '');
    arr[i].setAttribute('data-wow-iteration', '');
  }</script><script async="async">var arr = document.getElementsByClassName('pagination');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__rotateOutDownLeft');
    arr[i].setAttribute('data-wow-duration', '');
    arr[i].setAttribute('data-wow-delay', '');
    arr[i].setAttribute('data-wow-offset', '');
    arr[i].setAttribute('data-wow-iteration', '');
  }</script></div><script defer src="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/wow.min.js"></script><script defer src="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/wow_init.js"></script><!-- hexo injector body_end end --><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/koharu.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true},"log":false});</script></body></html>